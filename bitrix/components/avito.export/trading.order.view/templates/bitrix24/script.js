this.BX=this.BX||{},this.BX.AvitoExport=this.BX.AvitoExport||{},this.BX.AvitoExport.UI=this.BX.AvitoExport.UI||{},function(t){"use strict";const e=window.BX;class s{constructor(t={}){this.onEditorInit=(t,e)=>{e.methods[this.options.name]=this.build,this.handleEditorInit(!1)},this.build=(t,e,s)=>{const i=this.options.name+"-";if(0!==t.indexOf(i))return null;const r=t.substring(i.length);if(!this.options.map.hasOwnProperty(r))return null;return this.options.map[r].create(e,s)},this.options=Object.assign({},this.constructor.defaults,t)}register(){this.isEditorInitialized()?this.registerEditorMethod():this.handleEditorInit(!0)}isEditorInitialized(){var t,s;return null==(t=e.UI)||null==(s=t.EntityEditorControlFactory)?void 0:s.initialized}registerEditorMethod(){e.UI.EntityEditorControlFactory.registerFactoryMethod(this.options.name,this.build)}handleEditorInit(t){e[t?"addCustomEvent":"removeCustomEvent"](window,"BX.UI.EntityEditorControlFactory:onInitialize",this.onEditorInit)}}function i(t,e="div"){const s=document.createElement(e);return s.innerHTML=t,s.firstElementChild}function r(t){return t.split("_").map((t=>t.toLowerCase())).join("-")}s.defaults={name:"avito-export",map:{}};class n extends BX.UI.EntityEditorField{constructor(){super(),this._hasLayout=!1,this.options=null!=this.constructor.defaults?Object.assign({},this.constructor.defaults):{}}getMessage(t,e=null){let s=this.constructor.messages[t]||super.getMessage(t);return null!=e&&(s=function(t,e){let s=t;if(null==e)return s;for(const[t,i]of Object.entries(e))s=s.replace("#"+t+"#",i);return s}(s,e)),s}clearLayout(){this._hasLayout&&(this.forget(),this._wrapper.innerHTML="",this._hasLayout=!1)}layout(t){if(!this._hasLayout){if(this.ensureWrapperCreated({}),this.adjustWrapper(),!this.isNeedToDisplay())return this.registerLayout(t),void(this._hasLayout=!0);if(this.forget(),this._wrapper.innerHTML="",this.isDragEnabled()&&this._wrapper.appendChild(this.createDragButton()),this.useTitle()){const t=this.getTitle();this._wrapper.appendChild(this.createTitleNode(t))}this.render(this.getValue()),this.isContextMenuEnabled()&&this._wrapper.appendChild(this.createContextMenuButton()),this.isDragEnabled()&&this.initializeDragDropAbilities(),this.registerLayout(t),this._hasLayout=!0}}forget(){}render(t){}useTitle(){return!1}fewElements(t){const e=this.getElementSelector(t);let s;return s=0===e.indexOf("#")?document.querySelectorAll(e):this.el.querySelectorAll(e),s}getElement(t){const e=this.getElementSelector(t);let s;return s=0===e.indexOf("#")?document.querySelector(e):this.el.querySelector(e),s}getElementSelector(t){return this.options[t+"Element"]}}class o{constructor(t){this.options=Object.assign({},this.constructor.defaults,t)}destroy(){this.options={}}getMessage(t){return this.options.messages[t]||t}render(t,e){const s=Object.keys(e.COLUMNS);this.el=i(`<tr>\n\t\t\t${s.map((e=>this.renderColumn(t,e))).join("")}\n\t\t</tr>`,"tbody")}mount(t){t.appendChild(this.el)}renderColumn(t,e){const s="column"+e.split("_").map((t=>t.substr(0,1).toUpperCase()+t.substr(1).toLowerCase())).join("");return s in this?this[s](t,e):this.columnDefault(t,e)}columnName(t,e){const s={SERVICE_URL:"share",CHAT_URL:"chat"};return`<td class="for--${r(e)}">\n\t\t\t${Object.keys(s).map((e=>t[e]?`<a class="avito-export-link-icon" href="${t[e]}" target="_blank">\x3c!--\n\t\t\t\t\t\t--\x3e<img \n\t\t\t\t\t\t\t\tclass="avito-export-link-icon__icon"\n\t\t\t                   \tsrc="/bitrix/js/avitoexport/trading/i/${s[e]}_icon.svg" \n\t\t\t                   \talt=""\n\t\t                    />\x3c!--\n\t\t\t\t\t--\x3e</a>`:"")).join("")}\n\t\t\t${this.valueFormatted(t,e)}\n\t\t</td>`}columnPrice(t,e){return`<td class="for--${r(e)}">\n\t\t\t${this.valueFormatted(t,e)}<br />\n\t\t\t<small>${this.getMessage("COMMISSION")}: -${this.valueFormatted(t,"COMMISSION")}</small>\n\t\t\t${this.priceDiscounts(t)}\n\t\t</td>`}priceDiscounts(t){let e="";return t.DISCOUNTS.length>0?e=`<details>\n\t\t\t\t<summary><small>${this.getMessage("DISCOUNT")}: -${this.valueFormatted(t,"DISCOUNT")}</small></summary>\n\t\t\t\t${t.DISCOUNTS.map((t=>`<small>${t.TYPE}:&nbsp;-${t.VALUE_FORMATTED}</small><br>`)).join("")}\n\t\t\t</details>`:t.DISCOUNT>0&&(e=`<small>${this.getMessage("DISCOUNT")}: -${this.valueFormatted(t,"DISCOUNT")}</small>`),e}columnQuantity(t,e){return`<td class="for--${r(e)}">${this.valueFormatted(t,e)} ${this.getMessage("QUANTITY_UNIT")}</td>`}columnDefault(t,e){return`<td class="for--${r(e)}">${this.valueFormatted(t,e)}</td>`}valueFormatted(t,e){const s=e+"_FORMATTED";let i="";return null!=t[s]?i=t[s]:null!=t[e]&&(i=t[e]),""!==i?i:"&mdash;"}value(t,e){return t[e]}}o.defaults={messages:{},name:null,title:null,actions:[],onChange:null};class a{static make(t,e){var s;const r=i(`<button \n\t\t\tclass="ui-btn ui-btn-sm ${t.REQUIRED?"ui-btn-primary":""}" \n\t\t\ttype="button"\n\t\t>${t.TITLE}</button>`),n=new BX.AvitoExport.Trading.Activity.View.CrmTab(r,{editor:e});return BX.AvitoExport.Trading.Activity.Factory.make(t.BEHAVIOR,n,Object.assign({},null!=(s=t.UI_OPTIONS)?s:{},{title:t.TITLE,confirm:t.CONFIRM||null,url:t.URL})),r}}class l extends n{static create(t,e){const s=new l;return s.initialize(t,e),s}constructor(){super(),this.onTitleActions=(t,e)=>{if(t===this.getParent())for(const t of this.activities){const s=a.make(t,this._editor);e.customNodes.push(s)}},this.items=[],this.activities=[]}initialize(t,e){super.initialize(t,e),this.handleTitleActions(!0)}release(){this.handleTitleActions(!1),super.release()}handleTitleActions(t){BX[t?"addCustomEvent":"removeCustomEvent"](window,"BX.UI.EntityEditorSection:onLayout",this.onTitleActions)}render(t){const e=t,s=this.renderTable(e),i=s.querySelector("tbody");this.activities=t.ACTIVITIES,this.renewItems(e.ROWS).forEach(((t,s)=>{t.render(e.ROWS[s],e),t.mount(i)})),this._wrapper.appendChild(s)}renewItems(t){return this.destroyItems(),this.createItems(t)}destroyItems(){for(const t of this.items)t.destroy();this.items=[]}createItems(t){this.items=[];for(const e of t)this.items.push(this.createItem());return this.items}createItem(){return new o({messages:l.messages})}renderTable(t){return i(`<div class="avito-export-basket">\n\t\t\t<div class="avito-export-basket-table-viewport">\n\t\t\t\t<table class="avito-export-basket-table">\n\t\t\t\t\t${this.renderHeader(t)}\n\t\t\t\t\t<tbody></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t\t${this.renderSummary(t)}\n\t\t</div>`)}renderHeader(t){return`<thead>\n\t\t\t<tr>\n\t\t\t\t${Object.keys(t.COLUMNS).map((e=>`<td class="for--${r(e)}">${t.COLUMNS[e]}</td>`)).join("")}\n\t\t\t</tr>\n\t\t</thead>`}renderSummary(t){return`<div class="avito-export-basket-summary">\n\t\t\t${t.SUMMARY.map((t=>`<div class="avito-export-basket-summary__row">\n\t\t\t\t\t\t<div class="avito-export-basket-summary__label">${t.NAME}:</div>\n\t\t\t\t\t\t<div class="avito-export-basket-summary__value">${t.VALUE_FORMATTED}</div>\n\t\t\t\t\t</div>`)).join("")}\n\t\t</div>`}}l.messages={},l.defaults={name:"BASKET",actions:[]};class d extends n{static create(t,e){const s=new d;return s.initialize(t,e),s}useTitle(){return!0}render(t){const e=this.build(t);this._wrapper.insertAdjacentHTML("beforeend",e)}build(t){return`<div class="ui-entity-editor-content-block">\n\t\t\t<div class="ui-entity-editor-content-block-text">\n\t\t\t\t${t.VALUE}\n\t\t\t</div>\n\t\t</div>`}}d.messages={};class u extends n{static create(t,e){const s=new u;return s.initialize(t,e),s}render(t){this.renderMessages(t.MESSAGES),this.renderActivities(t.ACTIVITIES)}renderMessages(t){if(!Array.isArray(t)||0===t.length)return;const e=t.map((t=>`<div class="ui-alert ui-alert-${t.type}"><div>${t.text}</div></div>`)).join("");this._wrapper.insertAdjacentHTML("beforeend",e)}renderActivities(t){if(!Array.isArray(t)||0===t.length)return;const e=i('<div class="avito-export-activity-buttons"></div>');let s=this._wrapper.querySelector(".ui-alert");null===s&&(s=i('<div class="ui-alert ui-alert-info"></div>'),this._wrapper.insertAdjacentElement("beforeend",s)),t.forEach((t=>{e.insertAdjacentElement("beforeend",a.make(t,this._editor))})),s.insertAdjacentElement("beforeend",e)}}u.defaults={};new s({map:{attention:u,basket:l,property:d}}).register(),t.Attention=u,t.Basket=l,t.Property=d}(this.BX.AvitoExport.UI.EntityEditor=this.BX.AvitoExport.UI.EntityEditor||{});
//# sourceMappingURL=script.js.map
