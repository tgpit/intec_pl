{"version":3,"file":"script.js","sources":["src/transport.js","src/utils.js","src/state.js","src/suggest.js","src/item.js","src/attributes.js","src/formcategory/behavior.js","src/formcategory/element.js","src/formcategory/section.js","src/formcategory/productelement.js","src/formcategory/productsection.js","src/formcategory/massiveedit.js","src/formcategory/factory.js","src/field.js","src/multiplefield.js","src/singlefield.js"],"sourcesContent":["export class Transport {\r\n\r\n\tconstructor(component: string) {\r\n\t\tthis.component = component;\r\n\t\tthis._middleware = [];\r\n\t}\r\n\r\n\tmiddleware(callback: () => {}) {\r\n\t\tthis._middleware.push(callback);\r\n\t}\r\n\r\n\tfetch(action: string, data: Object = {}) : Promise {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tBX.ajax.runComponentAction(this.component, action, {\r\n\t\t\t\tmode: 'ajax',\r\n\t\t\t\tdata: this.prepare(action, data),\r\n\t\t\t})\r\n\t\t\t\t.then((response) => {\r\n\t\t\t\t\tconst data = response.data;\r\n\r\n\t\t\t\t\tif (data.status === 'ok') {\r\n\t\t\t\t\t\tresolve(data.data);\r\n\t\t\t\t\t} else if (data.status === 'error') {\r\n\t\t\t\t\t\treject(new Error(data.message));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treject(new Error('unknown response format'));\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch((response) => { reject(this.queryError(response)); });\r\n\t\t});\r\n\t}\r\n\r\n\tprepare(action: string, data: Object) : Object {\r\n\t\tfor (const middleware of this._middleware) {\r\n\t\t\tdata = middleware(action, data);\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\t// noinspection DuplicatedCode\r\n\tqueryError(response: Object) : Error {\r\n\t\tif (response.status !== 'error') {\r\n\t\t\treturn new Error('unknown response');\r\n\t\t}\r\n\r\n\t\tif (!Array.isArray(response.errors) || response.errors.length === 0) {\r\n\t\t\treturn new Error('error response does not contain errors');\r\n\t\t}\r\n\r\n\t\tconst error = response.errors[response.errors.length - 1];\r\n\r\n\t\treturn new Error(error.message);\r\n\t}\r\n\r\n}","export function compileTemplate(template, variables) {\r\n\tlet result = template;\r\n\r\n\tif (variables == null) { return result; }\r\n\r\n\tfor (const [key, value] of Object.entries(variables)) {\r\n\t\tconst marker = '#' + key + '#';\r\n\t\tlet previousPosition = -1;\r\n\t\tlet position = -1;\r\n\r\n\t\tdo {\r\n\t\t\tpreviousPosition = position;\r\n\t\t\tresult = result.replace(marker, value);\r\n\r\n\t\t\tposition = result.indexOf(marker);\r\n\t\t} while (position !== -1 && position > previousPosition);\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function htmlToElement(html, tag = 'div') {\r\n\tconst renderer = document.createElement(tag);\r\n\r\n\trenderer.innerHTML = html;\r\n\r\n\treturn renderer.firstElementChild;\r\n}","import {compileTemplate, htmlToElement} from \"./utils\";\r\n\r\nexport class State {\r\n\r\n\tstatic defaults = {\r\n\t\tstateTemplate: '<span class=\"bx-avito-export-characteristic__state\"></span>',\r\n\t\tloadingTemplate: '#LOADING#...',\r\n\t\twaitingTemplate: '',\r\n\t\terrorTemplate: '#MESSAGE#',\r\n\t\tlang: {\r\n\t\t\tLOADING: 'Loading',\r\n\t\t},\r\n\t};\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis._stateHolder = null;\r\n\t}\r\n\r\n\tloading() : void {\r\n\t\tthis.state('loading');\r\n\t}\r\n\r\n\twaiting() : void {\r\n\t\tthis.state('waiting');\r\n\t}\r\n\r\n\terror(reason: Error) : void {\r\n\t\tthis.state('error', {\r\n\t\t\tMESSAGE: reason.message,\r\n\t\t});\r\n\t}\r\n\r\n\tstate(type: string, vars: Object = {}) : void {\r\n\t\tconst html = this.compileTemplate(type, vars);\r\n\t\tconst holder = this.stateHolder(type);\r\n\r\n\t\tthis.markTypeClass(holder, type);\r\n\t\tthis.replaceHtml(holder, html);\r\n\t}\r\n\r\n\tcompileTemplate(type: string, vars: Object = {}) : string {\r\n\t\tconst template = this.options[type + 'Template'];\r\n\t\tlet html;\r\n\r\n\t\thtml = compileTemplate(template, vars);\r\n\t\thtml = compileTemplate(html, this.options.lang);\r\n\r\n\t\treturn html;\r\n\t}\r\n\r\n\tmarkTypeClass(holder: HTMLElement, type: string) : void {\r\n\t\tconst states = [\r\n\t\t\t'loading',\r\n\t\t\t'waiting',\r\n\t\t\t'error',\r\n\t\t];\r\n\r\n\t\tfor (const state of states) {\r\n\t\t\tif (state === type) {\r\n\t\t\t\tholder.classList.add(state);\r\n\t\t\t} else {\r\n\t\t\t\tholder.classList.remove(state);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treplaceHtml(holder: HTMLElement, html: string) : void {\r\n\t\tholder.innerHTML = html;\r\n\t}\r\n\r\n\tstateHolder() : HTMLElement {\r\n\t\tif (this._stateHolder != null) { return this._stateHolder; }\r\n\r\n\t\tconst html = this.options.stateTemplate;\r\n\t\tconst element = htmlToElement(html);\r\n\r\n\t\tthis.el.after(element);\r\n\t\tthis._stateHolder = element;\r\n\r\n\t\treturn this._stateHolder;\r\n\t}\r\n}","// @flow\r\n\r\nimport {Transport} from \"./transport\";\r\nimport {Item} from \"./item\";\r\nimport {compileTemplate, htmlToElement} from \"./utils\";\r\n\r\nexport class Suggest {\r\n\r\n\tstatic defaults = {\r\n\t\ttransport: null,\r\n\t\tstate: null,\r\n\t\tattribute: null,\r\n\t\tselectElement: 'select',\r\n\t\tselectTemplate: '<select>#OPTIONS#</select>',\r\n\t\tinputElement: 'input',\r\n\t\tinputTemplate: '<input type=\"text\" autocomplete=\"off\" />',\r\n\t\tvalues: {},\r\n\t};\r\n\r\n\tconstructor(item: Item, element: HTMLElement, options: Object = {}) {\r\n\t\tthis.item = item;\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis._stored = null;\r\n\t\tthis._variants = null;\r\n\t\tthis._state = this.options.state;\r\n\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tbind() : void {\r\n\t\tthis.handleInput(true);\r\n\t}\r\n\r\n\tunbind() : void {\r\n\t\tthis.handleInput(false);\r\n\t}\r\n\r\n\thandleInput(dir: boolean, input: HTMLInputElement = null) : void {\r\n\t\tthis.handleFocus(dir, input);\r\n\t\tthis.handleChange(dir, input);\r\n\t}\r\n\r\n\thandleFocus(dir: boolean, input: HTMLInputElement = null) : void {\r\n\t\tif (input == null) { input = this.input(); }\r\n\r\n\t\tinput?.[dir ? 'addEventListener' : 'removeEventListener']('focus', this.onFocus);\r\n\t}\r\n\r\n\thandleChange(dir: boolean, input: HTMLInputElement = null) : void {\r\n\t\tif (input == null) { input = this.input(); }\r\n\r\n\t\tinput?.[dir ? 'addEventListener' : 'removeEventListener']('change', this.onChange);\r\n\t}\r\n\r\n\tonFocus = () => {\r\n\t\t// noinspection JSIgnoredPromiseFromCall\r\n\t\tthis.load();\r\n\t}\r\n\r\n\tonChange = () => {\r\n\t\tif (!this.hasVariants()) { return; }\r\n\r\n\t\tthis.normalize();\r\n\t\tthis.item.refresh();\r\n\t}\r\n\r\n\tload() : Promise {\r\n\t\tconst values = this.values();\r\n\r\n\t\tif (!this.isChanged(values)) { return Promise.resolve(); }\r\n\r\n\t\tthis.store(values);\r\n\t\tthis.clear();\r\n\t\tthis._state?.loading();\r\n\r\n\t\treturn this.query(values)\r\n\t\t\t.then((variants) => {\r\n\t\t\t\tthis.render(variants);\r\n\t\t\t\tthis._state?.waiting();\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\tthis._state?.error(error)\r\n\t\t\t\tthis.release();\r\n\t\t\t});\r\n\t}\r\n\r\n\tisChanged(values: Object) : boolean {\r\n\t\tif (this._stored == null) { return true; }\r\n\r\n\t\tlet result = false;\r\n\r\n\t\tfor (const key of Object.keys(values)) {\r\n\t\t\tconst value = values[key];\r\n\t\t\tconst stored = this._stored[key];\r\n\r\n\t\t\tif (!this.compare(value, stored)) {\r\n\t\t\t\tresult = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstore(values: Object) : void {\r\n\t\tthis._stored = values;\r\n\t}\r\n\r\n\trelease() : void {\r\n\t\tthis._stored = null;\r\n\t}\r\n\r\n\tquery(values) : Promise {\r\n\t\treturn this.transport().fetch('variants', {\r\n\t\t\tattribute: this.options.attribute,\r\n\t\t\tvalues: values,\r\n\t\t});\r\n\t}\r\n\r\n\ttransport() : Transport {\r\n\t\tconst option = this.options.transport;\r\n\r\n\t\tif (!(option instanceof Transport)) {\r\n\t\t\tthrow new Error('transport must be instance of Transport');\r\n\t\t}\r\n\r\n\t\treturn option;\r\n\t}\r\n\r\n\tclear() : void {\r\n\t\tconst input = this.input();\r\n\t\tconst tagName = input?.tagName?.toLowerCase();\r\n\r\n\t\tif (tagName !== 'select') { return; }\r\n\r\n\t\tinput\r\n\t\t\t.querySelectorAll('option')\r\n\t\t\t.forEach((option) => {\r\n\t\t\t\tif (!option.selected) { option.remove(); }\r\n\t\t\t});\r\n\t}\r\n\r\n\tredraw(variants: Array) : void {\r\n\t\tthis.store(this.values());\r\n\t\tthis.render(variants);\r\n\t}\r\n\r\n\trender(variants: Array) : void {\r\n\t\tconst input = this.input();\r\n\t\tconst type = variants.length > 0 ? 'select' : 'input';\r\n\t\tconst html = (type === 'select' ? this.selectHtml(variants) : this.inputHtml());\r\n\t\tconst selector = this.options[type + 'Element'];\r\n\t\tconst selected = input?.value;\r\n\t\tlet newInput;\r\n\r\n\t\tif (input == null) {\r\n\t\t\tnewInput = htmlToElement(html);\r\n\t\t\tthis.el.insertAdjacentElement('beforeend', newInput);\r\n\t\t} else if (input.matches(selector)) {\r\n\t\t\tnewInput = this.redrawControl(input, html);\r\n\t\t} else {\r\n\t\t\tnewInput = this.replaceControl(input, html);\r\n\t\t}\r\n\r\n\t\tthis.setInputValue(newInput, selected);\r\n\t\tthis._variants = variants;\r\n\t}\r\n\r\n\tselectHtml(variants: Array) : string {\r\n\t\tconst template = this.options.selectTemplate;\r\n\t\tconst options = variants\r\n\t\t\t.map((variant: string) => `<option>${BX.util.htmlspecialchars(variant)}</option>`)\r\n\t\t\t.join('');\r\n\r\n\t\treturn compileTemplate(template, {\r\n\t\t\tOPTIONS: options,\r\n\t\t});\r\n\t}\r\n\r\n\tinputHtml() : string {\r\n\t\treturn this.options.inputTemplate;\r\n\t}\r\n\r\n\tinput() : ?HTMLInputElement {\r\n\t\treturn this.el.querySelector(this.options.selectElement) ?? this.el.querySelector(this.options.inputElement);\r\n\t}\r\n\r\n\tselected() : string {\r\n\t\treturn this.input()?.value;\r\n\t}\r\n\r\n\tredrawControl(input: HTMLInputElement, html: string) : HTMLInputElement {\r\n\t\tconst newInput = htmlToElement(html);\r\n\t\tconst contents = newInput.innerHTML.trim();\r\n\r\n\t\tif (contents === '') { return input; }\r\n\r\n\t\tinput.innerHTML = contents;\r\n\r\n\t\treturn input;\r\n\t}\r\n\r\n\tsetInputValue(input: HTMLElement, selected: string) : void {\r\n\t\tif (input.tagName.toLowerCase() === 'select') {\r\n\t\t\tinput\r\n\t\t\t\t.querySelectorAll('option')\r\n\t\t\t\t.forEach((option) => {\r\n\t\t\t\t\toption.selected = (option.value === selected);\r\n\t\t\t\t});\r\n\t\t} else {\r\n\t\t\tinput.value = selected ?? '';\r\n\t\t}\r\n \t}\r\n\r\n\treplaceControl(input: HTMLInputElement, html: string) : HTMLInputElement {\r\n\t\tconst newInput = htmlToElement(html);\r\n\t\tnewInput.name = input.name;\r\n\t\tnewInput.className = input.className;\r\n\r\n\t\tthis.handleInput(false, input);\r\n\t\tinput.after(newInput);\r\n\t\tinput.remove();\r\n\t\tthis.handleInput(true, newInput);\r\n\r\n\t\treturn newInput;\r\n\t}\r\n\r\n\tnormalize() : void {\r\n\t\tconst current = this.el.value;\r\n\t\tconst matched = this.matched(current);\r\n\r\n\t\tthis.el.value = matched ?? '';\r\n\t}\r\n\r\n\thasVariants() : boolean {\r\n\t\treturn this._variants != null && this._variants.length > 0;\r\n\t}\r\n\r\n\tmatched(value: string) : ?string {\r\n\t\tif (this._variants == null) { return; }\r\n\r\n\t\tlet result;\r\n\r\n\t\tfor (const variant of this._variants) {\r\n\t\t\tif (this.compare(value, variant)) {\r\n\t\t\t\tresult = variant;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcompare(first: string, second: string) {\r\n\t\treturn (first ?? '').trim().toLowerCase() === (second ?? '').trim().toLowerCase();\r\n\t}\r\n\r\n\tvalues() : Object {\r\n\t\tconst option = this.options.values;\r\n\r\n\t\treturn typeof option === 'function' ? option() : option;\r\n\t}\r\n}","// @flow\r\n\r\nimport {Suggest} from \"./suggest\";\r\nimport {Field} from \"./field\";\r\n\r\nexport class Item {\r\n\r\n\tstatic defaults = {\r\n\t\ttransport: null,\r\n\t\tstate: null,\r\n\t\tattribute: null,\r\n\t\tattributeElement: '[data-entity=\"attribute\"]',\r\n\t\tvalueElement: '[data-entity=\"value\"]',\r\n\t\tdeleteElement: '[data-entity=\"delete\"]',\r\n\t};\r\n\r\n\tconstructor(field: Field, element: HTMLElement, options: Object = {}) {\r\n\t\tthis.field = field;\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\r\n\t\tthis.resolveAttribute();\r\n\t\tthis.bootSuggest();\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tdestroy() : void {\r\n\t\tthis.unbind();\r\n\r\n\t\tthis.options = null;\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tbind() : void {\r\n\t\tthis.handleDeleteClick(true);\r\n\t}\r\n\r\n\tunbind() : void {\r\n\t\tthis.handleDeleteClick(false);\r\n\t}\r\n\r\n\thandleDeleteClick(dir: boolean) : void {\r\n\t\tconst button = this.el.querySelector(this.options.deleteElement);\r\n\r\n\t\tbutton?.[dir ? 'addEventListener' : 'removeEventListener']('click', this.onDeleteClick);\r\n\t}\r\n\r\n\tonDeleteClick = () => {\r\n\t\tthis.field.delete(this);\r\n\t}\r\n\r\n\tresolveAttribute() : void {\r\n\t\tif (this.options.attribute != null) { return; }\r\n\r\n\t\tconst element = this.el.querySelector(this.options.attributeElement);\r\n\r\n\t\tthis.options.attribute = (element instanceof HTMLInputElement ? element.value : element.textContent).trim();\r\n\t}\r\n\r\n\tbootSuggest() : void {\r\n\t\tconst element = this.el.querySelector(this.options.valueElement);\r\n\r\n\t\tthis.suggest = new Suggest(this, element, {\r\n\t\t\ttransport: this.options.transport,\r\n\t\t\tstate: this.options.state,\r\n\t\t\tattribute: this.options.attribute,\r\n\t\t\tvalues: () => this.collectValues(),\r\n\t\t});\r\n\t}\r\n\r\n\tautoload() : void {\r\n\t\t// noinspection JSIgnoredPromiseFromCall\r\n\t\tthis.load();\r\n\t}\r\n\r\n\tload() : Promise {\r\n\t\treturn this.suggest.load();\r\n\t}\r\n\r\n\tcollectValues() : Object {\r\n\t\treturn this.field.values(this);\r\n\t}\r\n\r\n\tattribute() : string {\r\n\t\treturn this.options.attribute;\r\n\t}\r\n\r\n\tredraw(variants: Array) : void {\r\n\t\tthis.suggest.redraw(variants);\r\n\t}\r\n\r\n\tvalue() : string {\r\n\t\treturn this.suggest.selected();\r\n\t}\r\n\r\n\trefresh() : void {\r\n\t\tthis.field.refresh(this);\r\n\t}\r\n\r\n\tallowDelete() : void {\r\n\t\tconst button = this.el.querySelector(this.options.deleteElement);\r\n\t\tif (button === null) { return; }\r\n\r\n\t\tbutton.disabled = false;\r\n\t}\r\n\r\n\tdisableDelete() : void {\r\n\t\tconst button = this.el.querySelector(this.options.deleteElement);\r\n\t\tif (button === null) { return; }\r\n\r\n\t\tbutton.disabled = true;\r\n\t}\r\n}","import {Transport} from \"./transport\";\r\n\r\nexport class Attributes {\r\n\r\n\tstatic defaults = {\r\n\t\ttransport: null,\r\n\t\tstate: null,\r\n\t\tlang: {\r\n\t\t\tERROR_ATTRIBUTE: 'No next attributes'\r\n\t\t},\r\n\t\tonChoose: () => {},\r\n\t};\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis._state = this.options.state;\r\n\t\tthis._menu = null;\r\n\t}\r\n\r\n\tsuggest(values: Object) : void {\r\n\t\tthis._state?.loading()\r\n\t\tthis.disableButton();\r\n\r\n\t\treturn this.query(values)\r\n\t\t\t.then((attributes) => this.render(attributes))\r\n\t\t\t.then(() => {\r\n\t\t\t\tthis.enableButton();\r\n\t\t\t\tthis._state?.waiting()\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\tthis.enableButton();\r\n\t\t\t\tthis._state?.error(error)\r\n\t\t\t});\r\n\t}\r\n\r\n\tquery(values: Object) : Promise {\r\n\t\treturn this.transport().fetch('attributes', {\r\n\t\t\tvalues: values,\r\n\t\t});\r\n\t}\r\n\r\n\ttransport() : Transport {\r\n\t\tconst option = this.options.transport;\r\n\r\n\t\tif (!(option instanceof Transport)) {\r\n\t\t\tthrow new Error('transport must be instance of Transport');\r\n\t\t}\r\n\r\n\t\treturn option;\r\n\t}\r\n\r\n\trender(attributes: Array) : void {\r\n\t\tif (attributes.length === 0) { throw new Error(this.options.lang['ERROR_ATTRIBUTE']); }\r\n\r\n\t\tconst menu = this.menu();\r\n\t\tconst items = this.menuItems(attributes);\r\n\r\n\t\tmenu.setItems(items);\r\n\t\tmenu.Show();\r\n\t}\r\n\r\n\tselect(attribute: string) : void {\r\n\t\tthis.options.onChoose(attribute);\r\n\t}\r\n\r\n\tmenu() : BX.CMenu {\r\n\t\tif (this._menu == null) {\r\n\t\t\tthis._menu = new BX.CMenu({\r\n\t\t\t\tparent: this.el,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this._menu;\r\n\t}\r\n\r\n\tmenuItems(attributes: Array) : Array {\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const attribute of attributes) {\r\n\t\t\tresult.push({\r\n\t\t\t\tTEXT: attribute,\r\n\t\t\t\tONCLICK: () => { this.select(attribute); }\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tdisableButton() : void {\r\n\t\tthis.el.disabled = true;\r\n\t}\r\n\r\n\tenableButton() : void {\r\n\t\tthis.el.disabled = false;\r\n\t}\r\n}","export class Behavior {\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\t// noinspection JSUnusedLocalSymbols\r\n\tvalues(action: string, data: Object) : Object {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\tform() : HTMLElement {\r\n\t\tconst form = this.el.closest('form');\r\n\r\n\t\tif (form == null) { throw new Error('cant find form'); }\r\n\r\n\t\treturn form;\r\n\t}\r\n\r\n\tformInput(form: HTMLElement, name: string) {\r\n\t\treturn form.querySelector(`[name^=\"${name}\"]`);\r\n\t}\r\n\r\n\tinputValue(form: HTMLElement, name: string) : ?string {\r\n\t\treturn this.formInput(form, name)?.value;\r\n\t}\r\n\r\n\tselectValue(form: HTMLElement, name: string) : ?Array {\r\n\t\tconst select = this.formInput(form, name);\r\n\r\n\t\tif (select == null) { return null; }\r\n\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const option of select.querySelectorAll('option')) {\r\n\t\t\tif (!option.selected) { continue; }\r\n\r\n\t\t\tresult.push(option.value);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n}","import {Behavior} from \"./behavior\";\r\n\r\nexport class Element extends Behavior {\r\n\r\n\tstatic defaults = {\r\n\t\tname: null,\r\n\t}\r\n\r\n\tvalues(action: string, data: Object) : Object {\r\n\t\tconst form = this.form();\r\n\r\n\t\treturn {\r\n\t\t\tvalue: this.inputValue(form, this.options.name),\r\n\t\t};\r\n\t}\r\n\r\n}","import {Behavior} from \"./behavior\";\r\n\r\nexport class Section extends Behavior {\r\n\r\n\tstatic defaults = {\r\n\t\tprimaryName: null,\r\n\t\tselectName: null,\r\n\t\tiblockId: null,\r\n\t\tproperty: null,\r\n\t}\r\n\r\n\tvalues(action: string, data: Object) : Object {\r\n\t\tconst form = this.form();\r\n\r\n\t\treturn {\r\n\t\t\tiblockSectionId: this.inputValue(form, this.options.primaryName) ?? 0,\r\n\t\t\tiblockSection: this.selectValue(form, this.options.selectName) ?? [],\r\n\t\t\tiblockId: this.options.iblockId,\r\n\t\t\tproperty: this.options.property,\r\n\t\t};\r\n\t}\r\n\r\n}","import {Behavior} from \"./behavior\";\r\n\r\nexport class ProductElement extends Behavior {\r\n\r\n\tstatic defaults = {\r\n\t\tskuName: null,\r\n\t\tskuIblockId: null,\r\n\t\tproperty: null,\r\n\t}\r\n\r\n\tvalues(action: string, data: Object) : Object {\r\n\t\tconst form = this.form();\r\n\r\n\t\treturn {\r\n\t\t\tsku: this.inputValue(form, this.options.skuName),\r\n\t\t\tskuIblockId: this.options.skuIblockId,\r\n\t\t\tproperty: this.options.property,\r\n\t\t};\r\n\t}\r\n\r\n}","import {Behavior} from \"./behavior\";\r\n\r\nexport class ProductSection extends Behavior {\r\n\r\n\tstatic defaults = {\r\n\t\tskuName: null,\r\n\t\tskuIblockId: null,\r\n\t\tproperty: null,\r\n\t}\r\n\r\n\tvalues(action: string, data: Object) : Object {\r\n\t\tconst form = this.form();\r\n\r\n\t\treturn {\r\n\t\t\tsku: this.inputValue(form, this.options.skuName),\r\n\t\t\tskuIblockId: this.options.skuIblockId,\r\n\t\t\tproperty: this.options.property,\r\n\t\t};\r\n\t}\r\n\r\n}","import {Behavior} from \"./behavior\";\r\n\r\nexport class MassiveEdit extends Behavior {\r\n\r\n\tstatic defaults = {\r\n\t\tname: null,\r\n\t}\r\n\r\n\tvalues(action: string, data: Object) : Object {\r\n\t\tconst form = this.form();\r\n\r\n\t\treturn {\r\n\t\t\tvalue: this.inputValue(form, this.options.name),\r\n\t\t};\r\n\t}\r\n\r\n}","import {Element} from \"./element\";\r\nimport {Section} from \"./section\";\r\nimport {ProductElement} from \"./productelement\";\r\nimport {ProductSection} from \"./productsection\";\r\nimport {MassiveEdit} from \"./massiveedit\";\r\nimport {Behavior} from \"./behavior\";\r\n\r\nexport class Factory {\r\n\r\n\tstatic make(type: string, element: HTMLElement, options: Object) : Behavior {\r\n\t\tif (type === 'element') {\r\n\t\t\treturn new Element(element, options);\r\n\t\t} else if (type === 'section') {\r\n\t\t\treturn new Section(element, options);\r\n\t\t} else if (type === 'productElement') {\r\n\t\t\treturn new ProductElement(element, options);\r\n\t\t} else if (type === 'productSection') {\r\n\t\t\treturn new ProductSection(element, options);\r\n\t\t} else if (type === 'massiveEdit') {\r\n\t\t\treturn new MassiveEdit(element, options);\r\n\t\t} else {\r\n\t\t\tthrow new Error('unknown form category type');\r\n\t\t}\r\n\t}\r\n\r\n}","// @flow\r\n\r\nimport {Transport} from \"./transport\";\r\nimport {State} from \"./state\";\r\nimport {Item} from \"./item\";\r\nimport {Attributes} from \"./attributes\";\r\nimport {compileTemplate, htmlToElement} from \"./utils\";\r\nimport {Factory as FormCategory} from \"./formcategory/factory\";\r\n\r\nimport \"./field.css\";\r\n\r\nexport class Field {\r\n\r\n\tstatic defaults = {\r\n\t\tcomponent: null,\r\n\t\tcategoryOptions: [],\r\n\t\tlang: {},\r\n\r\n\t\tvalueName: null,\r\n\t\tattributeName: null,\r\n\r\n\t\titemElement: 'tr',\r\n\t\titemTemplate:\r\n\t\t\t'<tr>' +\r\n\t\t\t\t'<td class=\"bx-avito-export-characteristic__label\"><input type=\"hidden\" name=\"#ATTRIBUTE_NAME#\" value=\"#ATTRIBUTE_VALUE#\" data-entity=\"attribute\" />#ATTRIBUTE_VALUE#</td>' +\r\n\t\t\t\t'<td class=\"bx-avito-export-characteristic__value\" data-entity=\"value\"><select class=\"bx-avito-export-characteristic__value-control\" name=\"#VALUE_NAME#\"></select></td>' +\r\n\t\t\t\t'<td class=\"bx-avito-export-characteristic__actions\"><button class=\"bx-avito-export-characteristic__delete\" type=\"button\" data-entity=\"delete\">#DELETE_TITLE#</button></td>' +\r\n\t\t\t'</tr>',\r\n\r\n\t\taddElement: 'input[type=\"button\"]',\r\n\t};\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, this.nodeOptions(), options);\r\n\t\tthis._attributes = null;\r\n\t\tthis._newIndex = 0;\r\n\t\tthis._transport = new Transport(this.options.component);\r\n\t\tthis._transport.middleware(this.transportCategory);\r\n\t\tthis._state = new State(this.addButton(), { lang: this.options.lang });\r\n\r\n\t\tthis.boot();\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tnodeOptions() : Object {\r\n\t\tconst result = {};\r\n\r\n\t\tfor (const key in this.el.dataset) {\r\n\t\t\tif (!this.el.dataset.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tlet value = this.el.dataset[key];\r\n\r\n\t\t\tif (value === 'true') {\r\n\t\t\t\tvalue = true;\r\n\t\t\t} else if (value === 'false') {\r\n\t\t\t\tvalue = false;\r\n\t\t\t} else if (value.indexOf('{') === 0 || value.indexOf('[') === 0) {\r\n\t\t\t\tvalue = JSON.parse(value);\r\n\t\t\t}\r\n\r\n\t\t\tresult[key] = value;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tdestroy() : void {\r\n\t\tthis.unbind();\r\n\t}\r\n\r\n\tbind() : void {\r\n\t\tthis.handleAddClick(true);\r\n\t}\r\n\r\n\tunbind() : void {\r\n\t\tthis.handleAddClick(false);\r\n\t}\r\n\r\n\thandleAddClick(dir: boolean) : void {\r\n\t\tconst button = this.addButton();\r\n\r\n\t\tif (button == null || !button.matches(this.options.addElement)) { return; }\r\n\r\n\t\tbutton[dir ? 'addEventListener' : 'removeEventListener']('click', this.onAddClick);\r\n\t}\r\n\r\n\tonAddClick = (evt) => {\r\n\t\tconst values = this.values();\r\n\r\n\t\tthis.attributes(evt.target).suggest(values);\r\n\t}\r\n\r\n\tboot() : void {\r\n\t\tconst elements = this.el.querySelectorAll(this.options.itemElement);\r\n\t\tconst items = [];\r\n\r\n\t\tfor (const element of elements) {\r\n\t\t\titems.push(new Item(this, element, this.itemDefaults()));\r\n\t\t}\r\n\r\n\t\tthis.items = items;\r\n\t}\r\n\r\n\ttransportCategory = (action: string, data: Object) : Object => {\r\n\t\tconst partials = [];\r\n\r\n\t\tfor (const options of this.options.categoryOptions) {\r\n\t\t\tconst behavior = FormCategory.make(options.type, this.el, options);\r\n\t\t\tconst values = Object.assign({}, { type: options.type }, behavior.values(action, data));\r\n\r\n\t\t\tpartials.push(values);\r\n\t\t}\r\n\r\n\t\treturn Object.assign({}, data, {\r\n\t\t\tcategory: partials,\r\n\t\t});\r\n\t}\r\n\r\n\tattributes(anchor: HTMLElement) : Attributes {\r\n\t\tif (this._attributes != null) { return this._attributes; }\r\n\r\n\t\tthis._attributes = new Attributes(anchor, {\r\n\t\t\ttransport: this._transport,\r\n\t\t\tstate: this._state,\r\n\t\t\tlang: this.options.lang,\r\n\t\t\tonChoose: (attribute) => this.add(attribute),\r\n\t\t});\r\n\r\n\t\treturn this._attributes;\r\n\t}\r\n\r\n\tadd(attribute: string) : Item {\r\n\t\tconst item = this.createItem(attribute);\r\n\r\n\t\titem.autoload();\r\n\t\tthis.reflowDelete();\r\n\t}\r\n\r\n\tcreateItem(attribute: string) {\r\n\t\tconst index = 'n' + (++this._newIndex);\r\n\t\tconst html = compileTemplate(this.options.itemTemplate, this.itemVariables(attribute, index));\r\n\t\tconst element = htmlToElement(html, 'table');\r\n\t\tconst item = new Item(this, element, Object.assign({}, this.itemDefaults(), {\r\n\t\t\tattribute: attribute,\r\n\t\t}));\r\n\r\n\t\tthis.el.insertAdjacentElement('beforeend', element);\r\n\t\tthis.items.push(item);\r\n\r\n\t\treturn item;\r\n\t}\r\n\r\n\titemVariables(attribute: string, index: string) : Object {\r\n\t\treturn {\r\n\t\t\tDELETE_TITLE: this.options.lang['DELETE'] ?? '',\r\n\t\t};\r\n\t}\r\n\r\n\titemDefaults() : Object {\r\n\t\treturn {\r\n\t\t\ttransport: this._transport,\r\n\t\t\tstate: this._state,\r\n\t\t\tlang: this.options.lang,\r\n\t\t};\r\n\t}\r\n\r\n\tdeleteOnChange(item: Item) : Number {\r\n\t\tlet index = this.items.indexOf(item);\r\n\t\tthis.delete(item);\r\n\t\treturn index--;\r\n\t}\r\n\r\n\tdelete(item: Item) : void {\r\n\t\tthis.destroyItem(item);\r\n\t\tthis.reflowDelete();\r\n\t\tthis._state?.waiting();\r\n\t}\r\n\r\n\tdestroyItem(item: Item) : void {\r\n\t\tconst index = this.items.indexOf(item);\r\n\r\n\t\tif (index === -1) { throw new Error('unknown item'); }\r\n\r\n\t\titem.el.remove();\r\n\t\titem.destroy();\r\n\r\n\t\tthis.items.splice(index, 1);\r\n\t}\r\n\r\n\treflowDelete() : void {\r\n\t\tconst count = this.items.length;\r\n\t\tlet index = 0;\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\tif (index === count - 1) {\r\n\t\t\t\titem.allowDelete();\r\n\t\t\t} else {\r\n\t\t\t\titem.disableDelete();\r\n\t\t\t}\r\n\r\n\t\t\t++index;\r\n\t\t}\r\n\t}\r\n\r\n\tvalues(until: Item = null) : Object {\r\n\t\tconst result = {};\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\tif (until === item) { break; }\r\n\r\n\t\t\tresult[item.attribute()] = item.value();\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\taddButton() : HTMLElement {\r\n\t\treturn this.el.nextElementSibling;\r\n\t}\r\n\r\n\trefresh(from: Item) : void {\r\n\t\tthis._transport\r\n\t\t\t.fetch('refresh', {\r\n\t\t\t\tvalues: this.values(),\r\n\t\t\t\tfrom: from.attribute(),\r\n\t\t\t})\r\n\t\t\t.then((data) => {\r\n\t\t\t\tlet isFromFound = false;\r\n\t\t\t\tlet iterable = new Map(this.items.map((valueMap, indexMapx) => {\r\n\t\t\t\t\treturn [indexMapx, valueMap];\r\n\t\t\t\t}));\r\n\r\n\t\t\t\tfor (let [index, item] of iterable) {\r\n\t\t\t\t\tif (item === from) {\r\n\t\t\t\t\t\tisFromFound = true;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!isFromFound) { continue; }\r\n\r\n\t\t\t\t\tconst attribute = item.attribute();\r\n\r\n\t\t\t\t\tif (typeof data[attribute] === 'undefined') {\r\n\t\t\t\t\t\tindex = this.deleteOnChange(item);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titem.redraw(data[attribute] ?? false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\tthis._state.error(error);\r\n\t\t\t});\r\n \t}\r\n}\r\n","import {Field} from \"./field\";\r\n\r\nexport class MultipleField extends Field {\r\n\r\n\tstatic defaults = Object.assign({}, Field.defaults, {\r\n\t\titemTemplate:\r\n\t\t\t'<tr>' +\r\n\t\t\t\t'<td class=\"bx-avito-export-characteristic__label\"><input type=\"hidden\" name=\"#ATTRIBUTE_NAME#\" value=\"#ATTRIBUTE_VALUE#\" data-entity=\"attribute\" />#ATTRIBUTE_VALUE#</td>' +\r\n\t\t\t\t'<td class=\"bx-avito-export-characteristic__value\" data-entity=\"value\"><select class=\"bx-avito-export-characteristic__value-control\" name=\"#VALUE_NAME#\"></select></td>' +\r\n\t\t\t\t'<td class=\"bx-avito-export-characteristic__actions\"><button class=\"bx-avito-export-characteristic__delete\" type=\"button\" data-entity=\"delete\">#DELETE_TITLE#</button></td>' +\r\n\t\t\t'</tr>',\r\n\t})\r\n\r\n\titemVariables(attribute: string, index: string): Object {\r\n\t\treturn Object.assign({}, super.itemVariables(attribute), {\r\n\t\t\tATTRIBUTE_NAME: `${this.options.attributeName}[${index}][DESCRIPTION]`,\r\n\t\t\tATTRIBUTE_VALUE: attribute,\r\n\t\t\tVALUE_NAME: `${this.options.valueName}[${index}][VALUE]`,\r\n\t\t});\r\n\t}\r\n\r\n}","import {Field} from \"./field\";\r\n\r\nexport class SingleField extends Field {\r\n\r\n\tstatic defaults = Object.assign({}, Field.defaults, {\r\n\t\titemTemplate:\r\n\t\t\t'<tr>' +\r\n\t\t\t\t'<td class=\"bx-avito-export-characteristic__label\" data-entity=\"attribute\">#ATTRIBUTE_VALUE#</td>' +\r\n\t\t\t\t'<td class=\"bx-avito-export-characteristic__value\" data-entity=\"value\"><select class=\"bx-avito-export-characteristic__value-control\" name=\"#VALUE_NAME#\"></select></td>' +\r\n\t\t\t\t'<td class=\"bx-avito-export-characteristic__actions\"><button class=\"bx-avito-export-characteristic__delete\" type=\"button\" data-entity=\"delete\">#DELETE_TITLE#</button></td>' +\r\n\t\t\t'</tr>',\r\n\t})\r\n\r\n\titemVariables(attribute: string, index: string): Object {\r\n\t\treturn Object.assign({}, super.itemVariables(attribute), {\r\n\t\t\tATTRIBUTE_VALUE: attribute,\r\n\t\t\tVALUE_NAME: `${this.options.valueName}[${attribute}]`,\r\n\t\t});\r\n\t}\r\n\r\n}"],"names":["Transport","constructor","component","_middleware","middleware","callback","push","fetch","action","data","Promise","resolve","reject","BX","ajax","runComponentAction","this","mode","prepare","then","response","status","Error","message","catch","queryError","Array","isArray","errors","length","error","compileTemplate","template","variables","result","key","value","Object","entries","marker","previousPosition","position","replace","indexOf","htmlToElement","html","tag","renderer","document","createElement","innerHTML","firstElementChild","State","element","options","el","assign","defaults","_stateHolder","loading","state","waiting","reason","MESSAGE","type","vars","holder","stateHolder","markTypeClass","replaceHtml","lang","states","classList","add","remove","stateTemplate","after","loadingTemplate","waitingTemplate","errorTemplate","LOADING","Suggest","item","onFocus","load","onChange","hasVariants","normalize","refresh","_stored","_variants","_state","bind","handleInput","unbind","dir","input","handleFocus","handleChange","values","isChanged","store","clear","query","variants","render","release","keys","stored","compare","transport","attribute","option","tagName","_input$tagName","toLowerCase","querySelectorAll","forEach","selected","redraw","selectHtml","inputHtml","selector","newInput","insertAdjacentElement","matches","redrawControl","replaceControl","setInputValue","selectTemplate","OPTIONS","map","variant","util","htmlspecialchars","join","inputTemplate","querySelector","selectElement","inputElement","_this$input","contents","trim","name","className","current","matched","first","second","Item","field","onDeleteClick","delete","resolveAttribute","bootSuggest","destroy","handleDeleteClick","button","deleteElement","attributeElement","HTMLInputElement","textContent","valueElement","suggest","collectValues","autoload","allowDelete","disabled","disableDelete","Attributes","_menu","disableButton","attributes","enableButton","menu","items","menuItems","setItems","Show","select","onChoose","CMenu","parent","TEXT","ONCLICK","ERROR_ATTRIBUTE","Behavior","form","closest","formInput","inputValue","_this$formInput","selectValue","Element","Section","iblockSectionId","primaryName","iblockSection","selectName","iblockId","property","ProductElement","sku","skuName","skuIblockId","ProductSection","MassiveEdit","Factory","Field","onAddClick","evt","target","transportCategory","partials","categoryOptions","behavior","FormCategory","make","category","nodeOptions","_attributes","_newIndex","_transport","addButton","boot","dataset","hasOwnProperty","JSON","parse","handleAddClick","addElement","elements","itemElement","itemDefaults","anchor","createItem","reflowDelete","index","itemTemplate","itemVariables","DELETE_TITLE","deleteOnChange","destroyItem","splice","count","until","nextElementSibling","from","isFromFound","iterable","Map","valueMap","indexMapx","valueName","attributeName","MultipleField","super","ATTRIBUTE_NAME","ATTRIBUTE_VALUE","VALUE_NAME","SingleField"],"mappings":"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"}