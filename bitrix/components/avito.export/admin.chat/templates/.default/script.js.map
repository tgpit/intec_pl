{"version":3,"file":"script.js","sources":["src/store.js","src/components/chatlistelement.js","src/components/loaders/loaderlist.js","src/components/loaders/loaderscroll.js","src/errors.js","src/ajax.js","src/misc/svg.js","src/components/app.js","src/components/chatlist.js","src/components/chatarea.js","src/components/messages.js","src/components/message.js","src/components/quote.js","src/components/message/imagemessage.js","src/components/message/linkmessage.js","src/components/message/locationmessage.js","src/components/message/actions.js","src/components/loaders/loadermessages.js","src/components/scrollbutton.js","src/components/emptymessages.js","src/components/input.js","src/components/chatheader.js","src/components/error.js"],"sourcesContent":["export const store = window.AvitoVue3.reactive({\n    component: String,\n    setupId: String,\n    userId: String,\n\tchats: [],\n\tselectChat: [],\n    messages: [],\n\terror: null,\n    chatId: null,\n\tchat: null,\n\totherUserUrl: String,\n    isMessagesLoading: true,\n\tshowError: false,\n    messageMenuId: null,\n    limitChat: 50,\n    offsetChat: 0,\n    limitMessage: 50,\n    offsetMessage: 0,\n\tisLoadingMessageScroll: false,\n\tstopMessageScroll: false,\n\tscrollButton: false,\n\tscrollButtonCircle: false,\n\tcheckMessagesSending: false,\n\n    unshiftMessage(message) {\n\t\tif (this.messages.length > 0) {\n\t\t\tconst firstMessage = this.messages[0];\n\t\t\tmessage.rendering_avatar = firstMessage.author_id !== message.author_id;\n\t\t\tmessage.delimiter = false;\n\t\t}\n        this.messages.unshift(message);\n    },\n\tpushChatMessage(message, read = true) {\n\t\tthis.chats[message.chat_id].updated = message.created;\n\t\tthis.chats[message.chat_id].read = read;\n\t\tthis.chats[message.chat_id].message = message.chat_message.text;\n\t},\n\tpushMessages(messages) {\n\t\tconst firstMessage = messages[0];\n\t\tconst lastMessage = this.messages[this.messages.length - 1];\n\t\tlastMessage.rendering_avatar = lastMessage.author_id !== firstMessage.author_id;\n\n\t\tfor (let message of messages) {\n\t\t\tif (lastMessage.delimiter === message.delimiter) {\n\t\t\t\tlastMessage.delimiter = false;\n\t\t\t}\n\t\t\tthis.messages.push(message);\n\t\t}\n\t},\n\treadMessages() {\n\t\tstore.messages.forEach((message, index) => {\n\t\t\tif (!message.isRead) {\n\t\t\t\tstore.messages[index].isRead = true;\n\t\t\t}\n\t\t});\n\t},\n\tpushChats(chat) {\n\t\tthis.chats.push(chat);\n\t},\n\tdeleteError() {\n\t\tthis.error = null;\n\t},\n\tpushError(error) {\n\t\tthis.error = error;\n\t},\n\tsortMessages() {\n\t\tstore.messages.sort((a, b) => {\n\t\t\treturn b.created - a.created;\n\t\t});\n\t},\n\tsortChats() {\n\t\tconst keys = Object.keys(this.chats);\n\t\tlet sortedObj = {};\n\n\t\tkeys.sort((a, b) => {\n\t\t\treturn this.chats[b].updated - this.chats[a].updated;\n\t\t});\n\n\t\tkeys.forEach((key) => {\n\t\t\tsortedObj[key] = this.chats[key];\n\t\t});\n\n\t\tthis.chats = sortedObj;\n\t},\n    setMessages(messages) {\n        this.messages = messages;\n    },\n    setChatId(chatId) {\n        this.chatId = chatId;\n\t\tthis.chat = this.chats[this.chatId];\n\t\tfor (const userId in this.chat.users) {\n\t\t\tif (parseInt(userId) === this.userId) { continue; }\n\t\t\tthis.otherUserUrl = this.chat.users[userId].url;\n\t\t}\n    },\n\tsetShowError(bool) {\n\t\tthis.showError = bool;\n\t},\n\tauthor(authorId) {\n\t\tif (authorId <= 0) { return null; }\n\t\treturn this.chats[this.chatId]?.users[authorId];\n\t},\n\tclearDataForMessages() {\n\t\tthis.isLoadingMessageScroll = false;\n\t\tthis.stopMessageScroll = false;\n\t\tthis.scrollButtonCircle = false;\n\t\tthis.offsetMessage = 0;\n\t},\n})","import {store} from \"../store\";\n\nconst ChatListElement = {\n    props: ['chatInfo'],\n    setup() {\n        return { store };\n    },\n    // language=Vue\n    template: `\n          <div class=\"avito-chat-list-element\" :class=\"chatInfo.id === store.chatId ? 'avito-chat-list-element-selected' : ''\" :data-chat-id=\"chatInfo.id\">\n          \t\t<div class=\"avito-chat-context-preview-root\">\n\t\t          <div :style=\"{ backgroundImage: 'url(' + chatInfo.img + ')' }\"></div>\n\t            </div>\n\t            <div :class=\"'avito-chat-channel-preview-info ' + (chatInfo.type !== 'system' ? chatInfo.direction : '') + (chatInfo.read ? ' read' : '')\">\n\t              <div class=\"avito-chat-name\">{{ chatInfo.name }}</div>\n\t              <div class=\"avito-chat-title\">{{ chatInfo.title }}</div>\n\t              <div class=\"avito-chat-last-message\">{{ chatInfo.message }}</div>\n\t            </div>\n          </div>\n    `\n};\n\nexport { ChatListElement };","const LoaderList = {\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"avito-chat-list-element\" \n\t\t     v-for=\"(n, index) in 5\"\n             :key=\"index\">\n\t\t\t<div class=\"avito-chat-context-preview-root\">\n\t\t\t\t<div class=\"avito-chat-list-loading\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"avito-chat-channel-preview-info\">\n\t\t\t\t<div class=\"avito-chat-name avito-chat-list-loading\"></div>\n\t\t\t\t<div class=\"avito-chat-title avito-chat-list-loading\"></div>\n\t\t\t\t<div class=\"avito-chat-last-message avito-chat-list-loading\"></div>\n\t\t\t</div>\n\t\t</div>\n    `\n};\n\nexport { LoaderList };\n","const LoaderScroll = {\n\tmounted() {\n\t\tconst element = document.querySelector('.avito-chat-preloader-circle-row');\n\t\telement.scrollIntoView({ block: 'nearest', inline: 'nearest' });\n\t},\n\t// language=Vue\n\ttemplate: `\n\t  <div class=\"avito-chat-preloader-circle-row\">\n      \t<div class=\"avito-chat-preloader-circle avito-chat-preloader-circle-rotate\"></div>\n      </div>\n    `\n};\n\nexport { LoaderScroll };\n","import {store} from \"./store\";\n\nexport class Errors {\n    static check(response) {\n        const data = response.data;\n\n        if (data.status === 'error') {\n            store.pushError(data.message);\n            return;\n        }\n\n        return response.data.data;\n    }\n}","import {store} from \"./store\";\nimport {Errors} from \"./errors\";\n\nexport class Ajax {\n    static async chats() {\n        return await BX.ajax.runComponentAction(store.component, 'chats', {\n            data: {\n                setupId: store.setupId,\n                userId: store.userId,\n\t            limit: store.limitChat,\n                offset: store.offsetChat,\n            },\n        }).then(response => { return Errors.check(response) });\n    }\n\n\tstatic async chatById(chatId) {\n\t\treturn await BX.ajax.runComponentAction(store.component, 'chatById', {\n\t\t\tdata: {\n\t\t\t\tsetupId: store.setupId,\n\t\t\t\tuserId: store.userId,\n\t\t\t\tchatId: chatId,\n\t\t\t},\n\t\t}).then(response => { return Errors.check(response) });\n\t}\n\n    static async messagesByChatId(chatId) {\n        return await BX.ajax.runComponentAction(store.component, 'messagesByChatId', {\n            data: {\n                setupId: store.setupId,\n                userId: store.userId,\n                chatId: chatId,\n\t            limit: store.limitMessage,\n\t            offset: store.offsetMessage,\n            },\n        }).then(response => { return Errors.check(response) });\n    }\n\n    static async sendMessage(message) {\n        return await BX.ajax.runComponentAction(store.component, 'sendMessage', {\n            data: {\n                setupId: store.setupId,\n                userId: store.userId,\n                chatId: store.chatId,\n                message: message,\n            },\n        }).then(response => { return Errors.check(response) });\n    }\n\n\tstatic async readChat(chatId) {\n        return await BX.ajax.runComponentAction(store.component, 'readChat', {\n            data: {\n                setupId: store.setupId,\n                userId: store.userId,\n                chatId: chatId,\n            },\n        }).then(response => { return Errors.check(response) });\n    }\n\n    static async deleteMessage(messageId) {\n        return await BX.ajax.runComponentAction(store.component, 'deleteMessage', {\n            data: {\n                setupId: store.setupId,\n                userId: store.userId,\n                chatId: store.chatId,\n                messageId: messageId,\n            },\n        }).then(response => { return Errors.check(response) });\n    }\n\n\tstatic async checkNewMessage() {\n\t\treturn await BX.ajax.runComponentAction(store.component, 'checkNewMessages', {\n\t\t\tdata: {\n\t\t\t\tsetupId: store.setupId,\n                checkTimestamp: store.checkTimestamp,\n\t\t\t},\n\t\t}).then(response => { return Errors.check(response) });\n\t}\n}","const svg = {\n    'quote-link': '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" style=\"width: 32px; height: 32px; color: currentcolor;\"><path d=\"M6.78564 10.1495L4.26255 12.6726C2.3117 14.6235 2.3117 17.7864 4.26255 19.7373L4.76717 20.2419C6.43933 21.9141 9.15043 21.9141 10.8226 20.2419L13.8503 17.2142M17.2144 13.8501L19.7375 11.327C21.6884 9.37613 21.6884 6.21318 19.7375 4.26233L19.2329 3.75771C17.5607 2.08555 14.8496 2.08555 13.1775 3.75771L10.1498 6.78542M8.2995 15.7003L15.7006 8.29927\" stroke=\"currentColor\" stroke-width=\"1.90303\" stroke-linecap=\"round\"></path></svg>',\n    'quote-video': '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" style=\"width: 32px; height: 32px; color: currentcolor;\"><path d=\"M2 6a1 1 0 0 1 1-1h13a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V6ZM22 8.387v7.226a1 1 0 0 1-1.316.948L17 15.333V8.667l3.684-1.228A1 1 0 0 1 22 8.387Z\" fill=\"currentColor\"></path></svg>',\n    'quote-location': '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" style=\"width: 32px; height: 32px; color: currentcolor;\"><path d=\"M2.649 10.939c-.86-.323-.867-1.536-.011-1.869l18-7c.81-.315 1.61.484 1.294 1.295l-7 18c-.333.856-1.546.848-1.868-.011l-2.84-7.575-7.575-2.84z\" fill=\"currentColor\"></path></svg>',\n    'send-button': '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" style=\"width: 24px; height: 24px; color: currentcolor;\"><path d=\"M22 12a1 1 0 0 1-.574.905l-17 8a1 1 0 0 1-1.39-1.168l1.5-5.5a1 1 0 0 1 .605-.67L9.214 12l-4.073-1.567a1 1 0 0 1-.606-.67l-1.5-5.5a1 1 0 0 1 1.39-1.168l17 8A1 1 0 0 1 22 12Z\" fill=\"currentColor\"></path></svg>',\n};\n\nexport { svg };","import { ChatList } from \"./chatlist\";\nimport { ChatArea } from \"./chatarea\";\nimport { Error } from \"./error\";\nimport { store } from \"../store\";\n\nconst App = {\n    components: {\n        ChatList,\n        ChatArea,\n        Error,\n    },\n    beforeMount() {\n\t\tstore.component = this.component;\n\t\tstore.setupId = this.setupId;\n\t\tstore.userId = this.userId;\n\t\tstore.chatId = this.chatId;\n        store.checkTimestamp = this.checkTimestamp;\n\t},\n    setup() {\n        return { store };\n    },\n\t// language=Vue\n    template: `\n\t\t<ChatList />\n\t\t<ChatArea />\n        <Error />\n    `\n};\n\nexport { App };","import {ChatListElement} from \"./chatlistelement\";\nimport {LoaderList} from \"./loaders/loaderlist\";\nimport {LoaderScroll} from \"./loaders/loaderscroll\";\nimport {store} from \"../store\";\nimport {Ajax} from \"../ajax\";\n\nconst ChatList = {\n    data() {\n        return {\n\t\t\tisLoading: true,\n\t        isLoadingScroll: false,\n\t        stopScroll: false,\n\t        _checkMessagesScheduleTimeout: null,\n\t        _checkMessagesStartFrame: null,\n\t        _checkMessagesStartTimeout: null,\n        }\n    },\n\tcomponents: {\n\t\tChatListElement,\n\t\tLoaderList,\n\t\tLoaderScroll,\n\t},\n\tsetup() {\n\t\treturn { store }\n\t},\n\tmounted(){\n\t\tAjax.chats()\n\t\t\t.then(async chats => {\n\t\t\t\tif (store.chatId !== null) {\n\t\t\t\t\tif (chats[store.chatId] == null) {\n\t\t\t\t\t\tawait Ajax.chatById(store.chatId)\n\t\t\t\t\t\t\t.then(chat => {\n\t\t\t\t\t\t\t\tchats = Object.assign({[store.chatId]: chat}, chats);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tstore.chats = chats;\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.isLoading = false;\n\t\t\t\tif (store.chatId !== null) {\n\t\t\t\t\tstore.setChatId(store.chatId);\n\t\t\t\t\tthis.messagesByChatId(store.chatId);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconst firstChat = Object.keys(store.chats)[0];\n\t\t\t\t\tstore.setChatId(firstChat);\n\t\t\t\t\tthis.messagesByChatId(firstChat);\n\t\t\t\t}\n\t\t\t})\n\t},\n\tmethods: {\n\t\thandleScroll: function(event) {\n\t\t\tconst target = event.currentTarget;\n\t\t\tif (\n\t\t\t\ttarget.offsetHeight + target.scrollTop >= target.scrollHeight\n\t\t\t\t&& !this.isLoadingScroll\n\t\t\t\t&& !this.stopScroll\n\t\t\t) {\n\t\t\t\tstore.offsetChat += store.limitChat;\n\t\t\t\tthis.isLoadingScroll = true;\n\t\t\t\tAjax.chats()\n\t\t\t\t\t.then(data => {\n\t\t\t\t\t\tthis.isLoadingScroll = false;\n\t\t\t\t\t\tif (Object.keys(data).length > 0) {\n\t\t\t\t\t\t\tfor (const [id, chat] of Object.entries(data)) {\n\t\t\t\t\t\t\t\tstore.chats[id] = chat;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tthis.stopScroll = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\tselectChat: function (event) {\n\t\t\tif (store.isMessagesLoading || store.isLoadingMessageScroll || this.isLoadingScroll) { return; }\n\t\t\tconst chatId = event.currentTarget.getAttribute('data-chat-id');\n\t\t\tthis.toggleChat();\n\t\t\tif (store.chatId === chatId) { return; }\n\t\t\tstore.isMessagesLoading = true;\n\t\t\tstore.setChatId(chatId);\n\t\t\tstore.clearDataForMessages();\n\t\t\tthis.messagesByChatId(chatId);\n\t\t},\n\t\ttoggleChat: function() {\n\t\t\tconst list = document.querySelector('.avito-chat-list');\n\t\t\tconst area = document.querySelector('.avito-chat-area');\n\t\t\tlist.classList.replace('show', 'hide');\n\t\t\tarea.classList.replace('hide', 'show');\n\t\t},\n\t\tmessagesByChatId: function(chatId) {\n\t\t\tAjax.messagesByChatId(chatId)\n\t\t\t\t.then(data => {\n\t\t\t\t\tstore.setMessages(data);\n\t\t\t\t\tstore.isMessagesLoading = false;\n\t\t\t\t\tthis.clearCheckMessages();\n\t\t\t\t})\n\t\t\t\t.then(() => Ajax.readChat(chatId).then(data => {store.chats[chatId].read = true;}))\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.scheduleCheckMessages();\n\t\t\t\t});\n\t\t},\n\n\t\tscheduleCheckMessages: function() {\n\t\t\tthis._checkMessagesScheduleTimeout = setTimeout(this.startCheckMessages.bind(this), 10000);\n\t\t},\n\n\t\tstartCheckMessages: function(chatId) {\n\t\t\tthis._checkMessagesStartFrame = requestAnimationFrame(this.checkMessages.bind(this));\n\t\t\tthis._checkMessagesStartTimeout = setTimeout(this.checkMessages.bind(this), 600000);\n\t\t},\n\n\t\tclearCheckMessages: function() {\n\t\t\tclearTimeout(this._checkMessagesScheduleTimeout);\n\t\t\tclearTimeout(this._checkMessagesStartTimeout);\n\t\t\tcancelAnimationFrame(this._checkMessagesStartFrame);\n\t\t},\n\n\t\tcheckMessages: function() {\n\t\t\tthis.clearCheckMessages();\n\n\t\t\tAjax.checkNewMessage()\n\t\t\t\t.then(data => {\n\t\t\t\t\tlet readMessages = false;\n\t\t\t\t\tstore.checkTimestamp = data.checkTimestamp;\n\t\t\t\t\tif (data?.messages != null && data.messages.length > 0) {\n\n\t\t\t\t\t\tfor (let message of data.messages) {\n\n\t\t\t\t\t\t\tlet isOwnMessage = false;\n\n\t\t\t\t\t\t\tfor (let storeMessage of store.messages) {\n\t\t\t\t\t\t\t\tif (storeMessage.id === message.id) {\n\t\t\t\t\t\t\t\t\tisOwnMessage = true;\n\t\t\t\t\t\t\t\t\tstoreMessage.isRead = message.isRead;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!isOwnMessage && store.chatId === message.chat_id) {\n\t\t\t\t\t\t\t\tstore.scrollButtonCircle = true;\n\t\t\t\t\t\t\t\tstore.unshiftMessage(message);\n\t\t\t\t\t\t\t\tstore.pushChatMessage(message);\n\t\t\t\t\t\t\t\tstore.readMessages();\n\t\t\t\t\t\t\t\treadMessages = true;\n\t\t\t\t\t\t\t} else if (store.chats[message.chat_id] == null) {\n\t\t\t\t\t\t\t\tAjax.chatById(message.chat_id)\n\t\t\t\t\t\t\t\t\t.then(chat => {\n\t\t\t\t\t\t\t\t\t\tstore.chats = Object.assign({[message.chat_id]: chat}, store.chats);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t} else if (store.chatId !== message.chat_id) {\n\t\t\t\t\t\t\t\tstore.pushChatMessage(message, false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstore.sortChats();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn readMessages;\n\t\t\t\t})\n\t\t\t\t.then((readMessages) => {\n\t\t\t\t\tif (readMessages) {\n\t\t\t\t\t\tAjax.readChat(store.chatId);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.scheduleCheckMessages();\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tthis.scheduleCheckMessages();\n\t\t\t\t});\n\t\t},\n\t},\n\t// language=Vue\n    template: `\n\t\t<div class=\"avito-chat-list hide\" @scroll=\"handleScroll\">\n\t\t\t<LoaderList v-if=\"isLoading\"/>\n\t\t\t<ChatListElement \n\t\t\t\tv-if=\"!isLoading && store.chats !== null\" \n\t\t\t\tv-for=\"chat in store.chats\" :chatInfo=\"chat\" :key=\"chat.id\" \n\t\t\t\t@click=\"selectChat\"/>\n\t\t\t<LoaderScroll v-if=\"isLoadingScroll\"/>\n\t\t</div>\n    `\n};\n\nexport { ChatList };\n","import {Messages} from \"./messages\";\nimport {Input} from \"./input\";\nimport {ChatHeader} from \"./chatheader\";\nimport {store} from \"../store\";\n\nconst ChatArea = {\n    components: {\n        Messages,\n        Input,\n\t    ChatHeader,\n    },\n\tsetup() {\n\t\treturn { store }\n\t},\n    // language=Vue\n    template: `\n\t\t<div class=\"avito-chat-area show\">\n\t\t\t<ChatHeader v-if=\"store.chat\"/>\n\t\t\t<Messages />\n\t\t\t<Input />\n\t\t</div>\n    `\n};\n\nexport { ChatArea };\n","import {LoaderMessages} from \"./loaders/loadermessages\";\nimport {LoaderScroll} from \"./loaders/loaderscroll\";\nimport {ScrollButton} from \"./scrollbutton\";\nimport {EmptyMessages} from \"./emptymessages\";\nimport {Message} from \"./message\";\nimport {store} from \"../store\";\nimport {Ajax} from \"../ajax\";\n\nconst Messages = {\n    components: {\n        Message,\n        LoaderMessages,\n\t    LoaderScroll,\n\t    ScrollButton,\n\t    EmptyMessages,\n    },\n\tmounted() {\n\t\tdocument.addEventListener('click', this.hideContextMenu);\n\t},\n\tmethods: {\n\t\thandleScroll: function(event) {\n\t\t\tconst target = event.currentTarget;\n\t\t\tconst scrollTop = Math.abs(target.scrollTop);\n\t\t\tstore.scrollButton = scrollTop > 1;\n\t\t\tif (\n\t\t\t\tscrollTop > 1\n\t\t\t\t&& target.offsetHeight + scrollTop >= target.scrollHeight - 10\n\t\t\t\t&& !store.isLoadingMessageScroll\n\t\t\t\t&& !store.stopMessageScroll\n\t\t\t) {\n\n\t\t\t\tstore.offsetMessage += store.limitMessage;\n\t\t\t\tstore.isLoadingMessageScroll = true;\n\t\t\t\tAjax.messagesByChatId(store.chatId)\n\t\t\t\t\t.then(data => {\n\t\t\t\t\t\tstore.isLoadingMessageScroll = false;\n\t\t\t\t\t\tif (data.length > 0) {\n\t\t\t\t\t\t\tstore.pushMessages(data);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstore.stopMessageScroll = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\thideContextMenu: function(event) {\n\t\t\tconst actions = document.querySelector('.avito-chat-message-actions.show');\n\t\t\tif (actions == null || actions.contains(event.target)) { return; }\n\t\t\tactions.classList.remove('show');\n\t\t\tactions.classList.add('hide');\n\t\t\tstore.messageMenuId = null;\n\t\t}\n\t},\n    setup() {\n        return { store }\n    },\n    // language=Vue\n    template: `\n      <div class=\"avito-chat-messages\" @scroll=\"handleScroll\">\n        <LoaderMessages v-if=\"store.isMessagesLoading\"/>\n        <EmptyMessages v-if=\"!store.isMessagesLoading && store.messages.length === 0\"/>\n        <Message \n\t        v-if=\"!store.isMessagesLoading\" \n\t        v-for=\"message in store.messages\" \n\t        :messageData=\"message\" \n\t        :key=\"message.id\" \n\t        :author=\"store.author(message.author_id)\" \n        />\n        <LoaderScroll v-if=\"store.isLoadingMessageScroll\"/>\n      </div>\n      <ScrollButton/>\n    `\n};\n\nexport { Messages };\n","import {Quote} from \"./quote\";\nimport {ImageMessage} from \"./message/imagemessage\";\nimport {LinkMessage} from \"./message/linkmessage\";\nimport {LocationMessage} from \"./message/locationmessage\";\nimport {Actions} from \"./message/actions\";\nimport {store} from \"../store\";\n\nconst Message = {\n    components: {\n        Quote,\n\t    ImageMessage,\n\t    LinkMessage,\n\t    LocationMessage,\n\t    Actions,\n    },\n    props: {\n        messageData: Object,\n\t    author: Object,\n    },\n\tmethods: {\n\t\tcontextMenu: function () {\n\t\t\tif (\n\t\t\t\tstore.messageMenuId === this.messageData.id\n\t\t\t\t&& store.messageMenuId !== null\n\t\t\t) {\n\t\t\t\tstore.messageMenuId = null;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tstore.messageMenuId = this.messageData.id;\n\t\t\t}\n\t\t},\n\t},\n    setup() {\n        return { store };\n    },\n    // language=Vue\n    template: `\n\t\t<div \n\t\t\t:id=\"messageData.id\"\n\t\t\t:class=\"'avito-chat-message-container avito-chat-message-direction-' + messageData.direction + ' avito-chat-message-type-' + messageData.type + (messageData.quote ? ' quote' : '')\">\n\t\t\t<div v-if=\"messageData.rendering_avatar && messageData.type === 'system'\" class=\"avito-chat-message-system-avatar-img\"></div>\n\t\t\t<div v-else-if=\"messageData.rendering_avatar && author !== null\" class=\"avito-chat-message-author\">\n\t\t\t  <a class=\"avito-chat-message-author-avatar\" :href=\"author.url\" target=\"_blank\" >\n\t\t\t    <img :src=author.avatar :alt=\"author.name\" class=\"avito-chat-message-author-avatar-img\">\n\t\t\t    <span class=\"avito-chat-message-author-avatar-char\" v-if=\"author.avatarChar\">{{author.avatarChar}}</span>\n\t\t\t  </a>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class=\"avito-chat-message\">\n              \t<Quote v-if=\"messageData.quote && author !== null\" \n                       :quote=\"messageData.quote\" \n                       :messageType=\"messageData.type\" \n                       :authorName=\"author.name\" \n                />\n\n              \t<span v-if=\"messageData.type === 'text' \n        \t\t\t|| messageData.type === 'deleted' \n        \t\t\t|| messageData.type === 'system'\n        \t\t\t|| messageData.type === 'call'\n        \t\t\t|| messageData.type === 'video'\"\n                      class=\"avito-chat-message-text\">\n\t              <span v-if=\"messageData.type === 'call'\">&#9990; </span>{{ messageData.content.text }}\n                </span>\n\n\t\t\t\t<div v-else-if=\"messageData.type === 'item'\" class=\"avito-chat-message-item\">\n\t\t\t\t\t<a class=\"avito-chat-message-item-link\" :href=\"messageData.content.item.item_url\" target=\"_blank\">\n\t\t\t\t\t  <div class=\"avito-chat-message-item-picture\"\n\t\t\t\t\t       :style=\"'background-image: url(' + messageData.content.item.image_url +')'\">\n\t\t\t\t\t  </div>\n\t\t\t\t\t  <div class=\"avito-chat-message-item-info\">\n\t\t\t\t\t    <div class=\"avito-chat-message-item-info-title\">\n\t\t\t\t\t      {{ messageData.content.item.title }}\n\t\t\t\t\t    </div>\n\t\t\t\t\t    <div class=\"avito-chat-message-item-info-domain\">avito.ru</div>\n\t\t\t\t\t  </div>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\n              \t<ImageMessage v-else-if=\"messageData.type === 'image'\" :content=\"messageData.content.image\" :hasQuote=\"messageData.quote != null\"/>\n              \t<LinkMessage v-else-if=\"messageData.type === 'link'\" :content=\"messageData.content.link\"/>\n              \t<LocationMessage v-else-if=\"messageData.type === 'location'\" :content=\"messageData.content.location\"/>\n\n\t\t\t\t<div :class=\"[\n\t\t\t\t\t\tmessageData.deletable === true ? 'avito-chat-message-status hover' : 'avito-chat-message-status',\n\t\t\t\t\t\tstore.messageMenuId !== messageData.id || store.messageMenuId === null ? 'show' : 'hide',\n\t\t\t\t\t]\">\n\t\t\t\t\t<div class=\"avito-chat-message-status-mark\" v-if=\"messageData.type !== 'deleted' && messageData.direction === 'out'\">\n\t\t\t\t\t  <div class=\"mark\"></div>\n\t\t\t\t\t  <div v-if=\"messageData.isRead\" class=\"mark\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"time\">{{messageData.createdTime}}</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div v-if=\"messageData.deletable === true\" :class=\"'avito-chat-message-actions ' + (store.messageMenuId === messageData.id  ? 'show' : 'hide')\" @click=\"contextMenu\">\n\t\t\t\t\t<div class=\"avito-chat-message-actions-menu\">\n\t\t\t\t\t  <div class=\"avito-chat-message-actions-menu-button\">\n\t\t\t\t\t    <span>\n\t\t\t\t\t      <svg viewBox=\"0 0 18 18\" xmlns=\"http://www.w3.org/2000/svg\"\n                               style=\"width: 24px; height: 24px; color: currentcolor;\">\n\t\t\t\t\t        \t<path fill-rule=\"evenodd\"\n                                clip-rule=\"evenodd\"\n                                d=\"M7.4 9a1.6 1.6 0 113.2 0 1.6 1.6 0 01-3.2 0zM2.067 9a1.6 1.6 0 113.2 0 1.6 1.6 0 01-3.2 0zm10.667 0a1.6 1.6 0 113.2 0 1.6 1.6 0 01-3.2 0z\"\n                                fill=\"currentColor\">\n\t\t\t\t\t\t        </path>\n\t\t\t\t\t      </svg>\n\t\t\t\t\t    </span>\n\t\t\t\t\t  </div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Actions v-if=\"store.messageMenuId === messageData.id\" :message=\"messageData\" />\n\t\t\t\t</div>\n\t\t\t  \n            </div>\n\t\t</div>\n        <div v-if=\"messageData.delimiter\" class=\"avito-chat-message-time-delimiter\">{{ messageData.delimiter }}</div>\n    `\n};\n\nexport { Message };","import {svg} from \"../misc/svg\";\n\nconst Quote = {\n    props: {\n        quote: Object,\n\t    authorName: String,\n\t    messageType: String,\n    },\n\tsetup(props) {\n\t\tconst quote = props.quote;\n\t\tconst type = quote.type;\n\t\tlet text = '';\n\t\tlet image = null;\n\t\tlet isPicture = false;\n\t\tlet icon = svg['quote-' + type];\n\n\t\tif (type === 'text') {\n\t\t\ttext = quote.content.text;\n\t\t} else if (type === 'link') {\n\t\t\ttext = quote.content.link.url;\n\t\t} else if (type === 'image') {\n\t\t\tconst sizes = quote.content.image.sizes;\n\t\t\tconst firstChat = Object.keys(sizes)[0];\n\t\t\timage = sizes[firstChat];\n\t\t\ttext = quote.content.text;\n\t\t\tisPicture = true;\n\t\t} else if (type === 'item') {\n\t\t\timage = quote.content.item.image_url;\n\t\t\ttext = quote.content.item.title;\n\t\t\tisPicture = true;\n\t\t} else if (type === 'location') {\n\t\t\ttext = quote.content.location.text;\n\t\t} else if (type === 'video') {\n\t\t\ttext = quote.content.text;\n\t\t}\n\n\t\treturn { image, text, isPicture, icon }\n\t},\n\tmethods: {\n\t\tscrollToMessage: function(event) {\n\t\t\tconst idScrollElement = this.quote.id;\n\t\t\tconst scrollElement = document.getElementById(idScrollElement);\n\t\t\tif (scrollElement == null) { return; }\n\t\t\tscrollElement.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'nearest' });\n\t\t}\n\t},\n    // language=Vue\n    template: `\n\t\t<div :class=\"'avito-chat-message-quote' + (messageType === 'image' ? ' margin' : '')\" @click=\"scrollToMessage\">\n\t\t\t<div class=\"avito-chat-message-quote-quote-verticalLine\"></div>\n\t\t\t<div v-if=\"icon\" v-html=\"icon\" class=\"avito-chat-message-quote-icon\"></div>\n            <div v-if=\"isPicture\" class=\"avito-chat-massage-quote-image\">\n              <div class=\"avito-chat-massage-quote-image-preview\"\n                   :style=\"image !== null ? 'background-image: url(' + image +');' : ''\">\n              </div>\n            </div>\n            <div class=\"avito-chat-massage-quote-info\">\n              <div class=\"avito-chat-massage-quote-author_name\">{{ authorName }}</div>\n              <div class=\"avito-chat-massage-quote-text\">{{ text }}</div>\n            </div>\n\t\t</div>\n    `\n};\n\nexport { Quote };","const ImageMessage = {\n\tprops: {\n\t\tcontent: Object,\n\t\thasQuote: Boolean,\n\t},\n\tsetup(props){\n\t\tconst keys = Object.keys(props.content.sizes);\n\t\tconst lastIndex = keys.length - 1;\n\t\tconst image = props.content.sizes[keys[lastIndex]];\n\n\t\treturn {\n\t\t\timage\n\t\t}\n\t},\n\tmethods: {\n\t\timageOpen() {\n\t\t\tconst link = this.content.sizes[Object.keys(this.content.sizes)[0]];\n\t\t\twindow.open(link);\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"avito-chat-message-image\" @click=\"imageOpen\">\n\t\t\t<div :class=\"'avito-chat-message-image-preview-wrap' + (hasQuote ? ' quote' : '')\">\n\t\t\t  \t<div class=\"avito-chat-message-image-preview\" \n\t\t\t         :style=\"'background-image: linear-gradient(rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05)), url(' + image +');'\"\n\t\t\t    ></div>\n\t\t\t</div>\n\t\t</div>\n\t`\n}\n\nexport { ImageMessage };","\nconst LinkMessage = {\n\tprops: {\n\t\tcontent: Object,\n\t},\n\tsetup(props){\n\t\tlet previewImage = null;\n\t\tconst content = props.content;\n\n\t\tif (content.preview && content.preview.images)\n\t\t{\n\t\t\tconst keys = Object.keys(content.preview.images);\n\t\t\tpreviewImage = content.preview.images[keys[0]];\n\t\t}\n\n\t\treturn { previewImage }\n\t},\n\t// language=Vue\n\ttemplate: `\n      \t<div v-if=\"content.preview\" class=\"avito-chat-message-link\">\n\t\t\t<a class=\"avito-chat-message-link-link\" :href=\"content.url\" target=\"_blank\">\n\t\t\t  \t<div class=\"avito-chat-message-link-picture\" \n\t\t\t         :style=\"previewImage !== null ? 'background-image: url(' + previewImage +')' : ''\">\n\t\t\t    </div>\n\t\t\t  \t<div class=\"avito-chat-message-link-info\">\n\t\t\t\t  \t<div class=\"avito-chat-message-link-info-title\">\n\t\t\t\t\t  \t{{ content.preview.title }}\n\t\t\t\t    </div>\n\t                <div class=\"avito-chat-message-link-info-domain\">{{ content.preview.domain }}</div>\n\t\t\t    </div>\n\t\t\t</a>\n\t\t</div>\n        <div v-else class=\"avito-chat-message-text-link\">{{ content.text }}</div>\n\t`\n}\n\nexport { LinkMessage };","const LocationMessage = {\n\tprops: {\n\t\tcontent: Object,\n\t},\n\tsetup(props) {\n\t\tlet linkMap = `https://yandex.ru/maps/?pt=${props.content.lon},${props.content.lat}&z=17&l=map`;\n\t\tlet linkImage = `https://static-maps.yandex.ru/1.x/?l=map&pt=${props.content.lon},${props.content.lat},comma&z=14&size=252,190`\n\n\t\treturn { linkMap, linkImage }\n\t},\n\t// language=Vue\n\ttemplate: `\n\t  <div class=\"avito-chat-message-location\">\n\t\t<a :href=\"linkMap\" target=\"_blank\" class=\"avito-chat-message-location-link\" :title=\"content.title\">\n          <div v-if=\"linkImage\" class=\"avito-chat-message-image\">\n            <div :class=\"'avito-chat-message-image-preview-wrap'\">\n              <div class=\"avito-chat-message-image-preview\"\n                   :style=\"'background-image: url(' + linkImage +');'\"\n              ></div>\n            </div>\n          </div>\n\t\t  <div :class=\"'avito-chat-message-location-text' + (linkMap ? ' image' : '')\">{{ content.title }}</div>\n\t\t</a>\n\t  </div>\n\t`\n}\n\nexport { LocationMessage };","import {Ajax} from \"../../ajax\";\nimport {store} from \"../../store\";\n\nconst Actions = {\n    props: {\n        message: Object,\n    },\n\tsetup() {\n\t\treturn { store };\n\t},\n\tcomputed: {\n\t\tlocalize() {\n\t\t\treturn {\n\t\t\t\tTEXT: BX.message(\"MESSAGE_DELETED\"),\n\t\t\t\tTITLE: BX.message(\"MESSAGE_DELETE_TITLE\"),\n\t\t\t}\n\t\t}\n\t},\n    methods: {\n        deleteMessage: function () {\n            Ajax.deleteMessage(this.message.id).then(() => {\n                this.message.content.text = this.localize.TEXT;\n                this.message.type = 'deleted';\n                this.message.deletable = false;\n\t            store.messageMenuId = null;\n            });\n        },\n    },\n\t// language=Vue\n    template: `\n        <div class=\"avito-chat-context-menu\">\n            <button type=\"button\" class=\"avito-chat-menu-item\" @click=\"deleteMessage\">\n              <span>{{ localize.TITLE }}</span>\n            </button>\n        </div>\n    `,\n}\n\nexport { Actions };","const LoaderMessages = {\n    // language=Vue\n    template: `\n\t\t<div class=\"avito-chat-message-container\"\n\t\t     v-for=\"n in 3\"\n             :class=\"n % 2 === 0 ? 'avito-chat-message-direction-out' : 'avito-chat-message-direction-in'\"\n             :key=\"n\">\n            <div class=\"avito-chat-message-loader\">\n              <div class=\"avito-chat-name avito-chat-list-loading\"></div>\n              <div class=\"avito-chat-title avito-chat-list-loading\"></div>\n              <div class=\"avito-chat-last-message avito-chat-list-loading\"></div>\n            </div>\n\t\t</div>\n    `\n};\n\nexport { LoaderMessages };\n","import {store} from \"../store\";\n\nconst ScrollButton = {\n\tmethods: {\n\t\tscrollBottom: function() {\n\t\t\tconst container = document.querySelector('.avito-chat-messages');\n\t\t\tcontainer.scrollTo({ top: 0, behavior: 'smooth' });\n\t\t}\n\t},\n\tsetup() {\n\t\treturn { store }\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div :class=\"'avito-chat-message-history-scroll-button' + (!store.scrollButton ? ' hide' : '')\" @click=\"scrollBottom\">\n\t\t\t<div class=\"avito-chat-message-history-scroll-button-content\">\n\t\t\t\t<svg viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tclass=\"avito-chat-messages-history-scroll-button-icon\"\n\t\t\t\t\tstyle=\"width: 20px; height: 20px;\">\n\t\t\t\t<path\n\t\t\t\t\td=\"M13.138 5.529c.26.26.26.682 0 .943L8.47 11.138a.667.667 0 01-.943 0L2.862 6.472a.667.667 0 11.942-.943L8 9.724l4.195-4.195c.26-.26.682-.26.943 0z\"\n\t\t\t\t\tfill=\"currentColor\"></path>\n\t\t\t\t</svg>\n\t\t\t  \t<div :class=\"'avito-chat-messages-history-scroll-button-circle' + (store.scrollButtonCircle ? ' show' : '')\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`\n};\n\nexport {ScrollButton};\n","const EmptyMessages = {\n\tcomputed: {\n\t\tlocalize() {\n\t\t\treturn {\n\t\t\t\tTITLE: BX.message(\"EMPTY_MESSAGES_TITLE\"),\n\t\t\t}\n\t\t}\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div class=\"avito-chat-empty-messages\">\n\t\t\t<div class=\"avito-chat-empty-messages-placeholder\"></div>\n\t\t\t<div class=\"avito-chat-empty-messages-title\">{{localize.TITLE}}</div>\n\t\t</div>\n    `\n};\n\nexport { EmptyMessages };\n","import {Ajax} from \"../ajax\";\nimport {store} from \"../store\";\nimport {svg} from \"../misc/svg\";\n\nconst Input = {\n    data() {\n\t\treturn {\n\t\t\tmessage: '',\n\t\t}\n\t},\n\tcomputed: {\n\t\tlocalize() {\n\t\t\treturn {\n\t\t\t\tPLACEHOLDER: BX.message(\"MESSAGE_TEXTAREA_PLACEHOLDER\"),\n\t\t\t}\n\t\t}\n\t},\n\tmethods: {\n\t\tpressNewLine(event) {\n\t\t\tif (!event.shiftKey) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t},\n\t\tinputText(event) {\n\t\t\tconst target = event.currentTarget;\n\t\t\tconst currentValue = target.value;\n\n\t\t\tconst styles = window.getComputedStyle(target);\n\t\t\tconst lineHeight = parseInt(styles.getPropertyValue('line-height'), 10);\n\t\t\tconst minHeight = parseInt(styles.getPropertyValue('min-height'), 10);\n\n\t\t\tif (currentValue === '')\n\t\t\t{\n\t\t\t\ttarget.style.height = styles.getPropertyValue('min-height');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst lineBreaks = currentValue.match(/\\r?\\n/g);\n\t\t\tconst lineCount = lineBreaks ? lineBreaks.length : 0;\n\n\t\t\ttarget.style.height = (minHeight + lineHeight * lineCount) + 'px';\n\t\t},\n\t\tsendMessage(event) {\n\t\t\tif (event.shiftKey) { return; }\n\t\t\tif (this.message) {\n\t\t\t\tAjax.sendMessage(this.message.trim()).then(data => {\n\t\t\t\t\tstore.unshiftMessage(data);\n\t\t\t\t});\n\t\t\t\tthis.message = '';\n\t\t\t\tconst target = event.currentTarget;\n\t\t\t\tconst styles = window.getComputedStyle(target);\n\t\t\t\ttarget.style.height = styles.getPropertyValue('min-height');\n\t\t\t}\n\t\t}\n\t},\n\tsetup() {\n\t\tconst buttonIcon = svg['send-button'];\n\n\t\treturn { store, buttonIcon };\n\t},\n\t// language=Vue\n    template: `\n\t\t<div class=\"avito-chat-input-container\">\n\t\t\t<div class=\"avito-chat-textarea\">\n\t\t\t\t<textarea \n\t\t\t\t\tclass=\"avito-chat-input\" \n\t\t\t\t\ttype=\"text\"\n\t                :placeholder=\"localize.PLACEHOLDER\"\n\t\t\t\t\trows=\"1\"\n\t                maxlength=\"1000\"\n\t\t\t\t\t:disabled=\"!store.chatId || store.isMessagesLoading\"\n\t\t\t\t\tv-model=\"message\" \n\t\t\t\t\t@keydown.enter=\"pressNewLine\"\n\t\t\t\t\t@keyup.enter=\"sendMessage\"\n\t\t\t\t\t@input=\"inputText\"\n\t\t\t\t>\n\t\t\t\t</textarea>\n              \t<button v-html=\"buttonIcon\" class=\"avito-chat-submit-button\" :disabled=\"!store.chatId || store.isMessagesLoading\" @click=\"sendMessage\"></button>\n\t        </div>\n\t\t</div>\n    `\n};\n\nexport { Input };\n","import {store} from \"../store\";\n\nconst ChatHeader = {\n\tmethods: {\n\t\ttoggle: function() {\n\t\t\tconst list = document.querySelector('.avito-chat-list');\n\t\t\tconst area = document.querySelector('.avito-chat-area');\n\t\t\tlist.classList.replace('hide', 'show');\n\t\t\tarea.classList.replace('show', 'hide');\n\t\t\tstore.scrollButton = false;\n\t\t},\n\t},\n\tsetup() {\n\t\treturn { store }\n\t},\n\t// language=Vue\n\ttemplate: `\n      <div class=\"avito-chat-header\">\n\t\t<div class=\"avito-chat-header-wrap\">\n\t\t\t<div class=\"avito-chat-header-button\" @click=\"toggle\">\n\t\t\t\t<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" class=\"avito-chat-header-button-icon\"\n\t\t\t\tstyle=\"width: 24px; height: 24px;\"><path\n\t\t\t\td=\"m7.414 13 5.293 5.293a1 1 0 0 1-1.414 1.414l-7-7a1 1 0 0 1 0-1.414l7-7a1 1 0 1 1 1.414 1.414L7.414 11H19a1 1 0 1 1 0 2H7.414Z\"\n\t\t\t\tfill=\"currentColor\"></path></svg>\n\t\t\t</div>\n\t\t\t<a :href=\"store.chat.url\" target=\"_blank\">\n\t\t\t\t<div class=\"avito-chat-header-preview\">\n\t\t\t\t\t<div :style=\"{ backgroundImage: 'url(' + store.chat.img + ')' }\"></div>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t\t<div class=\"avito-chat-header-info\">\n\t\t\t\t<a :href=\"store.otherUserUrl\" class=\"avito-chat-header-link\" target=\"_blank\">\n\t\t\t\t\t<div class=\"avito-chat-header-info-name\">{{ store.chat.name }}</div>\n\t\t\t\t</a>\n\t\t\t\t<a :href=\"store.chat.url\" class=\"avito-chat-header-link\" target=\"_blank\">\n\t\t\t\t\t<div class=\"avito-chat-header-info-title\">{{ store.chat.title }}</div>\n                </a>\n\t\t\t</div>\n\t\t</div>\n      </div>\n\t`\n};\n\nexport { ChatHeader };\n","import {store} from \"../store\";\n\nconst Error = {\n    setup() {\n        return { store };\n    },\n    // language=Vue\n    template: `\n\t\t<div class=\"avito-chat-error-container pop\" v-if=\"store.error\">\n          <div class=\"avito-chat-error-text\">{{ store.error }}</div>\n          <div class=\"avito-chat-error-close-button\" @click=\"store.deleteError()\">&#x2715;</div>\n\t\t</div>\n    `\n};\n\nexport { Error };"],"names":["store","window","AvitoVue3","reactive","component","String","setupId","userId","chats","selectChat","messages","error","chatId","chat","otherUserUrl","isMessagesLoading","showError","messageMenuId","limitChat","offsetChat","limitMessage","offsetMessage","isLoadingMessageScroll","stopMessageScroll","scrollButton","scrollButtonCircle","checkMessagesSending","unshiftMessage","message","this","length","firstMessage","rendering_avatar","author_id","delimiter","unshift","pushChatMessage","read","chat_id","updated","created","chat_message","text","pushMessages","lastMessage","push","readMessages","forEach","index","isRead","pushChats","deleteError","pushError","sortMessages","sort","a","b","sortChats","keys","Object","sortedObj","key","setMessages","setChatId","users","parseInt","url","setShowError","bool","author","authorId","_this$chats$this$chat","clearDataForMessages","ChatListElement","props","setup","template","LoaderList","LoaderScroll","mounted","document","querySelector","scrollIntoView","block","inline","Errors","response","data","status","Ajax","BX","ajax","runComponentAction","limit","offset","then","check","messageId","checkTimestamp","svg","App","components","ChatList","isLoading","isLoadingScroll","stopScroll","_checkMessagesScheduleTimeout","_checkMessagesStartFrame","_checkMessagesStartTimeout","async","chatById","assign","messagesByChatId","firstChat","methods","handleScroll","event","target","currentTarget","offsetHeight","scrollTop","scrollHeight","id","entries","getAttribute","toggleChat","list","area","classList","replace","clearCheckMessages","readChat","scheduleCheckMessages","setTimeout","startCheckMessages","bind","requestAnimationFrame","checkMessages","clearTimeout","cancelAnimationFrame","checkNewMessage","isOwnMessage","storeMessage","catch","ChatArea","Messages","Message","Quote","quote","authorName","messageType","type","image","isPicture","icon","content","link","sizes","item","image_url","title","location","scrollToMessage","idScrollElement","scrollElement","getElementById","behavior","ImageMessage","hasQuote","Boolean","lastIndex","imageOpen","open","LinkMessage","previewImage","preview","images","LocationMessage","linkMap","lon","lat","linkImage","Actions","computed","localize","TEXT","TITLE","deleteMessage","deletable","messageData","contextMenu","LoaderMessages","ScrollButton","scrollBottom","scrollTo","top","EmptyMessages","addEventListener","hideContextMenu","Math","abs","actions","contains","remove","add","Input","PLACEHOLDER","pressNewLine","shiftKey","preventDefault","inputText","currentValue","value","styles","getComputedStyle","lineHeight","getPropertyValue","minHeight","style","height","lineBreaks","match","lineCount","sendMessage","trim","buttonIcon","ChatHeader","toggle","Error","beforeMount"],"mappings":"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"}