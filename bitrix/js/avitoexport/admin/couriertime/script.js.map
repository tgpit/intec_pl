{"version":3,"file":"script.js","sources":["../../plugin/skeleton.js","../../plugin/utils.js","src/index.js"],"sourcesContent":["import {compileTemplate} from \"./utils\";\r\n\r\n// noinspection JSUnresolvedVariable\r\nconst $ = window.AvitoJQuery ?? window.$;\r\n\r\nexport class Skeleton {\r\n\r\n\tstatic defaults = {\r\n\t\tlang: {},\r\n\t\tlangPrefix: null\r\n\t};\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tthis.$el = $(element);\r\n\t\tthis.el = this.$el[0];\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, this.$el.data(), options);\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.el = null;\r\n\t}\r\n\t\r\n\tgetElement(key, context, method) : JQuery {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\t\r\n\t\treturn this.getNode(selector, context, method || 'find');\r\n\t}\r\n\t\r\n\tgetElementSelector(key: string) : string {\r\n\t\tconst optionKey = key + 'Element';\r\n\t\r\n\t\treturn this.options[optionKey];\r\n\t}\r\n\t\r\n\tgetTemplate(key: string) : string {\r\n\t\tconst optionKey = key + 'Template';\r\n\t\tconst option = this.options[optionKey];\r\n\t\tconst optionFirstSymbol = option.substring(0, 1);\r\n\t\tlet result;\r\n\t\r\n\t\tif (optionFirstSymbol === '.' || optionFirstSymbol === '#') {\r\n\t\t\tresult = this.getNode(option).html();\r\n\t\t} else {\r\n\t\t\tresult = option;\r\n\t\t}\r\n\t\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tgetNode(selector, context, method = 'find') : JQuery {\r\n\t\tif (selector.substring(0, 1) === '#') { // is id query\r\n\t\t\tcontext = $(document);\r\n\t\t} else if (!context) {\r\n\t\t\tcontext = this.$el;\r\n\t\t}\r\n\t\r\n\t\treturn context[method](selector);\r\n\t}\r\n\t\r\n\tgetLang(key, replaces) : string {\r\n\t\tlet langKey;\r\n\t\tlet result;\r\n\t\r\n\t\tif (this.options.lang != null && key in this.options.lang) {\r\n\t\t\tresult = this.options.lang[key];\r\n\t\t} else {\r\n\t\t\tlangKey = this.options.langPrefix + key;\r\n\t\t\tresult = BX.message(langKey) || '';\r\n\t\t}\r\n\t\r\n\t\tif (result && replaces) {\r\n\t\t\tresult = compileTemplate(result, replaces);\r\n\t\t}\r\n\t\r\n\t\treturn result;\r\n\t}\r\n}\r\n","// @flow\r\n\r\nexport function compileTemplate(template: string, replaces: Object) {\r\n\tlet result = template;\r\n\r\n\tfor (const key in replaces) {\r\n\t\tif (!replaces.hasOwnProperty(key)) { continue; }\r\n\r\n\t\tconst replaceKey = '#' + key + '#';\r\n\t\tconst replaceValue = replaces[key];\r\n\r\n\t\tdo {\r\n\t\t\tresult = result.replace(replaceKey, replaceValue);\r\n\t\t} while (result.indexOf(replaceKey) !== -1);\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function htmlToElement(html, tag = 'div') {\r\n\tconst renderer = document.createElement(tag);\r\n\r\n\trenderer.innerHTML = html;\r\n\r\n\treturn renderer.firstElementChild;\r\n}","import {Skeleton} from \"../../../plugin/skeleton\";\r\n\r\n// noinspection JSUnresolvedVariable\r\nconst $ = window.AvitoJQuery ?? window.$;\r\n\r\n// noinspection JSUnusedGlobalSymbols\r\nexport class CourierTime extends Skeleton {\r\n\r\n\tstatic defaults = {\r\n\t\tdateElement: '[data-entity=\"date\"]',\r\n\t\ttimeElement: '[data-entity=\"time\"]',\r\n\r\n\t\tlang: {},\r\n\t\tlangPrefix: 'AVITO_EXPORT_ADMIN_COURIER_TIME_'\r\n\t}\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tsuper(element, options);\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tbind() : void {\r\n\t\tconst anchor = this.eventAnchor();\r\n\t\tconst date = this.getElement('date');\r\n\r\n\t\tanchor.on('avitoCourierTime', this.onCourierTime);\r\n\t\tanchor.on('avitoCourierAddressReset', this.onAddressReset);\r\n\t\tdate.on('change', this.onDateChange);\r\n\t}\r\n\r\n\tonCourierTime = (evt, data) : void => {\r\n\t\tconst dateOption = this.dateOptions(data.options);\r\n\r\n\t\tif (dateOption == null) {\r\n\t\t\tthis.resetTime();\r\n\t\t} else {\r\n\t\t\tthis.timeOptions(dateOption['INTERVALS']);\r\n\t\t}\r\n\t}\r\n\r\n\tonAddressReset = () : void => {\r\n\t\tthis.resetDate();\r\n\t\tthis.resetTime();\r\n\t}\r\n\r\n\tonDateChange = (evt) : void => {\r\n\t\tconst options = this.searchIntervals(evt.target.value);\r\n\r\n\t\tif (options == null) {\r\n\t\t\tthis.resetTime();\r\n\t\t} else {\r\n\t\t\tthis.timeOptions(options);\r\n\t\t}\r\n\t}\r\n\r\n\tdateOptions(options: Array) : ?Object {\r\n\t\tconst dateSelect = this.getElement('date');\r\n\t\tconst selected = dateSelect.val();\r\n\t\tconst selectedOption = this.searchOption(options, selected);\r\n\r\n\t\tdateSelect.prop('disabled', false);\r\n\t\tdateSelect.empty();\r\n\t\tthis.renderPlaceholder(dateSelect, this.getLang('CHOOSE_DATE'), selectedOption != null);\r\n\t\tthis.renderOptions(dateSelect, options, selected);\r\n\r\n\t\tthis._dateOptions = options;\r\n\r\n\t\treturn selectedOption;\r\n\t}\r\n\r\n\tresetDate() : void {\r\n\t\tconst dateSelect = this.getElement('date');\r\n\r\n\t\tdateSelect.prop('disabled', true);\r\n\t\tdateSelect.find('option').prop('selected', false);\r\n\t\tthis.renderPlaceholder(dateSelect, this.getLang('INPUT_ADDRESS'));\r\n\t}\r\n\r\n\tsearchIntervals(selectedDate: ?string) : ?Array {\r\n\t\tconst option = this.searchOption(this._dateOptions, selectedDate);\r\n\r\n\t\treturn option?.['INTERVALS'];\r\n\t}\r\n\r\n\tsearchOption(options: Array, selected: ?string) : ?Object {\r\n\t\tif (selected == null || selected === '') { return null; }\r\n\r\n\t\tlet result = null;\r\n\r\n\t\tfor (const option of options) {\r\n\t\t\tif (option['ID'] === selected) {\r\n\t\t\t\tresult = option;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\ttimeOptions(options: Array) : ?Object {\r\n\t\tconst timeSelect = this.getElement('time');\r\n\t\tconst selected = timeSelect.val();\r\n\t\tconst selectedOption = this.searchOption(options, selected);\r\n\r\n\t\ttimeSelect.prop('disabled', false);\r\n\t\ttimeSelect.empty();\r\n\t\tthis.renderPlaceholder(timeSelect, this.getLang('CHOOSE_TIME'), selectedOption != null);\r\n\t\tthis.renderOptions(timeSelect, options, selected);\r\n\r\n\t\treturn selectedOption;\r\n\t}\r\n\r\n\tresetTime() : void {\r\n\t\tconst timeSelect = this.getElement('time');\r\n\r\n\t\ttimeSelect.prop('disabled', true);\r\n\t\ttimeSelect.find('option').prop('selected', false);\r\n\t\tthis.renderPlaceholder(timeSelect, '');\r\n\t}\r\n\r\n\trenderPlaceholder(select: JQuery, message: string, hasSelected: boolean = false) : void {\r\n\t\tconst option = document.createElement('option');\r\n\t\toption.value = '';\r\n\t\toption.textContent = message;\r\n\t\toption.disabled = true;\r\n\t\toption.selected = !hasSelected;\r\n\r\n\t\tselect.append(option);\r\n\t}\r\n\t\r\n\trenderOptions(select: JQuery, variants: Array, selected: ?string = null) : void {\r\n\t\tfor (const variant of variants) {\r\n\t\t\tconst option = document.createElement('option');\r\n\t\t\toption.value = variant['ID'];\r\n\t\t\toption.textContent = variant['VALUE'];\r\n\t\t\toption.selected = (variant['ID'] === selected);\r\n\r\n\t\t\tselect.append(option);\r\n\t\t}\r\n\t}\r\n\r\n\teventAnchor() : JQuery {\r\n\t\tconst form = this.$el.closest('form');\r\n\r\n\t\treturn form.length > 0 ? form : $(document);\r\n\t}\r\n}"],"names":["$","window","AvitoJQuery","Skeleton","constructor","element","options","$el","el","this","Object","assign","defaults","data","destroy","getElement","key","context","method","selector","getElementSelector","getNode","optionKey","getTemplate","option","optionFirstSymbol","substring","result","html","document","getLang","replaces","langKey","lang","langPrefix","BX","message","template","hasOwnProperty","replaceKey","replaceValue","replace","indexOf","compileTemplate","CourierTime","onCourierTime","evt","dateOption","dateOptions","resetTime","timeOptions","onAddressReset","resetDate","onDateChange","searchIntervals","target","value","bind","anchor","eventAnchor","date","on","dateSelect","selected","val","selectedOption","searchOption","prop","empty","renderPlaceholder","renderOptions","_dateOptions","find","selectedDate","timeSelect","select","hasSelected","createElement","textContent","disabled","append","variants","variant","form","closest","length","dateElement","timeElement"],"mappings":"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"}