this.BX=this.BX||{},this.BX.AvitoExport=this.BX.AvitoExport||{},function(t){"use strict";var e;const i=null!=(e=window.AvitoJQuery)?e:window.$;class o{constructor(t,e={}){this.$el=i(t),this.el=this.$el[0],this.options=Object.assign({},this.constructor.defaults,this.$el.data(),e)}destroy(){this.el=null}getElement(t,e,i){const o=this.getElementSelector(t);return this.getNode(o,e,i||"find")}getElementSelector(t){const e=t+"Element";return this.options[e]}getTemplate(t){const e=t+"Template",i=this.options[e],o=i.substring(0,1);let s;return s="."===o||"#"===o?this.getNode(i).html():i,s}getNode(t,e,o="find"){return"#"===t.substring(0,1)?e=i(document):e||(e=this.$el),e[o](t)}getLang(t,e){let i,o;return null!=this.options.lang&&t in this.options.lang?o=this.options.lang[t]:(i=this.options.langPrefix+t,o=BX.message(i)||""),o&&e&&(o=function(t,e){let i=t;for(const t in e){if(!e.hasOwnProperty(t))continue;const o="#"+t+"#",s=e[t];do{i=i.replace(o,s)}while(-1!==i.indexOf(o))}return i}(o,e)),o}}o.defaults={lang:{},langPrefix:null};class s extends o{constructor(...t){super(...t),this._handled={},this.onFormSubmit=()=>{const t=this.getModal().GetForm(),e=$(t);this.prepareAjaxForm(e)},this.onFormSave=t=>{this.activateEnd(t),this._modal.Close(),BX.closeWait()},this.onError=()=>{var t;null==(t=this._modal)||t.closeWait()},this.onClose=()=>{this.handleFormSubmit(!1),this.handleFormSave(!1),this.handleError(!1),this.handleClose(!1),this.activateStop()}}handleFormSubmit(t){this.wrapHandle("formSubmit",t,(()=>{const e=this._modal.GetContent();$(e)[t?"on":"off"]("submit",this.onFormSubmit)}))}handleFormSave(t){this.wrapHandle("formSave",t,(()=>{BX[t?"addCustomEvent":"removeCustomEvent"]("avitoExportFormSave",this.onFormSave)}))}handleError(t){this.wrapHandle("error",t,(()=>{BX[t?"addCustomEvent":"removeCustomEvent"](this._modal,"onWindowError",this.onError)}))}handleClose(t){this.wrapHandle("close",t,(()=>{BX[t?"addCustomEvent":"removeCustomEvent"](this._modal,"onWindowClose",this.onClose)}))}wrapHandle(t,e,i){!!this._handled[t]!==e&&(null!=this._modal?(i(e),this._handled[t]=e):e||(this._handled[t]=!1))}activate(){return null!=this._modal||(this._modal=this.createModal()),this._modal.Show(),this.handleFormSubmit(!0),this.handleFormSave(!0),this.handleError(!0),this.handleClose(!0),null!=this._activateDeferred&&this._activateDeferred.reject(),this._activateDeferred=new $.Deferred}activateStop(){var t;null==(t=this._activateDeferred)||t.reject(),this._activateDeferred=null}activateEnd(t){var e;null==(e=this._activateDeferred)||e.resolve(t),this._activateDeferred=null}getModal(){return null==this._modal&&(this._modal=this.createModal()),this._modal}createModal(){const t=this.getModalOptions();return new BX.CAdminDialog(t)}getModalOptions(){return{title:this.options.title,width:this.options.width,height:this.options.height,content_url:this.makeModalUrl(),content_post:this.options.data,draggable:!0,resizable:!0,buttons:this.getModalButtons()}}getModalButtons(){return null!=this.options.buttons?this.options.buttons:this.getDefaultButtons()}getDefaultButtons(){let t=BX.CAdminDialog.btnSave;return this.options.saveTitle&&(t=Object.assign({},t,{title:this.options.saveTitle})),[t,BX.CAdminDialog.btnCancel]}makeModalUrl(){const t=this.options.url||"";return t+(-1===t.indexOf("?")?"?":"&")+"view=dialog"}prepareAjaxForm(t){t.find('input[name="ajaxForm"]').length>0||t.append('<input type="hidden" name="ajaxForm" value="Y" />')}}s.defaults={url:null,data:null,title:null,saveTitle:null,width:400,height:250,buttons:null},t.ModalForm=s}(this.BX.AvitoExport.Ui=this.BX.AvitoExport.Ui||{});
//# sourceMappingURL=script.js.map
