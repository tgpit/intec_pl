this.BX=this.BX||{},this.BX.AvitoExport=this.BX.AvitoExport||{},this.BX.AvitoExport.Ui=this.BX.AvitoExport.Ui||{},function(e){"use strict";var t;const i=null!=(t=window.AvitoJQuery)?t:window.$;class n{constructor(e,t={}){this.$el=i(e),this.el=this.$el[0],this.options=Object.assign({},this.constructor.defaults,this.$el.data(),t)}destroy(){this.el=null}getElement(e,t,i){const n=this.getElementSelector(e);return this.getNode(n,t,i||"find")}getElementSelector(e){const t=e+"Element";return this.options[t]}getTemplate(e){const t=e+"Template",i=this.options[t],n=i.substring(0,1);let s;return s="."===n||"#"===n?this.getNode(i).html():i,s}getNode(e,t,n="find"){return"#"===e.substring(0,1)?t=i(document):t||(t=this.$el),t[n](e)}getLang(e,t){let i,n;return null!=this.options.lang&&e in this.options.lang?n=this.options.lang[e]:(i=this.options.langPrefix+e,n=BX.message(i)||""),n&&t&&(n=function(e,t){let i=e;for(const e in t){if(!t.hasOwnProperty(e))continue;const n="#"+e+"#",s=t[e];do{i=i.replace(n,s)}while(-1!==i.indexOf(n))}return i}(n,t)),n}}var s;n.defaults={lang:{},langPrefix:null};const l=null!=(s=window.AvitoJQuery)?s:window.$;class r extends n{constructor(e,t={}){super(e,t),this.onDependChange=()=>{this.updateField()},this.bind()}destroy(){this.unbind(),super.destroy()}bind(){this.handleDependChange(!0)}unbind(){this.handleDependChange(!1)}handleDependChange(e){this.getDependElements()[e?"on":"off"]("change",this.onDependChange)}updateField(){const e=this.resolveDependRules();this.alreadyView(e)||(this.toggleView(e),this.toggleHeaderView(e),this.toggleTab(e),this.fireChange())}resolveDependRules(){const e=this.options.depend;let t,i,n,s,l=this.getDependFields(),r=this.isDependAny(),o=!r;for(i in l)if(l.hasOwnProperty(i)&&(n=l[i],s=this.getFieldValue(n,i),t=e[i],this.isMatchRule(t,s)===r)){o=r;break}return o}getFieldValue(e,t){let i;if(this.isHiddenField(e))return null;switch(this.getFieldType(e,t)){case"complex":i=this.getComplexValue(e,t);break;case"hidden":i=e.length>1?this.getFieldValue(e.slice(1)):e.val();break;case"checkbox":i=[],e.each((function(){this.checked&&i.push(this.value)}));break;case"radio":e.each((function(){this.checked&&(i=this.value)}));break;default:i=e.val()}return i}isHiddenField(e){return this.getElement("sibling",e,"closest").hasClass("is--hidden")}getFieldType(e,t){const i=e.data("name");let n=(e.prop("tagName")||"").toLowerCase();return"input"===n&&(n=(e.prop("type")||"").toLowerCase()),null!=i&&i!==t&&0===i.indexOf("["+t+"]")&&(n="complex"),n}getComplexValue(e,t){let i,n,s,l,r="["+t+"]",o={};for(i=0;i<e.length;i++)n=e.eq(i),s=n.data("name"),null!=s&&0===s.indexOf(r)&&(l=s.substring(r.length),o[l]=this.getFieldValue(n,s));return o}isMatchRule(e,t){let i,n=!0;switch(e.RULE){case"EMPTY":i=this.testIsEmpty(t),n=i===e.VALUE;break;case"ANY":n=this.applyRuleAny(e.VALUE,t);break;case"EXCLUDE":n=!this.applyRuleAny(e.VALUE,t)}return n}testIsEmpty(e){let t=!0;if(Array.isArray(e)){for(const i of e)if(!this.testIsEmpty(i)){t=!1;break}}else if(l.isPlainObject(e)){for(const i in e)if(e.hasOwnProperty(i)&&!this.testIsEmpty(e[i])){t=!1;break}}else t=!e||"0"===e;return t}applyRuleAny(e,t){const i=Array.isArray(e),n=Array.isArray(t);let s,l,r=!1;if(n&&i){for(s=t.length-1;s>=0;--s)if(l=t[s],this.testInArray(l,e)){r=!0;break}}else r=n?this.testInArray(e,t):i?this.testInArray(t,e):t==e;return r}testInArray(e,t){let i=!1;for(let n=t.length-1;n>=0;n--)if(t[n]==e){i=!0;break}return i}isDependAny(){return"OR"===this.options.depend.LOGIC}alreadyView(e){return this.$el.hasClass("is--hidden")===!e}toggleView(e){this.$el.toggleClass("is--hidden",!e),this.getElement("description",this.$el,"next").toggleClass("is--hidden",!e)}toggleHeaderView(e){const t=this.getHeading();if(e)return void t.removeClass("is--hidden");if(t.hasClass("is--hidden"))return;const i=this.getSiblingsUnderHeading(t).not(this.getElementSelector("description")).not(".is--hidden").length>0;t.toggleClass("is--hidden",!i),this.getElement("description",t,"next").toggleClass("is--hidden",!i)}getHeading(){return this.getElement("heading",this.$el,"prevAll").first()}getSiblingsUnderHeading(e){const t=this.getElementSelector("heading"),i=this.getElementSelector("sibling");let n=e,s=l();do{if(n=n.next(),n.is(t))break;n.is(i)&&(s=s.add(n))}while(0!==n.length);return s}toggleTab(e){const t=this.getElement("tabContent",this.$el,"closest"),i=this.tabButton(t);if(null==i)return;if(e)return void i.removeClass("is--hidden");if(i.hasClass("is--hidden"))return;const n=this.getElement("sibling",this.$el,"siblings").not(".is--hidden").length>0;i.toggleClass("is--hidden",!n)}tabButton(e){const t=e.attr("id");return null==t?null:l(`#tab_cont_${t}`)}fireChange(){this.getElement("input").trigger("change")}getDependElements(){const e=this.getDependFields();let t,i,n=l();for(t in e)e.hasOwnProperty(t)&&(i=e[t],n=n.add(i));return n}getDependFields(){let e,t,i,n=Object.keys(this.options.depend),s={};for(e=0;e<n.length;e++)t=n[e],"LOGIC"!==t&&(i=this.getField(t),i&&(s[t]=i));return s}getField(e){let t;return t="#"===e.substring(0,1)?l(e):this.getFormField(e),t}getFormField(e){const t=this.getElement("form",this.$el,"closest"),i=t.is("form"),n=e+"[]";let s,r,o,a;if(i&&null!=t[0][e])a=l(t[0][e]);else if(i&&null!=t[0][n])a=l(t[0][n]);else for(s=['[data-name="'+e+'"]','[data-name^="['+e+']"]'],r=0;r<s.length&&(o=s[r],a=t.find(o),!(a.length>0));r++);return a}}r.defaults={depend:null,headingElement:".heading",formElement:"form",inputElement:"input, select, textarea",siblingElement:"tr",descriptionElement:".avito-group-description, .avito-field-intro, .avito-field-additional",tabContentElement:".adm-detail-content",lang:{}},e.Dependfield=r}(this.BX.AvitoExport.Ui.Input=this.BX.AvitoExport.Ui.Input||{});
//# sourceMappingURL=script.js.map
