!function(){"use strict";if(window.IntecReviews2Component)return!1;var t=template.getLibrary("_");window.IntecReviews2Component=function(){this.root=null,this.component={path:null,template:null,parameters:null},this.navigation={id:null,exists:!1,active:!1,container:null,root:null,current:1,count:1},this.form={exists:!1,root:null,body:null},this.items={exists:!1,root:null},this.settings={navigationButtonDelete:!1},this.cache={navigation:{container:null,root:null},form:{root:null,body:null},items:{root:null}}},IntecReviews2Component.prototype={initialize:function(t){this.root=document.querySelector(t.root),this.componentInitialize(t.component)&&null!==this.root&&(this.navigationInitialize(t.navigation),this.formInitialize(t.form),this.itemsInitialize(t.items),this.setSettings(t.settings))},getSettings:function(i){var n=void 0;return!t.isString(i)||t.isEmpty(i)?n=this.settings:this.settings.hasOwnProperty(i)&&(n=this.settings[i]),t.cloneDeep(n)},setSettings:function(i){if(t.isObject(i)&&!t.isEmpty(i)){var n=this;t.each(i,function(t,i){n.settings.hasOwnProperty(i)&&(n.settings[i]=t)})}},componentInitialize:function(t){return this.componentSet(t),this.componentValidate()},componentSet:function(i){t.isNil(i)||(t.isNil(i.path)||(this.component.path=i.path),t.isNil(i.template)||(this.component.template=i.template),t.isNil(i.parameters)||(this.component.parameters=i.parameters))},componentValidate:function(){return!(null===this.component.path||null===this.component.template||null===this.component.parameters)},componentCompleteData:function(t){return t.parameters=this.component.parameters,t.template=this.component.template,t},navigationInitialize:function(i){t.isNil(i.id)||(this.navigation.id=i.id,null===this.cache.navigation.container?this.navigation.container=this.root.querySelector(i.container):this.navigation.container=this.root.querySelector(this.cache.navigation.container),null!==this.navigation.container&&(null===this.cache.navigation.root?this.navigation.root=this.root.querySelector(i.root):this.navigation.root=this.root.querySelector(this.cache.navigation.root)),null!==this.navigation.root&&(null===this.cache.navigation.root&&(this.cache.navigation.root=i.root),this.navigation.current=parseInt(i.current),this.navigation.count=parseInt(i.count),(isNaN(this.navigation.current)||this.navigation.current<1)&&(this.navigation.current=1),(isNaN(this.navigation.count)||this.navigation.count<1)&&(this.navigation.count=1),this.navigation.exists=!0,this.navigationCheck(),this.navigation.exists&&this.navigationBindAction()))},navigationCheck:function(){this.navigation.current>this.navigation.count&&(this.navigation.current=this.navigation.count),this.navigation.current===this.navigation.count&&(this.navigation.active=!1),this.navigation.current<this.navigation.count&&(this.navigation.active=!0),this.navigationSetState()},navigationSetState:function(){this.navigation.active?this.navigation.root.setAttribute("data-state","active"):this.getSettings("navigationButtonDelete")?(this.navigation.exists=!1,this.navigation.container.remove()):this.navigation.root.setAttribute("data-state","disabled")},navigationBindAction:function(){let t=this,i={};i=this.componentCompleteData(i),this.navigation.root.addEventListener("click",function(){t.navigation.active&&(t.setState(t.items.root,"processing"),t.setState(t.navigation.root,"processing"),BX.ajax({url:t.component.path+t.navigationSetQuery(),method:"POST",dataType:"json",timeout:60,cache:!0,data:i,onsuccess:function(i){t.itemsUpload(i),t.setState(t.items.root,"none"),t.navigationCheck(),BX.closeWait(t.form.body)},onfailure:function(){t.navigation.current--,t.setState(t.items.root,"none"),t.setState(t.form.root,"active")}}))})},navigationSetQuery:function(){return this.navigation.active?"?"+this.navigation.id+"=page-"+ ++this.navigation.current:""},navigationReset:function(){this.navigation.exists&&(this.navigation.current=1,this.navigation.active=!0,this.navigationCheck())},formInitialize:function(t){null===this.cache.form.root?this.form.root=this.root.querySelector(t.root):this.form.root=this.root.querySelector(this.cache.form.root),null!==this.form.root&&(null===this.cache.form.root&&(this.cache.form.root=t.root),null===this.cache.form.body?this.form.body=this.form.root.querySelector(t.body):this.form.body=this.form.root.querySelector(this.cache.form.body),null!==this.form.body&&(null===this.cache.form.body&&(this.cache.form.body=t.body),this.form.exists=!0,this.formBindSubmit()))},formBindSubmit:function(){if(!this.form.exists)return;let t=this;this.form.body.addEventListener("submit",function(i){i.preventDefault(),t.formSubmit()})},formCollectData:function(){let t={},i=this.form.body.querySelectorAll("input, textarea, select");return i.length&&i.forEach(function(i){t[i.name]=i.value}),t},formSubmit:function(){let i=this,n=this.formCollectData();t.isNil(n)||(n=this.componentCompleteData(n),this.setState(this.form.root,"processing"),BX.ajax({url:this.component.path,method:"POST",dataType:"json",timeout:60,cache:!0,data:n,onsuccess:function(t){t.form&&i.formRefresh(t.form),"added"===t.status&&(i.itemsRefresh(t.items),i.navigationReset()),i.setState(i.form.root,"none")},onfailure:function(){i.setState(i.form.root,"none")}}))},formRefresh:function(t){this.form.exists&&(this.form.root.innerHTML=t,this.formInitialize(),this.generateEvent("form.updated"))},itemsInitialize:function(t){null===this.cache.items.root?this.items.root=this.root.querySelector(t.root):this.items.root=this.root.querySelector(this.cache.items.root),null!==this.items.root&&(null===this.cache.items.root&&(this.cache.items.root=t.root),this.items.exists=!0)},itemsRefresh:function(t){this.items.exists&&(this.items.root.innerHTML=t,this.generateEvent("items.updated"))},itemsUpload:function(t){this.items.exists&&null!==t.items&&void 0!==t.items&&(this.items.root.insertAdjacentHTML("beforeend",t.items),this.generateEvent("items.updated"))},generateEvent:function(t){let i=new Event("intec.reviews."+t);document.dispatchEvent(i)},setState:function(t,i){t.setAttribute("data-state",i)}}}();