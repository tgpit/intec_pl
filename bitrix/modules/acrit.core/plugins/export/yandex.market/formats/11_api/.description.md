Введение
---

Данный формат выгрузки предназначен для экспорта товаров, цен и остатков через API Яндекс.Маркет. При этом важно понимать, что в связи с различиями в схемах работы (FBS, FBY, DBS, Экспресс) некоторые методы не будут работать:
* Если выбрана схема работы DBS, выгрузка товаров не будет работать. Работает только выгрузка цен и остатков.
* Если выбрана схема работы FBY, выгрузка остатков не будет работать. Работает только выгрузка товаров и цен.

<br/>

Начало работы
---

Прежде всего, необходимо зарегистрироваться в Яндексе и создать личный кабинет в [Яндекс.Маркете](https://partner.market.yandex.ru/business/).

Далее, в личном кабинете, в меню «Настройки» - «Юридические данные» следует заполнить все данные о компании, а также параметры налогообложения, включая НДС. При этом, для тестирования достаточно только выбрать параметры налогообложения.

Теперь личный кабинет готов к загрузке товаров по API. Остаётся только настроить авторизацию через OAuth.

<br/>

Настройки авторизации
---

Прежде всего необходимо [создать новое приложение](https://oauth.yandex.ru/client/new) (если ещё не создано) в Яндексе для авторизации по OAuth (нужно использовать именно эту ссылку, т.к. при создании приложения из интерфейса Яндекса открывается другая страница). Если приложение уже было создано, найдите его в [списке приложений](https://oauth.yandex.ru).

При создании приложения укажите следующие параметры:

* **Название сервиса** - любое, например `Авторизация для модуля экспорта на сайте example.com`.
* **Платформы приложения** - `Веб-сервисы`, и в поле `Redirect URI` скопировать значение `https://oauth.yandex.ru/verification_code`.
* **Доступ к данным** - начните набирать `API Яндекс.Маркета`, будет найден один пункт `API Яндекс.Маркета / Поиска по товарам для партнеров` - выберите его.
* **Почта для связи** - указать свой email.

После сохранения настроек открывается карточка созданного приложения, откуда следует скопировать в профиль экспорта значения `ClientID` и `Client secret`.

Далее, в профиле напротив поля «Токен авторизации OAuth» следует нажать кнопку «Получить», в появившемся окошке подтвердить - «OK». Откроется страница авторизации, где после прохождения авторизации будет получен код подтверждения - его необходимо вставить в окне запроса на странице профиля, нажать «OK». После этого поле с токеном должно заполниться автоматически.

Остаётся заполнить поле «Идентификатор кампании». Для этого откройте личный кабинет Яндекс.Маркета, меню «Настройки» - «Настройки API», найдите поле «Номер кампании», скопируйте число после символа дефиса (или нажмите кнопку копирования), и вставьте это значение на странице в профиле.

Теперь можно проверить корректность подключения и авторизации к API Яндекс.Маркета, для этого нажмите кнопку «Проверить» - должен появиться значок в виде зелёной галочки. Если появляется красный значок, значит какие-то данные указаны некорректно.

Не забудьте сохранить (применить) сделанные в профиле изменения.

Некоторые особенности
---
* После выгрузки товар появляется в личном кабинете Яндекс.Маркета примерно в течение одной минуты. Все ошибки по каждому из товаров (если товар выгружен, но имеются проблемы в отправленных данных) доступны в личном кабинете.
* Дополнительные характеристики заполняются в личном кабинете автоматически, если для выгруженного товара найдена существующая на Яндекс.Маркете. В противном случае в личном кабинете необходимо добавить карточку вручную. Для более корректной привязки выгружаемых товаров к существующим карточкам товара необходимо заполнять в товарах (и затем выбирать в профиле) поле `SKU на Маркете`. В случае, если поле не заполнено, модуль использует запросы для определения рекомендаций Яндекс.Маркета.
* Удаление товаров в личном кабинете занимает несколько часов. Поэтому, если Вы удалили товар, то в течение нескольких часов попытка добавить товар с таким же SKU будет невозможен - ошибки при выгрузке не будет, но товар в личном кабинете появляться не будет.

<p><br/></p>

Полезные ссылки
---
* [Личный кабинет](https://partner.market.yandex.ru/business/)
* [Общий алгоритм загрузки товаров](https://yandex.ru/dev/market/partner-marketplace-cd/doc/dg/concepts/range-management.html)
* Документация по различных схемам работы: [FBS](https://yandex.ru/dev/market/partner-api/doc/ru/overview/fbs) - [FBY](https://yandex.ru/dev/market/partner-api/doc/ru/overview/fby) - [DBS](https://yandex.ru/dev/market/partner-api/doc/ru/overview/dbs) - [Экспресс](https://yandex.ru/dev/market/partner-api/doc/ru/overview/express)
* [API выгрузки товаров](https://yandex.ru/dev/market/partner-api/doc/ru/reference/offer-mappings/updateOfferMappingEntries)
* [API выгрузки цен](https://yandex.ru/dev/market/partner-api/doc/ru/reference/assortment/updatePrices)
* [API выгрузки остатков](https://yandex.ru/dev/market/partner-api/doc/ru/reference/stocks/updateStocks)
* [Информация об ответе на запрос /stocks](https://yandex.ru/dev/market/partner-api/doc/ru/pushapi/reference/getStocks)
* [Информация об ответе на запрос /cart](https://yandex.ru/dev/market/partner-api/doc/ru/pushapi/reference/post-cart)
