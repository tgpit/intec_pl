this.BX=this.BX||{},this.BX.AvitoExport=this.BX.AvitoExport||{},this.BX.AvitoExport.Ui=this.BX.AvitoExport.Ui||{},function(t){"use strict";var e;const s=null!=(e=window.AvitoJQuery)?e:window.$;class n{constructor(t,e={}){this.$el=s(t),this.el=this.$el[0],this.options=Object.assign({},this.constructor.defaults,this.$el.data(),e)}destroy(){this.el=null}getElement(t,e,s){const n=this.getElementSelector(t);return this.getNode(n,e,s||"find")}getElementSelector(t){const e=t+"Element";return this.options[e]}getTemplate(t){const e=t+"Template",s=this.options[e],n=s.substring(0,1);let i;return i="."===n||"#"===n?this.getNode(s).html():s,i}getNode(t,e,n="find"){return"#"===t.substring(0,1)?e=s(document):e||(e=this.$el),e[n](t)}getLang(t,e){let s,n;return null!=this.options.lang&&t in this.options.lang?n=this.options.lang[t]:(s=this.options.langPrefix+t,n=BX.message(s)||""),n&&e&&(n=function(t,e){let s=t;for(const t in e){if(!e.hasOwnProperty(t))continue;const n="#"+t+"#",i=e[t];do{s=s.replace(n,i)}while(-1!==s.indexOf(n))}return s}(n,e)),n}}var i;n.defaults={lang:{},langPrefix:null};const o=null!=(i=window.AvitoJQuery)?i:window.$;class r extends n{constructor(t,e={}){super(t,e),this.onClick=()=>{this.exchange()},this.onClientIdChange=()=>{this.refresh()},this.exchangeStop=(t,e,s)=>{this.showError(this.getLang("EXCHANGE_HTTP_ERROR",{REASON:200!==t.status?`HTTP ${t.status}`:s||e}))},this.exchangeEnd=t=>{const e=null==t?void 0:t.success;!0===e?this.updateTokens([{ID:t.id,VALUE:t.name}]):!1===e?this.showError(this.getLang("EXCHANGE_FAIL",{REASON:t.message})):this.showError(this.getLang("EXCHANGE_UNKNOWN_FAIL"))},this.refreshStop=(t,e,s)=>{this.showError(this.getLang("REFRESH_HTTP_ERROR",{REASON:200!==t.status?`HTTP ${t.status}`:s||e}))},this.refreshEnd=t=>{const e=null==t?void 0:t.success;!0===e?this.updateTokens(t.variants):!1===e?this.showError(this.getLang("REFRESH_FAIL",{REASON:t.message})):this.showError(this.getLang("REFRESH_UNKNOWN_FAIL"))},this.bind()}destroy(){this.unbind(),super.destroy()}bind(){this.handleClientIdChange(!0),this.handleClick(!0)}unbind(){this.handleClientIdChange(!1),this.handleClick(!1)}handleClick(t){this.getElement("start")[t?"on":"off"]("click",this.onClick)}handleClientIdChange(t){this.formInput("clientId")[t?"on":"off"]("change",this.onClientIdChange)}exchange(){o.ajax({url:this.options.exchangeUrl,type:"POST",data:{clientId:this.clientId(),clientSecret:this.clientPassword()},dataType:"json"}).then(this.exchangeEnd,this.exchangeStop)}refresh(){const t=this.clientId();null!=t&&""!==t?o.ajax({url:this.options.refreshUrl,type:"POST",data:{clientId:this.clientId()},dataType:"json"}).then(this.refreshEnd,this.refreshStop):this.updateTokens([])}updateTokens(t){const e=this.getElement("select");this.clearSelect(e),this.drawSelect(e,t)}clearSelect(t){t.find("option").filter(((t,e)=>""!==e.value)).remove()}drawSelect(t,e){var s;let n;for(const s of e){const e=o("<option />");e.prop("value",s.ID),e.text(s.VALUE),t.append(e),n=e}null==(s=n)||s.prop("selected",!0)}showError(t){alert(t)}clientId(){return this.formInput("clientId").val()}clientPassword(){return this.formInput("clientPassword").val()}formInput(t){const e=this.$el.closest("form");return this.getElement(t,e)}}r.defaults={startElement:".js-oauth-token__start",selectElement:"select",exchangeUrl:"/bitrix/tools/avito.export/oauth/exchange.php",refreshUrl:"/bitrix/tools/avito.export/oauth/refresh.php",clientIdElement:'input[name="COMMON_SETTINGS[CLIENT_ID]"]',clientPasswordElement:'input[name="COMMON_SETTINGS[CLIENT_PASSWORD]"]',lang:{},langPrefix:"AVITO_EXPORT_ADMIN_USER_FIELD_OAUTH_TOKEN_TYPE_"},t.OAuthToken=r}(this.BX.AvitoExport.Ui.Input=this.BX.AvitoExport.Ui.Input||{});
//# sourceMappingURL=script.js.map
