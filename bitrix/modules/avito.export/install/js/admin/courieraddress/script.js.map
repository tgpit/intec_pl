{"version":3,"file":"script.js","sources":["../../plugin/skeleton.js","../../plugin/utils.js","src/index.js"],"sourcesContent":["import {compileTemplate} from \"./utils\";\r\n\r\n// noinspection JSUnresolvedVariable\r\nconst $ = window.AvitoJQuery ?? window.$;\r\n\r\nexport class Skeleton {\r\n\r\n\tstatic defaults = {\r\n\t\tlang: {},\r\n\t\tlangPrefix: null\r\n\t};\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tthis.$el = $(element);\r\n\t\tthis.el = this.$el[0];\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, this.$el.data(), options);\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.el = null;\r\n\t}\r\n\t\r\n\tgetElement(key, context, method) : JQuery {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\t\r\n\t\treturn this.getNode(selector, context, method || 'find');\r\n\t}\r\n\t\r\n\tgetElementSelector(key: string) : string {\r\n\t\tconst optionKey = key + 'Element';\r\n\t\r\n\t\treturn this.options[optionKey];\r\n\t}\r\n\t\r\n\tgetTemplate(key: string) : string {\r\n\t\tconst optionKey = key + 'Template';\r\n\t\tconst option = this.options[optionKey];\r\n\t\tconst optionFirstSymbol = option.substring(0, 1);\r\n\t\tlet result;\r\n\t\r\n\t\tif (optionFirstSymbol === '.' || optionFirstSymbol === '#') {\r\n\t\t\tresult = this.getNode(option).html();\r\n\t\t} else {\r\n\t\t\tresult = option;\r\n\t\t}\r\n\t\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tgetNode(selector, context, method = 'find') : JQuery {\r\n\t\tif (selector.substring(0, 1) === '#') { // is id query\r\n\t\t\tcontext = $(document);\r\n\t\t} else if (!context) {\r\n\t\t\tcontext = this.$el;\r\n\t\t}\r\n\t\r\n\t\treturn context[method](selector);\r\n\t}\r\n\t\r\n\tgetLang(key, replaces) : string {\r\n\t\tlet langKey;\r\n\t\tlet result;\r\n\t\r\n\t\tif (this.options.lang != null && key in this.options.lang) {\r\n\t\t\tresult = this.options.lang[key];\r\n\t\t} else {\r\n\t\t\tlangKey = this.options.langPrefix + key;\r\n\t\t\tresult = BX.message(langKey) || '';\r\n\t\t}\r\n\t\r\n\t\tif (result && replaces) {\r\n\t\t\tresult = compileTemplate(result, replaces);\r\n\t\t}\r\n\t\r\n\t\treturn result;\r\n\t}\r\n}\r\n","// @flow\r\n\r\nexport function compileTemplate(template: string, replaces: Object) {\r\n\tlet result = template;\r\n\r\n\tfor (const key in replaces) {\r\n\t\tif (!replaces.hasOwnProperty(key)) { continue; }\r\n\r\n\t\tconst replaceKey = '#' + key + '#';\r\n\t\tconst replaceValue = replaces[key];\r\n\r\n\t\tdo {\r\n\t\t\tresult = result.replace(replaceKey, replaceValue);\r\n\t\t} while (result.indexOf(replaceKey) !== -1);\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function htmlToElement(html, tag = 'div') {\r\n\tconst renderer = document.createElement(tag);\r\n\r\n\trenderer.innerHTML = html;\r\n\r\n\treturn renderer.firstElementChild;\r\n}","import {Skeleton} from \"../../../plugin/skeleton\";\r\n\r\n// noinspection JSUnresolvedVariable\r\nconst $ = window.AvitoJQuery ?? window.$;\r\n\r\n// noinspection JSUnusedGlobalSymbols\r\nexport class CourierAddress extends Skeleton {\r\n\r\n\tstatic defaults = {\r\n\t\turl: '/bitrix/tools/avito.export/courieraddress/getcourierdeliveryrange.php',\r\n\t\torderId: null,\r\n\t\texchangeId: null,\r\n\r\n\t\terrorMessageElement: '[data-entity=\"error-message\"]',\r\n\r\n\t\tlang: {},\r\n\t\tlangPrefix: 'AVITO_EXPORT_ADMIN_COURIER_ADDRESS_'\r\n\t}\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tsuper(element, options);\r\n\t\tthis.bind();\r\n\t\tthis.boot();\r\n\t}\r\n\r\n\tbind() : void {\r\n\t\tthis.handleChange(true);\r\n\t}\r\n\r\n\tunbind() : void {\r\n\t\tthis.handleChange(false);\r\n\t}\r\n\r\n\thandleChange(dir: Boolean) : void {\r\n\t\tthis.$el[dir ? 'on' : 'off']('change', this.onChange);\r\n\t}\r\n\r\n\tonChange = () : void => {\r\n\t\tconst address = this.el.value.trim();\r\n\r\n\t\tif (address === '') {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.reset();\r\n\t\t} else {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.reload(address);\r\n\t\t}\r\n\t}\r\n\r\n\tboot() : void {\r\n\t\tconst address = this.$el.val().trim();\r\n\r\n\t\tif (address === '') {\r\n\t\t\tthis.reset();\r\n\t\t} else {\r\n\t\t\tthis.reload(address);\r\n\t\t}\r\n\t}\r\n\r\n\tavitoError(data) : void {\r\n\t\tthis.errorElement().text(data.message);\r\n\t}\r\n\r\n\tserverError(data) : void {\r\n\t\tthis.errorElement().text(`${data.statusText} ${data.status}`);\r\n\t}\r\n\r\n\tclearError() : void {\r\n\t\tthis.errorElement().text('');\r\n\t}\r\n\r\n\terrorElement() : JQuery {\r\n\t\treturn this.getElement('errorMessage', this.$el, 'nextAll');\r\n\t}\r\n\r\n\treload(address: string) : void {\r\n\t\t$.ajax({\r\n\t\t\ttype: 'POST',\r\n\t\t\turl: this.options.url,\r\n\t\t\tdataType: 'json',\r\n\t\t\tdata: {\r\n\t\t\t\t'orderId': this.options.orderId,\r\n\t\t\t\t'exchangeId': this.options.exchangeId,\r\n\t\t\t\t'address': address,\r\n\t\t\t},\r\n\t\t\tsuccess: (data) => {\r\n\t\t\t\tif (data?.success !== true) {\r\n\t\t\t\t\tthis.avitoError(data);\r\n\t\t\t\t\tthis.reset();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.eventAnchor().triggerHandler('avitoCourierTime', {\r\n\t\t\t\t\toptions: data.options,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\terror: (data) => {\r\n\t\t\t\tthis.serverError(data);\r\n\t\t\t\tthis.reset();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treset() : void {\r\n\t\tthis.eventAnchor().triggerHandler('avitoCourierAddressReset');\r\n\t}\r\n\r\n\teventAnchor() : JQuery {\r\n\t\tconst form = this.$el.closest('form');\r\n\r\n\t\treturn form.length > 0 ? form : $(document);\r\n\t}\r\n}"],"names":["$","window","AvitoJQuery","Skeleton","constructor","element","options","$el","el","this","Object","assign","defaults","data","destroy","getElement","key","context","method","selector","getElementSelector","getNode","optionKey","getTemplate","option","optionFirstSymbol","substring","result","html","document","getLang","replaces","langKey","lang","langPrefix","BX","message","template","hasOwnProperty","replaceKey","replaceValue","replace","indexOf","compileTemplate","CourierAddress","onChange","address","value","trim","clearError","reset","reload","bind","boot","handleChange","unbind","dir","val","avitoError","errorElement","text","serverError","statusText","status","ajax","type","url","dataType","orderId","exchangeId","success","eventAnchor","triggerHandler","error","form","closest","length","errorMessageElement"],"mappings":"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"}