this.BX=this.BX||{},this.BX.AvitoExport=this.BX.AvitoExport||{},function(e){"use strict";var t;const n=null!=(t=window.AvitoJQuery)?t:window.$;class s{constructor(e,t={}){this.$el=n(e),this.el=this.$el[0],this.options=Object.assign({},this.constructor.defaults,this.$el.data(),t)}destroy(){this.el=null}getElement(e,t,n){const s=this.getElementSelector(e);return this.getNode(s,t,n||"find")}getElementSelector(e){const t=e+"Element";return this.options[t]}getTemplate(e){const t=e+"Template",n=this.options[t],s=n.substring(0,1);let i;return i="."===s||"#"===s?this.getNode(n).html():n,i}getNode(e,t,s="find"){return"#"===e.substring(0,1)?t=n(document):t||(t=this.$el),t[s](e)}getLang(e,t){let n,s;return null!=this.options.lang&&e in this.options.lang?s=this.options.lang[e]:(n=this.options.langPrefix+e,s=BX.message(n)||""),s&&t&&(s=function(e,t){let n=e;for(const e in t){if(!t.hasOwnProperty(e))continue;const s="#"+e+"#",i=t[e];do{n=n.replace(s,i)}while(-1!==n.indexOf(s))}return n}(s,t)),s}}var i;s.defaults={lang:{},langPrefix:null};const o=null!=(i=window.AvitoJQuery)?i:window.$;class r extends s{constructor(e,t={}){super(e,t),this.onClick=()=>{this.openEditWindow(),this.refreshDelay()},this.onPersonTypeChange=()=>{this.refreshDelay(100)},this.refresh=()=>{const e=this.getPersonTypeId(),t=this.getUserId();this.isEmptyValue(e)?this.refreshInput([]):(clearTimeout(this._refreshDelay),o.ajax({url:this.options.refreshUrl,type:"POST",data:{personTypeId:e,userId:t},dataType:"json"}).then(this.refreshEnd))},this.refreshEnd=e=>{var t;e&&"ok"===e.status?this.refreshInput(e.enum):alert(this.getLang("REFRESH_FAIL",{MESSAGE:null!=(t=e.message)?t:""}))},this.bind()}bind(){this.handleClick(!0),this.handlePersonTypeChange(!0)}unbind(){this.handleClick(!1),this.handlePersonTypeChange(!1)}handleClick(e){this.$el[e?"on":"off"]("click",this.onClick)}handlePersonTypeChange(e){this.getFormInput("personType")[e?"on":"off"]("change",this.onPersonTypeChange)}openEditWindow(){const e=this.getEditUrl();return this.openWindow(e)}getEditUrl(){const e=this.getEditQuery();let t=this.options.editUrl;return""!==e&&(t+=(-1===t.indexOf("?")?"?":"&")+e),t}getEditQuery(){const e=this.getInput().val(),t=[];return t.push("personTypeId="+encodeURIComponent(this.getPersonTypeId())),t.push("userId="+encodeURIComponent(this.getUserId())),this.isEmptyValue(e)||t.push("id="+encodeURIComponent(e)),t.join("&")}refreshDelay(e=this.options.refreshTimeout){this._refreshDelay=setTimeout(this.refresh,e)}refreshInput(e){const t=this.getInput(),n=this.getElement("option",t),s=[];let i=null;for(const o of e){let e=this.searchOption(n,o.ID);null==e?e=this.createOption(t,o):e.textContent!==o.VALUE&&(e.textContent=o.VALUE),null==i&&(i=e),s.push(o.ID)}for(let e=0;e<n.length;e++){const t=n[e];-1!==s.indexOf(t.value)||this.isEmptyValue(t.value)||t.parentElement.removeChild(t)}null!==i&&this.isEmptyValue(t.val())&&this.selectOption(i)}searchOption(e,t){let n;for(let s=0;s<e.length;s++){const i=e[s];if(String(i.value)===String(t)){n=i;break}}return n}createOption(e,t){const n=document.createElement("option");return n.value=t.ID,n.textContent=t.VALUE,e.append(n),n}selectOption(e){e.selected=!0}getInput(){const e=this.$el.parent();return this.getElement("input",e)}isEmptyValue(e){return null===e||""===e}getForm(){return o(this.el.form)}getFormInput(e){const t=this.getForm();return this.getElement(e,t)}getPersonTypeId(){const e=this.getFormInput("personType");let t;return t=e.length>0?e.val():this.options.personTypeId,t}getUserId(){return this.options.userId}openWindow(e){const t=window.open(e,"_blank");return t.focus(),t}}r.defaults={editUrl:null,refreshUrl:null,refreshTimeout:2e3,personTypeId:null,personTypeElement:'select[name="PERSON_TYPE"]',userId:null,inputElement:"select",optionElement:"option",lang:{},langPrefix:"AVITO_EXPORT_ADMIN_BUYER_PROFILE_"},e.BuyerProfile=r}(this.BX.AvitoExport.Admin=this.BX.AvitoExport.Admin||{});
//# sourceMappingURL=script.js.map
