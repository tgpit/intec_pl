this.BX=this.BX||{},this.BX.AvitoExport=this.BX.AvitoExport||{},function(e){"use strict";var t;const n=null!=(t=window.AvitoJQuery)?t:window.$;class s{constructor(e,t={}){this.$el=n(e),this.el=this.$el[0],this.options=Object.assign({},this.constructor.defaults,this.$el.data(),t)}destroy(){this.el=null}getElement(e,t,n){const s=this.getElementSelector(e);return this.getNode(s,t,n||"find")}getElementSelector(e){const t=e+"Element";return this.options[t]}getTemplate(e){const t=e+"Template",n=this.options[t],s=n.substring(0,1);let i;return i="."===s||"#"===s?this.getNode(n).html():n,i}getNode(e,t,s="find"){return"#"===e.substring(0,1)?t=n(document):t||(t=this.$el),t[s](e)}getLang(e,t){let n,s;return null!=this.options.lang&&e in this.options.lang?s=this.options.lang[e]:(n=this.options.langPrefix+e,s=BX.message(n)||""),s&&t&&(s=function(e,t){let n=e;for(const e in t){if(!t.hasOwnProperty(e))continue;const s="#"+e+"#",i=t[e];do{n=n.replace(s,i)}while(-1!==n.indexOf(s))}return n}(s,t)),s}}var i;s.defaults={lang:{},langPrefix:null};const r=null!=(i=window.AvitoJQuery)?i:window.$;var o;const l=null!=(o=window.AvitoJQuery)?o:window.$,h=new class{constructor(){this.queries={},this.loaded={}}load(e,t){return new Promise(((n,s)=>{const i=`${e}-${t}`;if(null!=this.loaded[i])return void n(this.loaded[i]);if(null!=this.queries[i])return void n(this.queries[i]);const r=this.query(e,t);return r.then((e=>this.loaded[i]=e)).then(n,s).finally((()=>{this.queries[i]=null})),this.queries[i]=r,r}))}query(e,t){return new Promise(((n,s)=>{r.ajax({url:e,type:"POST",data:{personTypeId:t},dataType:"json"}).then(this.queryEnd.bind(this,n,s),this.queryStop.bind(this,s))}))}queryEnd(e,t,n){var s;n&&"ok"===n.status?e(n.enum):t(null!=(s=n.message)?s:"unknown")}queryStop(e){e(new Error("failed"))}};class u extends s{constructor(e,t={}){super(e,t),this.onPersonTypeChange=()=>{this.refreshDelay()},this.refresh=()=>{const e=this.getPersonTypeId();this.isEmptyValue(e)?this.draw([]):(clearTimeout(this._refreshDelay),h.load(this.options.refreshUrl,e).then(this.draw))},this.draw=e=>{const t=this.$el.val();this.clear(),this.appendNew(e,t)},this.bind()}bind(){this.handlePersonTypeChange(!0)}unbind(){this.handlePersonTypeChange(!1)}handlePersonTypeChange(e){this.getFormInput("personType")[e?"on":"off"]("change",this.onPersonTypeChange)}refreshDelay(){this._refreshDelay=setTimeout(this.refresh,this.options.refreshTimeout)}clear(){this.getElement("option").filter(((e,t)=>!this.isEmptyValue(t.value))).remove()}appendNew(e,t){for(const n of e){const e=this.createOption(n);this.$el.append(e),null!=t&&String(t)===String(e.value)&&(e.selected=!0)}}createOption(e){const t=document.createElement("option");return t.value=e.ID,t.textContent=e.VALUE,t}isEmptyValue(e){return null===e||""===e}getForm(){return l(this.el.form)}getFormInput(e){const t=this.getForm();return this.getElement(e,t)}getPersonTypeId(){const e=this.getFormInput("personType");let t;return t=e.length>0?e.val():this.options.personTypeId,t}}u.defaults={refreshUrl:null,refreshTimeout:100,personTypeId:null,personTypeElement:'select[name="PERSON_TYPE"]',inputElement:"select",optionElement:"option"},e.OrderProperty=u}(this.BX.AvitoExport.Admin=this.BX.AvitoExport.Admin||{});
//# sourceMappingURL=script.js.map
