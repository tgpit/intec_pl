this.BX=this.BX||{},this.BX.AvitoExport=this.BX.AvitoExport||{},function(t){"use strict";var e;const o=null!=(e=window.AvitoJQuery)?e:window.$;class s{constructor(t,e={}){this.$el=o(t),this.el=this.$el[0],this.options=Object.assign({},this.constructor.defaults,this.$el.data(),e)}destroy(){this.el=null}getElement(t,e,o){const s=this.getElementSelector(t);return this.getNode(s,e,o||"find")}getElementSelector(t){const e=t+"Element";return this.options[e]}getTemplate(t){const e=t+"Template",o=this.options[e],s=o.substring(0,1);let n;return n="."===s||"#"===s?this.getNode(o).html():o,n}getNode(t,e,s="find"){return"#"===t.substring(0,1)?e=o(document):e||(e=this.$el),e[s](t)}getLang(t,e){let o,s;return null!=this.options.lang&&t in this.options.lang?s=this.options.lang[t]:(o=this.options.langPrefix+t,s=BX.message(o)||""),s&&e&&(s=function(t,e){let o=t;for(const t in e){if(!e.hasOwnProperty(t))continue;const s="#"+t+"#",n=e[t];do{o=o.replace(s,n)}while(-1!==o.indexOf(s))}return o}(s,e)),s}}s.defaults={lang:{},langPrefix:null};class n extends s{constructor(t,e={}){super(t,e),this.onDeleteClick=()=>{this.options.onDelete(this)},this.bind()}clone(){const t=this.$el.clone(!1,!1),e=new n(t,this.options);return e.clearClone(),e}destroy(){this.destroyCategory(),this.unbind(),super.destroy()}destroyCategory(){this._category.destroy()}boot(){this.bootCategory()}bootCategory(){const t=this.getElement("category");this._category=new BX.AvitoExport.Admin.Property.Category(t,{component:"avito.export:admin.property.category",language:"ru",allowClear:!1,lang:{VALUE_PLACEHOLDER:this.getLang("VALUE_PLACEHOLDER")}})}bind(){this.handleDeleteClick(!0)}unbind(){this.handleDeleteClick(!1)}handleDeleteClick(t){this.getElement("delete")[t?"on":"off"]("click",this.onDeleteClick)}updateControlName(t){for(const e of this.controls()){const o=e.attr("name"),s=null!=o?/\[\w+](\[])?$/.exec(o):null;if(null==s)continue;const n=t+s[0];e.attr("name",n)}}enableControls(){for(const t of this.controls())t.prop("disabled",!1)}disableControls(){for(const t of this.controls())t.prop("disabled",!0)}controls(){return[this.getElement("category"),this.getElement("limit")]}clear(){for(const t of this.controls())t.is("select")?t.find("option").remove():t.val("")}clearClone(){for(const t of this.controls()){if(!t.is("select"))continue;const e=t.next();t.hasClass("select2-hidden-accessible")&&(t.removeClass("select2-hidden-accessible").removeAttr("data-select2-id").removeAttr("aria-hidden").removeAttr("tabindex"),t.find("optgroup").removeAttr("data-select2-id"),t.find("option").removeAttr("data-select2-id")),e.hasClass("select2")&&e.remove()}}}n.defaults={categoryElement:'[data-entity="category"]',limitElement:'[data-entity="limit"]',deleteElement:'[data-entity="delete"]',onDelete:()=>{},lang:{}};class i extends s{constructor(t,e={}){super(t,e),this._rows=[],this.bootRows(),this.bootAddButton()}bootRows(){const t=this.getElement("row"),e=[];t.each(((t,o)=>{const s=new n(o,{onDelete:t=>this.delete(t),lang:this.options.lang});s.boot(),e.push(s)})),this._rows=e,this._nextIndex=e.length}delete(t){this._rows.length>1?this.removeRow(t):this.deactivateRow(t)}removeRow(t){const e=t.$el,o=this._rows.indexOf(t);if(-1===o)throw new Error("cant delete unknown row");t.destroy(),e.remove(),this._rows.splice(o,1)}activateRow(t){t.$el.removeClass("avito--hidden"),t.enableControls()}deactivateRow(t){t.$el.addClass("avito--hidden"),t.disableControls()}bootAddButton(){this.getElement("addButton").on("click",(()=>this.add()))}add(){const t=this._rows[this._rows.length-1];if(null==t)throw new Error("at least row must be exists");t.$el.hasClass("avito--hidden")?this.activateRow(t):this.insertRow(t.clone(),t.$el)}insertRow(t,e){t.$el.insertAfter(e),t.updateControlName(this.options.baseName+"["+this._nextIndex+"]"),t.clear(),t.boot(),this._rows.push(t),++this._nextIndex}}i.defaults={component:null,signedParameters:null,baseName:null,nextIndex:0,newRow:null,rowElement:'[data-entity="row"]',addButtonElement:'[data-entity="addButton"]'},t.CategoryLimit=i}(this.BX.AvitoExport.Feed=this.BX.AvitoExport.Feed||{});
//# sourceMappingURL=script.js.map
