this.BX=this.BX||{},this.BX.AvitoExport=this.BX.AvitoExport||{},function(t){"use strict";const e=window.AvitoVue3.reactive({component:String,setupId:String,userId:String,chats:[],selectChat:[],messages:[],error:null,chatId:null,chat:null,otherUserUrl:String,isMessagesLoading:!0,showError:!1,messageMenuId:null,limitChat:50,offsetChat:0,limitMessage:50,offsetMessage:0,isLoadingMessageScroll:!1,stopMessageScroll:!1,scrollButton:!1,scrollButtonCircle:!1,checkMessagesSending:!1,unshiftMessage(t){if(this.messages.length>0){const e=this.messages[0];t.rendering_avatar=e.author_id!==t.author_id,t.delimiter=!1}this.messages.unshift(t)},pushChatMessage(t,e=!0){this.chats[t.chat_id].updated=t.created,this.chats[t.chat_id].read=e,this.chats[t.chat_id].message=t.chat_message.text},pushMessages(t){const e=t[0],s=this.messages[this.messages.length-1];s.rendering_avatar=s.author_id!==e.author_id;for(let e of t)s.delimiter===e.delimiter&&(s.delimiter=!1),this.messages.push(e)},readMessages(){e.messages.forEach(((t,s)=>{t.isRead||(e.messages[s].isRead=!0)}))},pushChats(t){this.chats.push(t)},deleteError(){this.error=null},pushError(t){this.error=t},sortMessages(){e.messages.sort(((t,e)=>e.created-t.created))},sortChats(){const t=Object.keys(this.chats);let e={};t.sort(((t,e)=>this.chats[e].updated-this.chats[t].updated)),t.forEach((t=>{e[t]=this.chats[t]})),this.chats=e},setMessages(t){this.messages=t},setChatId(t){this.chatId=t,this.chat=this.chats[this.chatId];for(const t in this.chat.users)parseInt(t)!==this.userId&&(this.otherUserUrl=this.chat.users[t].url)},setShowError(t){this.showError=t},author(t){var e;return t<=0?null:null==(e=this.chats[this.chatId])?void 0:e.users[t]},clearDataForMessages(){this.isLoadingMessageScroll=!1,this.stopMessageScroll=!1,this.scrollButtonCircle=!1,this.offsetMessage=0}}),s={props:["chatInfo"],setup:()=>({store:e}),template:"\n          <div class=\"avito-chat-list-element\" :class=\"chatInfo.id === store.chatId ? 'avito-chat-list-element-selected' : ''\" :data-chat-id=\"chatInfo.id\">\n          \t\t<div class=\"avito-chat-context-preview-root\">\n\t\t          <div :style=\"{ backgroundImage: 'url(' + chatInfo.img + ')' }\"></div>\n\t            </div>\n\t            <div :class=\"'avito-chat-channel-preview-info ' + (chatInfo.type !== 'system' ? chatInfo.direction : '') + (chatInfo.read ? ' read' : '')\">\n\t              <div class=\"avito-chat-name\">{{ chatInfo.name }}</div>\n\t              <div class=\"avito-chat-title\">{{ chatInfo.title }}</div>\n\t              <div class=\"avito-chat-last-message\">{{ chatInfo.message }}</div>\n\t            </div>\n          </div>\n    "},a={template:'\n\t\t<div class="avito-chat-list-element" \n\t\t     v-for="(n, index) in 5"\n             :key="index">\n\t\t\t<div class="avito-chat-context-preview-root">\n\t\t\t\t<div class="avito-chat-list-loading"></div>\n\t\t\t</div>\n\t\t\t<div class="avito-chat-channel-preview-info">\n\t\t\t\t<div class="avito-chat-name avito-chat-list-loading"></div>\n\t\t\t\t<div class="avito-chat-title avito-chat-list-loading"></div>\n\t\t\t\t<div class="avito-chat-last-message avito-chat-list-loading"></div>\n\t\t\t</div>\n\t\t</div>\n    '},i={mounted(){document.querySelector(".avito-chat-preloader-circle-row").scrollIntoView({block:"nearest",inline:"nearest"})},template:'\n\t  <div class="avito-chat-preloader-circle-row">\n      \t<div class="avito-chat-preloader-circle avito-chat-preloader-circle-rotate"></div>\n      </div>\n    '};class n{static check(t){const s=t.data;if("error"!==s.status)return t.data.data;e.pushError(s.message)}}class o{static async chats(){return await BX.ajax.runComponentAction(e.component,"chats",{data:{setupId:e.setupId,userId:e.userId,limit:e.limitChat,offset:e.offsetChat}}).then((t=>n.check(t)))}static async chatById(t){return await BX.ajax.runComponentAction(e.component,"chatById",{data:{setupId:e.setupId,userId:e.userId,chatId:t}}).then((t=>n.check(t)))}static async messagesByChatId(t){return await BX.ajax.runComponentAction(e.component,"messagesByChatId",{data:{setupId:e.setupId,userId:e.userId,chatId:t,limit:e.limitMessage,offset:e.offsetMessage}}).then((t=>n.check(t)))}static async sendMessage(t){return await BX.ajax.runComponentAction(e.component,"sendMessage",{data:{setupId:e.setupId,userId:e.userId,chatId:e.chatId,message:t}}).then((t=>n.check(t)))}static async readChat(t){return await BX.ajax.runComponentAction(e.component,"readChat",{data:{setupId:e.setupId,userId:e.userId,chatId:t}}).then((t=>n.check(t)))}static async deleteMessage(t){return await BX.ajax.runComponentAction(e.component,"deleteMessage",{data:{setupId:e.setupId,userId:e.userId,chatId:e.chatId,messageId:t}}).then((t=>n.check(t)))}static async checkNewMessage(){return await BX.ajax.runComponentAction(e.component,"checkNewMessages",{data:{setupId:e.setupId,checkTimestamp:e.checkTimestamp}}).then((t=>n.check(t)))}}const c={"quote-link":'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" style="width: 32px; height: 32px; color: currentcolor;"><path d="M6.78564 10.1495L4.26255 12.6726C2.3117 14.6235 2.3117 17.7864 4.26255 19.7373L4.76717 20.2419C6.43933 21.9141 9.15043 21.9141 10.8226 20.2419L13.8503 17.2142M17.2144 13.8501L19.7375 11.327C21.6884 9.37613 21.6884 6.21318 19.7375 4.26233L19.2329 3.75771C17.5607 2.08555 14.8496 2.08555 13.1775 3.75771L10.1498 6.78542M8.2995 15.7003L15.7006 8.29927" stroke="currentColor" stroke-width="1.90303" stroke-linecap="round"></path></svg>',"quote-video":'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="width: 32px; height: 32px; color: currentcolor;"><path d="M2 6a1 1 0 0 1 1-1h13a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V6ZM22 8.387v7.226a1 1 0 0 1-1.316.948L17 15.333V8.667l3.684-1.228A1 1 0 0 1 22 8.387Z" fill="currentColor"></path></svg>',"quote-location":'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="width: 32px; height: 32px; color: currentcolor;"><path d="M2.649 10.939c-.86-.323-.867-1.536-.011-1.869l18-7c.81-.315 1.61.484 1.294 1.295l-7 18c-.333.856-1.546.848-1.868-.011l-2.84-7.575-7.575-2.84z" fill="currentColor"></path></svg>',"send-button":'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="width: 24px; height: 24px; color: currentcolor;"><path d="M22 12a1 1 0 0 1-.574.905l-17 8a1 1 0 0 1-1.39-1.168l1.5-5.5a1 1 0 0 1 .605-.67L9.214 12l-4.073-1.567a1 1 0 0 1-.606-.67l-1.5-5.5a1 1 0 0 1 1.39-1.168l17 8A1 1 0 0 1 22 12Z" fill="currentColor"></path></svg>'},l={components:{ChatList:{data:()=>({isLoading:!0,isLoadingScroll:!1,stopScroll:!1,_checkMessagesScheduleTimeout:null,_checkMessagesStartFrame:null,_checkMessagesStartTimeout:null}),components:{ChatListElement:s,LoaderList:a,LoaderScroll:i},setup:()=>({store:e}),mounted(){o.chats().then((async t=>{null!==e.chatId&&null==t[e.chatId]&&await o.chatById(e.chatId).then((s=>{t=Object.assign({[e.chatId]:s},t)})),e.chats=t})).then((()=>{if(this.isLoading=!1,null!==e.chatId)e.setChatId(e.chatId),this.messagesByChatId(e.chatId);else{const t=Object.keys(e.chats)[0];e.setChatId(t),this.messagesByChatId(t)}}))},methods:{handleScroll:function(t){const s=t.currentTarget;s.offsetHeight+s.scrollTop>=s.scrollHeight&&!this.isLoadingScroll&&!this.stopScroll&&(e.offsetChat+=e.limitChat,this.isLoadingScroll=!0,o.chats().then((t=>{if(this.isLoadingScroll=!1,Object.keys(t).length>0)for(const[s,a]of Object.entries(t))e.chats[s]=a;else this.stopScroll=!0})))},selectChat:function(t){if(e.isMessagesLoading||e.isLoadingMessageScroll||this.isLoadingScroll)return;const s=t.currentTarget.getAttribute("data-chat-id");this.toggleChat(),e.chatId!==s&&(e.isMessagesLoading=!0,e.setChatId(s),e.clearDataForMessages(),this.messagesByChatId(s))},toggleChat:function(){const t=document.querySelector(".avito-chat-list"),e=document.querySelector(".avito-chat-area");t.classList.replace("show","hide"),e.classList.replace("hide","show")},messagesByChatId:function(t){o.messagesByChatId(t).then((t=>{e.setMessages(t),e.isMessagesLoading=!1,this.clearCheckMessages()})).then((()=>o.readChat(t).then((s=>{e.chats[t].read=!0})))).then((()=>{this.scheduleCheckMessages()}))},scheduleCheckMessages:function(){this._checkMessagesScheduleTimeout=setTimeout(this.startCheckMessages.bind(this),1e4)},startCheckMessages:function(t){this._checkMessagesStartFrame=requestAnimationFrame(this.checkMessages.bind(this)),this._checkMessagesStartTimeout=setTimeout(this.checkMessages.bind(this),6e5)},clearCheckMessages:function(){clearTimeout(this._checkMessagesScheduleTimeout),clearTimeout(this._checkMessagesStartTimeout),cancelAnimationFrame(this._checkMessagesStartFrame)},checkMessages:function(){this.clearCheckMessages(),o.checkNewMessage().then((t=>{let s=!1;if(e.checkTimestamp=t.checkTimestamp,null!=(null==t?void 0:t.messages)&&t.messages.length>0){for(let a of t.messages){let t=!1;for(let s of e.messages)if(s.id===a.id){t=!0,s.isRead=a.isRead;break}t||e.chatId!==a.chat_id?null==e.chats[a.chat_id]?o.chatById(a.chat_id).then((t=>{e.chats=Object.assign({[a.chat_id]:t},e.chats)})):e.chatId!==a.chat_id&&e.pushChatMessage(a,!1):(e.scrollButtonCircle=!0,e.unshiftMessage(a),e.pushChatMessage(a),e.readMessages(),s=!0)}e.sortChats()}return s})).then((t=>{t&&o.readChat(e.chatId),this.scheduleCheckMessages()})).catch((()=>{this.scheduleCheckMessages()}))}},template:'\n\t\t<div class="avito-chat-list hide" @scroll="handleScroll">\n\t\t\t<LoaderList v-if="isLoading"/>\n\t\t\t<ChatListElement \n\t\t\t\tv-if="!isLoading && store.chats !== null" \n\t\t\t\tv-for="chat in store.chats" :chatInfo="chat" :key="chat.id" \n\t\t\t\t@click="selectChat"/>\n\t\t\t<LoaderScroll v-if="isLoadingScroll"/>\n\t\t</div>\n    '},ChatArea:{components:{Messages:{components:{Message:{components:{Quote:{props:{quote:Object,authorName:String,messageType:String},setup(t){const e=t.quote,s=e.type;let a="",i=null,n=!1,o=c["quote-"+s];if("text"===s)a=e.content.text;else if("link"===s)a=e.content.link.url;else if("image"===s){const t=e.content.image.sizes;i=t[Object.keys(t)[0]],a=e.content.text,n=!0}else"item"===s?(i=e.content.item.image_url,a=e.content.item.title,n=!0):"location"===s?a=e.content.location.text:"video"===s&&(a=e.content.text);return{image:i,text:a,isPicture:n,icon:o}},methods:{scrollToMessage:function(t){const e=this.quote.id,s=document.getElementById(e);null!=s&&s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}},template:'\n\t\t<div :class="\'avito-chat-message-quote\' + (messageType === \'image\' ? \' margin\' : \'\')" @click="scrollToMessage">\n\t\t\t<div class="avito-chat-message-quote-quote-verticalLine"></div>\n\t\t\t<div v-if="icon" v-html="icon" class="avito-chat-message-quote-icon"></div>\n            <div v-if="isPicture" class="avito-chat-massage-quote-image">\n              <div class="avito-chat-massage-quote-image-preview"\n                   :style="image !== null ? \'background-image: url(\' + image +\');\' : \'\'">\n              </div>\n            </div>\n            <div class="avito-chat-massage-quote-info">\n              <div class="avito-chat-massage-quote-author_name">{{ authorName }}</div>\n              <div class="avito-chat-massage-quote-text">{{ text }}</div>\n            </div>\n\t\t</div>\n    '},ImageMessage:{props:{content:Object,hasQuote:Boolean},setup(t){const e=Object.keys(t.content.sizes),s=e.length-1;return{image:t.content.sizes[e[s]]}},methods:{imageOpen(){const t=this.content.sizes[Object.keys(this.content.sizes)[0]];window.open(t)}},template:"\n\t\t<div class=\"avito-chat-message-image\" @click=\"imageOpen\">\n\t\t\t<div :class=\"'avito-chat-message-image-preview-wrap' + (hasQuote ? ' quote' : '')\">\n\t\t\t  \t<div class=\"avito-chat-message-image-preview\" \n\t\t\t         :style=\"'background-image: linear-gradient(rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05)), url(' + image +');'\"\n\t\t\t    ></div>\n\t\t\t</div>\n\t\t</div>\n\t"},LinkMessage:{props:{content:Object},setup(t){let e=null;const s=t.content;if(s.preview&&s.preview.images){const t=Object.keys(s.preview.images);e=s.preview.images[t[0]]}return{previewImage:e}},template:'\n      \t<div v-if="content.preview" class="avito-chat-message-link">\n\t\t\t<a class="avito-chat-message-link-link" :href="content.url" target="_blank">\n\t\t\t  \t<div class="avito-chat-message-link-picture" \n\t\t\t         :style="previewImage !== null ? \'background-image: url(\' + previewImage +\')\' : \'\'">\n\t\t\t    </div>\n\t\t\t  \t<div class="avito-chat-message-link-info">\n\t\t\t\t  \t<div class="avito-chat-message-link-info-title">\n\t\t\t\t\t  \t{{ content.preview.title }}\n\t\t\t\t    </div>\n\t                <div class="avito-chat-message-link-info-domain">{{ content.preview.domain }}</div>\n\t\t\t    </div>\n\t\t\t</a>\n\t\t</div>\n        <div v-else class="avito-chat-message-text-link">{{ content.text }}</div>\n\t'},LocationMessage:{props:{content:Object},setup:t=>({linkMap:`https://yandex.ru/maps/?pt=${t.content.lon},${t.content.lat}&z=17&l=map`,linkImage:`https://static-maps.yandex.ru/1.x/?l=map&pt=${t.content.lon},${t.content.lat},comma&z=14&size=252,190`}),template:'\n\t  <div class="avito-chat-message-location">\n\t\t<a :href="linkMap" target="_blank" class="avito-chat-message-location-link" :title="content.title">\n          <div v-if="linkImage" class="avito-chat-message-image">\n            <div :class="\'avito-chat-message-image-preview-wrap\'">\n              <div class="avito-chat-message-image-preview"\n                   :style="\'background-image: url(\' + linkImage +\');\'"\n              ></div>\n            </div>\n          </div>\n\t\t  <div :class="\'avito-chat-message-location-text\' + (linkMap ? \' image\' : \'\')">{{ content.title }}</div>\n\t\t</a>\n\t  </div>\n\t'},Actions:{props:{message:Object},setup:()=>({store:e}),computed:{localize:()=>({TEXT:BX.message("MESSAGE_DELETED"),TITLE:BX.message("MESSAGE_DELETE_TITLE")})},methods:{deleteMessage:function(){o.deleteMessage(this.message.id).then((()=>{this.message.content.text=this.localize.TEXT,this.message.type="deleted",this.message.deletable=!1,e.messageMenuId=null}))}},template:'\n        <div class="avito-chat-context-menu">\n            <button type="button" class="avito-chat-menu-item" @click="deleteMessage">\n              <span>{{ localize.TITLE }}</span>\n            </button>\n        </div>\n    '}},props:{messageData:Object,author:Object},methods:{contextMenu:function(){e.messageMenuId===this.messageData.id&&null!==e.messageMenuId?e.messageMenuId=null:e.messageMenuId=this.messageData.id}},setup:()=>({store:e}),template:'\n\t\t<div \n\t\t\t:id="messageData.id"\n\t\t\t:class="\'avito-chat-message-container avito-chat-message-direction-\' + messageData.direction + \' avito-chat-message-type-\' + messageData.type + (messageData.quote ? \' quote\' : \'\')">\n\t\t\t<div v-if="messageData.rendering_avatar && messageData.type === \'system\'" class="avito-chat-message-system-avatar-img"></div>\n\t\t\t<div v-else-if="messageData.rendering_avatar && author !== null" class="avito-chat-message-author">\n\t\t\t  <a class="avito-chat-message-author-avatar" :href="author.url" target="_blank" >\n\t\t\t    <img :src=author.avatar :alt="author.name" class="avito-chat-message-author-avatar-img">\n\t\t\t    <span class="avito-chat-message-author-avatar-char" v-if="author.avatarChar">{{author.avatarChar}}</span>\n\t\t\t  </a>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class="avito-chat-message">\n              \t<Quote v-if="messageData.quote && author !== null" \n                       :quote="messageData.quote" \n                       :messageType="messageData.type" \n                       :authorName="author.name" \n                />\n\n              \t<span v-if="messageData.type === \'text\' \n        \t\t\t|| messageData.type === \'deleted\' \n        \t\t\t|| messageData.type === \'system\'\n        \t\t\t|| messageData.type === \'call\'\n        \t\t\t|| messageData.type === \'video\'"\n                      class="avito-chat-message-text">\n\t              <span v-if="messageData.type === \'call\'">&#9990; </span>{{ messageData.content.text }}\n                </span>\n\n\t\t\t\t<div v-else-if="messageData.type === \'item\'" class="avito-chat-message-item">\n\t\t\t\t\t<a class="avito-chat-message-item-link" :href="messageData.content.item.item_url" target="_blank">\n\t\t\t\t\t  <div class="avito-chat-message-item-picture"\n\t\t\t\t\t       :style="\'background-image: url(\' + messageData.content.item.image_url +\')\'">\n\t\t\t\t\t  </div>\n\t\t\t\t\t  <div class="avito-chat-message-item-info">\n\t\t\t\t\t    <div class="avito-chat-message-item-info-title">\n\t\t\t\t\t      {{ messageData.content.item.title }}\n\t\t\t\t\t    </div>\n\t\t\t\t\t    <div class="avito-chat-message-item-info-domain">avito.ru</div>\n\t\t\t\t\t  </div>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\n              \t<ImageMessage v-else-if="messageData.type === \'image\'" :content="messageData.content.image" :hasQuote="messageData.quote != null"/>\n              \t<LinkMessage v-else-if="messageData.type === \'link\'" :content="messageData.content.link"/>\n              \t<LocationMessage v-else-if="messageData.type === \'location\'" :content="messageData.content.location"/>\n\n\t\t\t\t<div :class="[\n\t\t\t\t\t\tmessageData.deletable === true ? \'avito-chat-message-status hover\' : \'avito-chat-message-status\',\n\t\t\t\t\t\tstore.messageMenuId !== messageData.id || store.messageMenuId === null ? \'show\' : \'hide\',\n\t\t\t\t\t]">\n\t\t\t\t\t<div class="avito-chat-message-status-mark" v-if="messageData.type !== \'deleted\' && messageData.direction === \'out\'">\n\t\t\t\t\t  <div class="mark"></div>\n\t\t\t\t\t  <div v-if="messageData.isRead" class="mark"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="time">{{messageData.createdTime}}</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div v-if="messageData.deletable === true" :class="\'avito-chat-message-actions \' + (store.messageMenuId === messageData.id  ? \'show\' : \'hide\')" @click="contextMenu">\n\t\t\t\t\t<div class="avito-chat-message-actions-menu">\n\t\t\t\t\t  <div class="avito-chat-message-actions-menu-button">\n\t\t\t\t\t    <span>\n\t\t\t\t\t      <svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg"\n                               style="width: 24px; height: 24px; color: currentcolor;">\n\t\t\t\t\t        \t<path fill-rule="evenodd"\n                                clip-rule="evenodd"\n                                d="M7.4 9a1.6 1.6 0 113.2 0 1.6 1.6 0 01-3.2 0zM2.067 9a1.6 1.6 0 113.2 0 1.6 1.6 0 01-3.2 0zm10.667 0a1.6 1.6 0 113.2 0 1.6 1.6 0 01-3.2 0z"\n                                fill="currentColor">\n\t\t\t\t\t\t        </path>\n\t\t\t\t\t      </svg>\n\t\t\t\t\t    </span>\n\t\t\t\t\t  </div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Actions v-if="store.messageMenuId === messageData.id" :message="messageData" />\n\t\t\t\t</div>\n\t\t\t  \n            </div>\n\t\t</div>\n        <div v-if="messageData.delimiter" class="avito-chat-message-time-delimiter">{{ messageData.delimiter }}</div>\n    '},LoaderMessages:{template:'\n\t\t<div class="avito-chat-message-container"\n\t\t     v-for="n in 3"\n             :class="n % 2 === 0 ? \'avito-chat-message-direction-out\' : \'avito-chat-message-direction-in\'"\n             :key="n">\n            <div class="avito-chat-message-loader">\n              <div class="avito-chat-name avito-chat-list-loading"></div>\n              <div class="avito-chat-title avito-chat-list-loading"></div>\n              <div class="avito-chat-last-message avito-chat-list-loading"></div>\n            </div>\n\t\t</div>\n    '},LoaderScroll:i,ScrollButton:{methods:{scrollBottom:function(){document.querySelector(".avito-chat-messages").scrollTo({top:0,behavior:"smooth"})}},setup:()=>({store:e}),template:'\n\t\t<div :class="\'avito-chat-message-history-scroll-button\' + (!store.scrollButton ? \' hide\' : \'\')" @click="scrollBottom">\n\t\t\t<div class="avito-chat-message-history-scroll-button-content">\n\t\t\t\t<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"\n\t\t\t\t\tclass="avito-chat-messages-history-scroll-button-icon"\n\t\t\t\t\tstyle="width: 20px; height: 20px;">\n\t\t\t\t<path\n\t\t\t\t\td="M13.138 5.529c.26.26.26.682 0 .943L8.47 11.138a.667.667 0 01-.943 0L2.862 6.472a.667.667 0 11.942-.943L8 9.724l4.195-4.195c.26-.26.682-.26.943 0z"\n\t\t\t\t\tfill="currentColor"></path>\n\t\t\t\t</svg>\n\t\t\t  \t<div :class="\'avito-chat-messages-history-scroll-button-circle\' + (store.scrollButtonCircle ? \' show\' : \'\')"></div>\n\t\t\t</div>\n\t\t</div>\n\t'},EmptyMessages:{computed:{localize:()=>({TITLE:BX.message("EMPTY_MESSAGES_TITLE")})},template:'\n\t\t<div class="avito-chat-empty-messages">\n\t\t\t<div class="avito-chat-empty-messages-placeholder"></div>\n\t\t\t<div class="avito-chat-empty-messages-title">{{localize.TITLE}}</div>\n\t\t</div>\n    '}},mounted(){document.addEventListener("click",this.hideContextMenu)},methods:{handleScroll:function(t){const s=t.currentTarget,a=Math.abs(s.scrollTop);e.scrollButton=a>1,a>1&&s.offsetHeight+a>=s.scrollHeight-10&&!e.isLoadingMessageScroll&&!e.stopMessageScroll&&(e.offsetMessage+=e.limitMessage,e.isLoadingMessageScroll=!0,o.messagesByChatId(e.chatId).then((t=>{e.isLoadingMessageScroll=!1,t.length>0?e.pushMessages(t):e.stopMessageScroll=!0})))},hideContextMenu:function(t){const s=document.querySelector(".avito-chat-message-actions.show");null==s||s.contains(t.target)||(s.classList.remove("show"),s.classList.add("hide"),e.messageMenuId=null)}},setup:()=>({store:e}),template:'\n      <div class="avito-chat-messages" @scroll="handleScroll">\n        <LoaderMessages v-if="store.isMessagesLoading"/>\n        <EmptyMessages v-if="!store.isMessagesLoading && store.messages.length === 0"/>\n        <Message \n\t        v-if="!store.isMessagesLoading" \n\t        v-for="message in store.messages" \n\t        :messageData="message" \n\t        :key="message.id" \n\t        :author="store.author(message.author_id)" \n        />\n        <LoaderScroll v-if="store.isLoadingMessageScroll"/>\n      </div>\n      <ScrollButton/>\n    '},Input:{data:()=>({message:""}),computed:{localize:()=>({PLACEHOLDER:BX.message("MESSAGE_TEXTAREA_PLACEHOLDER")})},methods:{pressNewLine(t){t.shiftKey||t.preventDefault()},inputText(t){const e=t.currentTarget,s=e.value,a=window.getComputedStyle(e),i=parseInt(a.getPropertyValue("line-height"),10),n=parseInt(a.getPropertyValue("min-height"),10);if(""===s)return void(e.style.height=a.getPropertyValue("min-height"));const o=s.match(/\r?\n/g),c=o?o.length:0;e.style.height=n+i*c+"px"},sendMessage(t){if(!t.shiftKey&&this.message){o.sendMessage(this.message.trim()).then((t=>{e.unshiftMessage(t)})),this.message="";const s=t.currentTarget,a=window.getComputedStyle(s);s.style.height=a.getPropertyValue("min-height")}}},setup:()=>({store:e,buttonIcon:c["send-button"]}),template:'\n\t\t<div class="avito-chat-input-container">\n\t\t\t<div class="avito-chat-textarea">\n\t\t\t\t<textarea \n\t\t\t\t\tclass="avito-chat-input" \n\t\t\t\t\ttype="text"\n\t                :placeholder="localize.PLACEHOLDER"\n\t\t\t\t\trows="1"\n\t                maxlength="1000"\n\t\t\t\t\t:disabled="!store.chatId || store.isMessagesLoading"\n\t\t\t\t\tv-model="message" \n\t\t\t\t\t@keydown.enter="pressNewLine"\n\t\t\t\t\t@keyup.enter="sendMessage"\n\t\t\t\t\t@input="inputText"\n\t\t\t\t>\n\t\t\t\t</textarea>\n              \t<button v-html="buttonIcon" class="avito-chat-submit-button" :disabled="!store.chatId || store.isMessagesLoading" @click="sendMessage"></button>\n\t        </div>\n\t\t</div>\n    '},ChatHeader:{methods:{toggle:function(){const t=document.querySelector(".avito-chat-list"),s=document.querySelector(".avito-chat-area");t.classList.replace("hide","show"),s.classList.replace("show","hide"),e.scrollButton=!1}},setup:()=>({store:e}),template:'\n      <div class="avito-chat-header">\n\t\t<div class="avito-chat-header-wrap">\n\t\t\t<div class="avito-chat-header-button" @click="toggle">\n\t\t\t\t<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="avito-chat-header-button-icon"\n\t\t\t\tstyle="width: 24px; height: 24px;"><path\n\t\t\t\td="m7.414 13 5.293 5.293a1 1 0 0 1-1.414 1.414l-7-7a1 1 0 0 1 0-1.414l7-7a1 1 0 1 1 1.414 1.414L7.414 11H19a1 1 0 1 1 0 2H7.414Z"\n\t\t\t\tfill="currentColor"></path></svg>\n\t\t\t</div>\n\t\t\t<a :href="store.chat.url" target="_blank">\n\t\t\t\t<div class="avito-chat-header-preview">\n\t\t\t\t\t<div :style="{ backgroundImage: \'url(\' + store.chat.img + \')\' }"></div>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t\t<div class="avito-chat-header-info">\n\t\t\t\t<a :href="store.otherUserUrl" class="avito-chat-header-link" target="_blank">\n\t\t\t\t\t<div class="avito-chat-header-info-name">{{ store.chat.name }}</div>\n\t\t\t\t</a>\n\t\t\t\t<a :href="store.chat.url" class="avito-chat-header-link" target="_blank">\n\t\t\t\t\t<div class="avito-chat-header-info-title">{{ store.chat.title }}</div>\n                </a>\n\t\t\t</div>\n\t\t</div>\n      </div>\n\t'}},setup:()=>({store:e}),template:'\n\t\t<div class="avito-chat-area show">\n\t\t\t<ChatHeader v-if="store.chat"/>\n\t\t\t<Messages />\n\t\t\t<Input />\n\t\t</div>\n    '},Error:{setup:()=>({store:e}),template:'\n\t\t<div class="avito-chat-error-container pop" v-if="store.error">\n          <div class="avito-chat-error-text">{{ store.error }}</div>\n          <div class="avito-chat-error-close-button" @click="store.deleteError()">&#x2715;</div>\n\t\t</div>\n    '}},beforeMount(){e.component=this.component,e.setupId=this.setupId,e.userId=this.userId,e.chatId=this.chatId,e.checkTimestamp=this.checkTimestamp},setup:()=>({store:e}),template:"\n\t\t<ChatList />\n\t\t<ChatArea />\n        <Error />\n    "};t.App=l}(this.BX.AvitoExport.Chat=this.BX.AvitoExport.Chat||{});
//# sourceMappingURL=script.js.map
