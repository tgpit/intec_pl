{"version":3,"file":"script.js","sources":["../../../../js/plugin/skeleton.js","../../../../js/plugin/utils.js","src/addbutton.js","src/templateeditor.js","src/visualeditor/injection.js","src/row.js","src/index.js"],"sourcesContent":["import {compileTemplate} from \"./utils\";\r\n\r\n// noinspection JSUnresolvedVariable\r\nconst $ = window.AvitoJQuery ?? window.$;\r\n\r\nexport class Skeleton {\r\n\r\n\tstatic defaults = {\r\n\t\tlang: {},\r\n\t\tlangPrefix: null\r\n\t};\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tthis.$el = $(element);\r\n\t\tthis.el = this.$el[0];\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, this.$el.data(), options);\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.el = null;\r\n\t}\r\n\t\r\n\tgetElement(key, context, method) : JQuery {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\t\r\n\t\treturn this.getNode(selector, context, method || 'find');\r\n\t}\r\n\t\r\n\tgetElementSelector(key: string) : string {\r\n\t\tconst optionKey = key + 'Element';\r\n\t\r\n\t\treturn this.options[optionKey];\r\n\t}\r\n\t\r\n\tgetTemplate(key: string) : string {\r\n\t\tconst optionKey = key + 'Template';\r\n\t\tconst option = this.options[optionKey];\r\n\t\tconst optionFirstSymbol = option.substring(0, 1);\r\n\t\tlet result;\r\n\t\r\n\t\tif (optionFirstSymbol === '.' || optionFirstSymbol === '#') {\r\n\t\t\tresult = this.getNode(option).html();\r\n\t\t} else {\r\n\t\t\tresult = option;\r\n\t\t}\r\n\t\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tgetNode(selector, context, method = 'find') : JQuery {\r\n\t\tif (selector.substring(0, 1) === '#') { // is id query\r\n\t\t\tcontext = $(document);\r\n\t\t} else if (!context) {\r\n\t\t\tcontext = this.$el;\r\n\t\t}\r\n\t\r\n\t\treturn context[method](selector);\r\n\t}\r\n\t\r\n\tgetLang(key, replaces) : string {\r\n\t\tlet langKey;\r\n\t\tlet result;\r\n\t\r\n\t\tif (this.options.lang != null && key in this.options.lang) {\r\n\t\t\tresult = this.options.lang[key];\r\n\t\t} else {\r\n\t\t\tlangKey = this.options.langPrefix + key;\r\n\t\t\tresult = BX.message(langKey) || '';\r\n\t\t}\r\n\t\r\n\t\tif (result && replaces) {\r\n\t\t\tresult = compileTemplate(result, replaces);\r\n\t\t}\r\n\t\r\n\t\treturn result;\r\n\t}\r\n}\r\n","// @flow\r\n\r\nexport function compileTemplate(template: string, replaces: Object) {\r\n\tlet result = template;\r\n\r\n\tfor (const key in replaces) {\r\n\t\tif (!replaces.hasOwnProperty(key)) { continue; }\r\n\r\n\t\tconst replaceKey = '#' + key + '#';\r\n\t\tconst replaceValue = replaces[key];\r\n\r\n\t\tdo {\r\n\t\t\tresult = result.replace(replaceKey, replaceValue);\r\n\t\t} while (result.indexOf(replaceKey) !== -1);\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function htmlToElement(html, tag = 'div') {\r\n\tconst renderer = document.createElement(tag);\r\n\r\n\trenderer.innerHTML = html;\r\n\r\n\treturn renderer.firstElementChild;\r\n}","// @flow\r\n\r\nimport {Skeleton} from \"../../../../../js/plugin/skeleton\";\r\n\r\nexport class AddButton extends Skeleton {\r\n\r\n\tstatic defaults = {\r\n\t\trows: () => [],\r\n\t\tonSelect: () => {},\r\n\t};\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tsuper(element, options);\r\n\t\tthis._menu = null;\r\n\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tdestroy() : void {\r\n\t\tthis.unbind();\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\tbind() : void {\r\n\t\tthis.handleClick(true);\r\n\t}\r\n\r\n\tunbind() : void {\r\n\t\tthis.handleClick(false);\r\n\t}\r\n\r\n\thandleClick(dir: boolean) : void {\r\n\t\tthis.$el[dir ? 'on' : 'off']('click', this.onClick);\r\n\t}\r\n\r\n\tonClick = () : void => {\r\n\t\tthis.open();\r\n\t}\r\n\r\n\topen() : void {\r\n\t\tconst menu = this.menu();\r\n\t\tconst items = this.items();\r\n\r\n\t\tmenu.setItems(items);\r\n\t\t!menu.visible() && menu.Show()\r\n\t}\r\n\r\n\tmenu() : BX.CMenu {\r\n\t\tif (this._menu == null) {\r\n\t\t\tthis._menu = new BX.CMenu({\r\n\t\t\t\tparent: this.el,\r\n\t\t\t\tATTACH_MODE: 'right',\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this._menu;\r\n\t}\r\n\r\n\titems() : Array {\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const row of this.options.rows()) {\r\n\t\t\tresult.push({\r\n\t\t\t\tTEXT: row.name(),\r\n\t\t\t\tONCLICK: () => this.options.onSelect(row),\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n}","// @flow\r\n\r\nimport {Skeleton} from \"./skeleton\";\r\nimport {makeInjection} from \"./visualeditor/injection\";\r\n\r\n// noinspection JSUnresolvedVariable\r\nconst $ = window.AvitoJQuery ?? window.$;\r\n\r\nexport class TemplateEditor extends Skeleton {\r\n\r\n\tstatic defaults = {\r\n\t\tvalue: '',\r\n\t\tsources: [],\r\n\r\n\t\tdialogWidth: 800,\r\n\t\tdialogHeight: 600,\r\n\t\tdialogTemplate: `<div data-entity=\"editor\"></div>`,\r\n\r\n\t\teditorElement: '[data-entity=\"editor\"]',\r\n\t\teditorTemplate: '#avito-editor-template',\r\n\t\tvisualEditorId: 'avitoeditor',\r\n\r\n\t\tlang: {},\r\n\r\n\t\tonSave: (value: String) => {},\r\n\t}\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tsuper(element, options);\r\n\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tdestroy() : void {\r\n\t\tthis.unbind();\r\n\t}\r\n\r\n\tbind() : void {\r\n\t\tthis.handleOpenClick(true);\r\n\t}\r\n\r\n\tunbind() : void {\r\n\t\tthis.handleOpenClick(false);\r\n\t\tthis.handleCloseClick(false);\r\n\t}\r\n\r\n\thandleOpenClick(dir: boolean) : void {\r\n\t\tthis.$el[dir ? 'on' : 'off']('click', this.onOpenClick);\r\n\t}\r\n\r\n\thandleCloseClick(dir: boolean) : void {\r\n\t\tif (!dir && !this.hasDialog()) { return; }\r\n\r\n\t\tBX[dir ? 'addCustomEvent' : 'removeCustomEvent'](this.dialog(), 'onWindowClose', this.onDialogClose);\r\n\t}\r\n\r\n\tonOpenClick = () : void => {\r\n\t\tthis.open();\r\n\t}\r\n\r\n\tonSaveClick = () : void => {\r\n\t\tthis.save();\r\n\t\tthis.dialog().Close();\r\n\t}\r\n\r\n\tonCloseClick = () : void => {\r\n\t\tthis.dialog().Close();\r\n\t}\r\n\r\n\tonDialogClose = () : void => {\r\n\t\tconst dialog = this.dialog();\r\n\r\n\t\tthis.destroyDialog();\r\n\t\tthis.handleCloseClick(dialog, false);\r\n\t}\r\n\r\n\topen() : void {\r\n\t\tthis.openDialog();\r\n\t\tthis.bootEditor();\r\n\t\tthis.bootTaskbar();\r\n\t\tthis.bootInjection();\r\n\t\tthis.hideTaskbarSwitcher();\r\n\t}\r\n\r\n\topenDialog() : void {\r\n\t\tconst dialog = this.dialog();\r\n\t\tconst content = this.getTemplate('dialog');\r\n\r\n\t\tdialog.SetContent(content);\r\n\t\tdialog.Show();\r\n\r\n\t\tthis.handleCloseClick(true);\r\n\t}\r\n\r\n\tdestroyDialog() : void {\r\n\t\tthis.dialogContent().html('');\r\n\t}\r\n\r\n\tbootEditor() : void {\r\n\t\tconst content = this.dialogContent();\r\n\t\tconst editor = this.getElement('editor', content);\r\n\t\tconst initialValue = this.initialValue();\r\n\t\tconst template = this.editorTemplateHtml();\r\n\r\n\t\teditor.attr('id', 'bx-html-editor-' + this.options.visualEditorId);\r\n\t\teditor.html(template);\r\n\r\n\t\tthis.editorInitialValue(initialValue);\r\n\t}\r\n\r\n\teditorTemplateHtml() : string {\r\n\t\treturn (\r\n\t\t\tthis.getTemplate('editor')\r\n\t\t\t\t.replace(/<\\\\\\/script>/g, '</script>')\r\n\t\t);\r\n\t}\r\n\r\n\teditorInitialValue(value: ?string) : void {\r\n\t\tconst visualEditor = this.visualEditor();\r\n\r\n\t\tif (visualEditor?.sandbox?.inited) {\r\n\t\t\tvisualEditor.SetContent(value, true);\r\n\t\t} else {\r\n\t\t\tconst callback = () => {\r\n\t\t\t\tvisualEditor.SetContent(value, true);\r\n\t\t\t\tBX.removeCustomEvent(visualEditor, 'OnCreateIframeAfter', callback);\r\n\t\t\t};\r\n\r\n\t\t\tBX.addCustomEvent(visualEditor, 'OnCreateIframeAfter', callback);\r\n\t\t}\r\n\t}\r\n\r\n\tbootTaskbar() : void {\r\n\t\tconst visualEditor = this.visualEditor();\r\n\r\n\t\tif (visualEditor.taskbarManager != null) { return; }\r\n\r\n\t\tvisualEditor.taskbarManager = new BXHtmlEditor.TaskbarManager(visualEditor, true);\r\n\t\tvisualEditor.dom.taskbarCont.style.display = '';\r\n\t\tvisualEditor.showTaskbars = true;\r\n\t}\r\n\r\n\tbootInjection() : void {\r\n\t\tconst sources = this.sources();\r\n\t\tconst visualEditor = this.visualEditor();\r\n\t\tconst injectionControl = makeInjection();\r\n\t\tconst componentsTaskbar = new injectionControl(visualEditor, sources, this.options.lang);\r\n\r\n\t\tvisualEditor.taskbarManager.AddTaskbar(componentsTaskbar);\r\n\t\tvisualEditor.taskbarManager.ShowTaskbar(componentsTaskbar.GetId());\r\n\t\tvisualEditor.taskbarManager.Show(false);\r\n\t}\r\n\r\n\tinitialValue() : string {\r\n\t\tconst option = this.options.value;\r\n\r\n\t\tif (typeof option === 'function') {\r\n\t\t\treturn option();\r\n\t\t}\r\n\r\n\t\treturn option;\r\n\t}\r\n\r\n\thideTaskbarSwitcher() : void {\r\n\t\tthis.visualEditor().taskbarManager.pTopCont.style.display = 'none';\r\n\t}\r\n\r\n\tsave() : void {\r\n\t\tconst value = this.visualEditor().GetContent();\r\n\t\tconst format = value.indexOf('{=') !== -1 ? 'TEMPLATE' : 'TEXT';\r\n\r\n\t\tthis.options.onSave(value, format);\r\n\t}\r\n\r\n\thasDialog() : boolean {\r\n\t\treturn this._dialog != null;\r\n\t}\r\n\r\n\tdialog() : BX.CAdminDialog {\r\n\t\tif (this._dialog == null) {\r\n\t\t\tthis._dialog = this.createDialog();\r\n\t\t}\r\n\r\n\t\treturn this._dialog;\r\n\t}\r\n\r\n\tdialogContent() : $ {\r\n\t\tconst dialog = this.dialog();\r\n\r\n\t\treturn $(dialog.PARTS.CONTENT_DATA);\r\n\t}\r\n\r\n\tcreateDialog() : BX.CAdminDialog {\r\n\t\treturn new BX.CAdminDialog({\r\n\t\t\ttitle: this.getLang('VISUAL_EDITOR_MODAL_TITLE', {\r\n\t\t\t\tTAG: this.options.tagName,\r\n\t\t\t}),\r\n\t\t\tdraggable: true,\r\n\t\t\tresizable: true,\r\n\t\t\twidth: this.options.width,\r\n\t\t\theight: this.options.height,\r\n\t\t\tbuttons: [\r\n\t\t\t\tObject.assign({}, BX.CAdminDialog.btnSave, {\r\n\t\t\t\t\taction: this.onSaveClick,\r\n\t\t\t\t}),\r\n\t\t\t\tObject.assign({}, BX.CAdminDialog.btnCancel, {\r\n\t\t\t\t\taction: this.onCloseClick,\r\n\t\t\t\t}),\r\n\t\t\t],\r\n\t\t});\r\n\t}\r\n\r\n\tsources() : Array {\r\n\t\tconst option = this.options.sources;\r\n\r\n\t\tif (typeof option === 'function') {\r\n\t\t\treturn option();\r\n\t\t}\r\n\r\n\t\treturn option;\r\n\t}\r\n\r\n\tvisualEditor() : BXEditor {\r\n\t\treturn BXHtmlEditor.Get(this.options.visualEditorId);\r\n\t}\r\n}\r\n\r\n","export function makeInjection() {\r\n\treturn class Injection extends BXHtmlEditor.Taskbar {\r\n\r\n\t\tconstructor(editor, sources: Array, lang: Object) {\r\n\t\t\tsuper(editor);\r\n\r\n\t\t\tthis.id = 'avito_injection';\r\n\t\t\tthis.title = lang['VISUAL_EDITOR_INJECTION_TITLE'];\r\n\t\t\tthis.templateId = this.editor.templateId;\r\n\t\t\tthis.uniqueId = 'taskbar_' + this.editor.id + '_' + this.id;\r\n\t\t\tthis.searchPlaceholder = lang['VISUAL_EDITOR_INJECTION_SEARCH'];\r\n\t\t\tthis.avitoSources = sources;\r\n\r\n\t\t\tthis.Init();\r\n\t\t}\r\n\r\n\t\tInit() : void {\r\n\t\t\tconst [groups, items] = this.treeParams();\r\n\r\n\t\t\tthis.BuildSceleton();\r\n\t\t\tthis.BuildTree(groups, items);\r\n\t\t}\r\n\r\n\t\tHandleElementEx(wrap, dd, params) : void {\r\n\t\t\tthis.editor.SetBxTag(dd, {\r\n\t\t\t\ttag: 'php_protected',\r\n\t\t\t\tparams: params,\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\ttreeParams() : Object {\r\n\t\t\tconst groups = [];\r\n\t\t\tconst items = [];\r\n\r\n\t\t\tfor (const group of this.avitoSources) {\r\n\t\t\t\tgroups.push({\r\n\t\t\t\t\tname: group['TITLE'],\r\n\t\t\t\t\tpath: '',\r\n\t\t\t\t\ttitle: group['TITLE'],\r\n\t\t\t\t});\r\n\r\n\t\t\t\tfor (const item of group['ITEMS']) {\r\n\t\t\t\t\titems.push({\r\n\t\t\t\t\t\tvalue: this.isSourceField(item['ID'])\r\n\t\t\t\t\t\t\t? '{=' +  item['ID'] + '}'\r\n\t\t\t\t\t\t\t: item['ID'],\r\n\t\t\t\t\t\tpath: group['TITLE'],\r\n\t\t\t\t\t\ttitle: item['VALUE'],\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn [groups, items];\r\n\t\t}\r\n\r\n\t\tisSourceField(id: string) : boolean {\r\n\t\t\treturn /^[A-Z0-9_]+\\.[A-Z0-9_]+/.test(id);\r\n\t\t}\r\n\t}\r\n}","// @flow\r\n\r\nimport {Skeleton} from \"../../../../../js/plugin/skeleton\";\r\nimport {TemplateEditor} from \"./templateeditor\";\r\n\r\n// noinspection JSUnresolvedVariable\r\nconst $ = window.AvitoJQuery ?? window.$;\r\n\r\nexport class Row extends Skeleton {\r\n\r\n\tstatic defaults = {\r\n\t\thintElement: '[data-entity=\"hint\"]',\r\n\t\tcodeElement: '[data-entity=\"code\"]',\r\n\t\tnameElement: '[data-entity=\"name\"]',\r\n\t\ttagElement: '[data-entity=\"tag\"]',\r\n\t\tvalueElement: '[data-entity=\"value\"]',\r\n\t\tformatElement: '[data-entity=\"format\"]',\r\n\t\ttemplateElement: '[data-entity=\"template\"]',\r\n\t\tdeleteElement: '[data-entity=\"delete\"]',\r\n\t\trequired: false,\r\n\t\tmultiple: false,\r\n\r\n\t\tonDelete: () => {},\r\n\r\n\t\tlang: {},\r\n\t}\r\n\r\n\tclone() : Row {\r\n\t\tconst element = this.$el.clone(false, false);\r\n\t\tconst result = new Row(element, this.options);\r\n\r\n\t\tresult.clearClone();\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tdestroy() : void {\r\n\t\tthis.unbind();\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\tbind() : void {\r\n\t\tthis.handleDeleteClick(true);\r\n\t\tthis.handleValueChange(true);\r\n\t}\r\n\r\n\tunbind() : void {\r\n\t\tthis.handleDeleteClick(false);\r\n\t\tthis.handleValueChange(false);\r\n\t}\r\n\r\n\thandleDeleteClick(dir: boolean) : void {\r\n\t\tconst element = this.getElement('delete');\r\n\r\n\t\telement[dir ? 'on' : 'off']('click', this.onDeleteClick);\r\n\t}\r\n\r\n\thandleValueChange(dir: boolean) : void {\r\n\t\tconst element = this.getElement('value');\r\n\r\n\t\telement[dir ? 'on' : 'off']('change', this.onValueChange);\r\n\t}\r\n\r\n\tonDeleteClick = () : void => {\r\n\t\tthis.options.onDelete(this);\r\n\t}\r\n\r\n\tonValueChange = () : void => {\r\n\t\tthis.resolveFormat();\r\n\t}\r\n\r\n\tisActive() : boolean {\r\n\t\treturn !this.$el.hasClass('avito--hidden');\r\n\t}\r\n\r\n\tisMultiple() : boolean {\r\n\t\treturn this.options.multiple !== false;\r\n\t}\r\n\r\n\tisRequired() : boolean {\r\n\t\treturn this.options.required !== false;\r\n\t}\r\n\r\n\tactivate(force: boolean = false) : void {\r\n\t\tif (!force && this.isActive()) { return; }\r\n\r\n\t\tthis.$el.removeClass('avito--hidden');\r\n\t\tthis.bind();\r\n\t\tthis.bootValue();\r\n\t\tthis.bootTemplate();\r\n\t\tthis.bootHint();\r\n\t\tthis.enableControls(true);\r\n\t}\r\n\r\n\tdeactivate(force: boolean = false) : void {\r\n\t\tif (!force && !this.isActive()) { return; }\r\n\r\n\t\tthis.destroyValue();\r\n\t\tthis.destroyTemplate();\r\n\t\tthis.unbind();\r\n\t\tthis.enableControls(false);\r\n\t\tthis.$el.addClass('avito--hidden');\r\n\t}\r\n\r\n\tname() : string {\r\n\t\tconst element = this.getElement('name');\r\n\r\n\t\treturn element.text();\r\n\t}\r\n\r\n\treset() : void {\r\n\t\tfor (const control of this.controls()) {\r\n\t\t\tif (!control.is('input, select')) { continue; }\r\n\t\t\tif (control.prop('type') === 'hidden') { continue; }\r\n\r\n\t\t\tif (control.is('select')) {\r\n\t\t\t\tcontrol.find('option').prop('selected', false);\r\n\t\t\t} else if (['radio', 'checkbox'].indexOf(control.prop('type')) !== -1) {\r\n\t\t\t\tcontrol.prop('checked', false);\r\n\t\t\t} else {\r\n\t\t\t\tcontrol.val('');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfocus() : void {\r\n\t\tfor (const control of this.controls()) {\r\n\t\t\tif (!control.is('input, select')) { continue; }\r\n\t\t\tif (control.prop('type') === 'hidden') { continue; }\r\n\r\n\t\t\tcontrol.focus(); // todo focus on select2\r\n\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tallowDelete(dir: boolean) : void {\r\n\t\tconst element = this.getElement('delete');\r\n\r\n\t\telement.prop('disabled', !dir);\r\n\t\telement.toggleClass('avito--hidden', !dir);\r\n\t}\r\n\r\n\tenableControls(dir: boolean) : void {\r\n\t\tfor (const control of this.controls()) {\r\n\t\t\tcontrol.prop('disabled', !dir);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateControlName(baseName: string) : void {\r\n\t\tfor (const contr of this.controls()) {\r\n\t\t\tconst currentName = contr.attr('name');\r\n\t\t\tconst nameLastMatches = currentName != null ? /\\[\\w+]$/.exec(currentName) : null;\r\n\r\n\t\t\tif (nameLastMatches == null) { continue; }\r\n\r\n\t\t\tconst newName = baseName + nameLastMatches[0];\r\n\r\n\t\t\tcontr.attr('name', newName);\r\n\t\t}\r\n\t}\r\n\r\n\tcontrols() : Array {\r\n\t\treturn [\r\n\t\t\tthis.getElement('code'),\r\n\t\t\tthis.getElement('tag'),\r\n\t\t\tthis.getElement('value'),\r\n\t\t\tthis.getElement('format'),\r\n\t\t];\r\n\t}\r\n\r\n\tbootHint() : void {\r\n\t\tthis.getElement('hint').each((index, element) => {\r\n\t\t\tBX.hint_replace(element, element.getAttribute('data-hint'));\r\n\t\t});\r\n\t}\r\n\r\n\tbootValue() : void {\r\n\t\tconst element = this.getElement('value');\r\n\r\n\t\tif (!element.is('select')) { return; }\r\n\r\n\t\telement.select2({\r\n\t\t\ttags: true,\r\n\t\t\tselectOnClose: true,\r\n\t\t\tplaceholder: this.getLang('VALUE_PLACEHOLDER'),\r\n\t\t\tinsertTag: (data: Array, tag: string) => {\r\n\t\t\t\tdata.push(tag); // Insert the tag at the end of the results\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\t// patch focus for jquery3.6\r\n\r\n\t\telement.on('select2:open', () => {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tconst search = $('.select2-container--open .select2-search__field').last().get(0);\r\n\t\t\t\tsearch?.focus();\r\n\t\t\t}, 100);\r\n\t\t});\r\n\t}\r\n\r\n\tdestroyValue() : void {\r\n\t\tconst element = this.getElement('value');\r\n\r\n\t\tif (!element.is('select')) { return; }\r\n\r\n\t\telement.select2('destroy');\r\n\t\telement.off('select2:open');\r\n\t}\r\n\r\n\tbootTemplate() : void {\r\n\t\tconst element = this.getElement('template');\r\n\r\n\t\tif (element.length === 0) { return; }\r\n\r\n\t\tthis._templateEditor = new TemplateEditor(element, {\r\n\t\t\tsources: () => this.templateSources(),\r\n\t\t\tvalue: () => {\r\n\t\t\t\tconst option = this.getElement('value').find('option').filter(':selected').get(0);\r\n\r\n\t\t\t\tif (option == null) { return ''; }\r\n\r\n\t\t\t\tconst field = option?.getAttribute('value');\r\n\r\n\t\t\t\tif (field == null) { return option.textContent; }\r\n\r\n\t\t\t\treturn field.length > 0 ? '{=' + field + '}' : '';\r\n\t\t\t},\r\n\t\t\ttagName: this.getElement('name').text(),\r\n\t\t\tlang: this.options.lang,\r\n\t\t\tonSave: (value, format) => this.saveTemplate(value, format),\r\n\t\t});\r\n\t}\r\n\r\n\ttemplateSources() : Array {\r\n\t\tconst valueElement = this.getElement('value');\r\n\t\tconst groups = valueElement.find('optgroup');\r\n\t\tconst result = [];\r\n\r\n\t\tfor (let groupIndex = 0; groupIndex < groups.length; groupIndex++) {\r\n\t\t\tconst group = $(groups[groupIndex]);\r\n\t\t\tconst options = group.find('option');\r\n\t\t\tconst items = [];\r\n\r\n\t\t\tfor (let optionIndex = 0; optionIndex < options.length; optionIndex++) {\r\n\t\t\t\tconst option = $(options[optionIndex]);\r\n\r\n\t\t\t\titems.push({\r\n\t\t\t\t\tID: option.val(),\r\n\t\t\t\t\tVALUE: option.text(),\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tresult.push({\r\n\t\t\t\tTITLE: group.attr('label'),\r\n\t\t\t\tITEMS: items,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tsaveTemplate(text: string, format: string) : void {\r\n\t\tthis.saveTemplateValue(text, format);\r\n\t\tthis.setFormat(format);\r\n\t}\r\n\r\n\tsaveTemplateValue(text: string, format: string) : void {\r\n\t\tconst value = this.getElement('value');\r\n\t\tconst option = document.createElement('option');\r\n\r\n\t\toption.textContent = text;\r\n\t\toption.setAttribute('data-format', format);\r\n\t\tvalue.append(option);\r\n\r\n\t\toption.selected = true;\r\n\t}\r\n\r\n\tdestroyTemplate() : void {\r\n\t\tif (this._templateEditor == null) { return; }\r\n\r\n\t\tthis._templateEditor.destroy();\r\n\t\tthis._templateEditor = null;\r\n\t}\r\n\r\n\tresolveFormat() : void {\r\n\t\tconst option = this.getElement('value').find('option').filter(':selected');\r\n\t\tconst formatAttribute = option.data('format');\r\n\t\tlet format;\r\n\r\n\t\tif (formatAttribute != null) {\r\n\t\t\tformat = formatAttribute;\r\n\t\t} else if (option.attr('value') != null) {\r\n\t\t\tformat = 'FIELD';\r\n\t\t} else {\r\n\t\t\tformat = 'TEXT';\r\n\t\t}\r\n\r\n\t\tthis.setFormat(format);\r\n\t}\r\n\r\n\tsetFormat(value: ?string) : void {\r\n\t\tconst options = this.getElement('format');\r\n\r\n\t\toptions.each((index, option) => {\r\n\t\t\toption.checked = option.value === value;\r\n\t\t});\r\n\t}\r\n\r\n\tclearClone() : void {\r\n\t\tconst valueElement = this.getElement('value');\r\n\t\tconst valueNext = valueElement.next();\r\n\r\n\t\tif (valueElement.hasClass('select2-hidden-accessible')) {\r\n\t\t\tvalueElement\r\n\t\t\t\t.removeClass('select2-hidden-accessible')\r\n\t\t\t\t.removeAttr('data-select2-id')\r\n\t\t\t\t.removeAttr('aria-hidden')\r\n\t\t\t\t.removeAttr('tabindex');\r\n\r\n\t\t\tvalueElement.find('optgroup')\r\n\t\t\t\t.removeAttr('data-select2-id');\r\n\r\n\t\t\tvalueElement.find('option')\r\n\t\t\t\t.removeAttr('data-select2-id');\r\n\t\t}\r\n\r\n\t\tif (valueNext.hasClass('select2')) {\r\n\t\t\tvalueNext.remove();\r\n\t\t}\r\n\t}\r\n}","// @flow\r\n\r\nimport {Skeleton} from \"../../../../../js/plugin/skeleton\";\r\nimport {AddButton} from \"./addbutton\";\r\nimport {Row} from \"./row\";\r\n\r\n// noinspection JSUnusedGlobalSymbols\r\nexport class Tags extends Skeleton {\r\n\r\n\tstatic defaults = {\r\n\t\tbaseName: null,\r\n\t\tnextIndex: 0,\r\n\t\trowElement: '[data-entity=\"row\"]',\r\n\t\taddButtonElement: '[data-entity=\"addButton\"]',\r\n\t}\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tsuper(element, options);\r\n\t\tthis._nextIndex = this.options.nextIndex;\r\n\r\n\t\tthis.bootRows();\r\n\t\tthis.bootAddButton();\r\n\t}\r\n\r\n\tbootRows() {\r\n\t\tconst elements = this.getElement('row');\r\n\t\tconst rows = [];\r\n\r\n\t\telements.each((index, element) => {\r\n\t\t\tconst row = new Row(element, {\r\n\t\t\t\tonDelete: (row: Row) => this.delete(row),\r\n\t\t\t\tlang: this.options.lang,\r\n\t\t\t});\r\n\r\n\t\t\tif (row.isActive()) {\r\n\t\t\t\trow.activate(true);\r\n\t\t\t}\r\n\r\n\t\t\trows.push(row);\r\n\t\t});\r\n\r\n\t\tthis._rows = rows;\r\n\t}\r\n\r\n\tbootAddButton() {\r\n\t\tconst button = this.getElement('addButton');\r\n\r\n\t\tthis.addButton = new AddButton(button, {\r\n\t\t\trows: this.rowsForAdd,\r\n\t\t\tonSelect: (row: Row) => this.add(row),\r\n\t\t});\r\n\t}\r\n\r\n\trowsForAdd = () : Row[] => {\r\n\t\tconst result = [];\r\n\t\tconst found = [];\r\n\r\n\t\tfor (const row of this.rows()) {\r\n\t\t\tconst name = row.name();\r\n\r\n\t\t\tif (row.isActive() && !row.isMultiple()) { continue; }\r\n\t\t\tif (found.indexOf(name) !== -1) { continue; }\r\n\r\n\t\t\tresult.push(row);\r\n\t\t\tfound.push(name);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tadd(row: Row) : void {\r\n\t\tif (!row.isActive()) {\r\n\t\t\tthis.activateRow(row);\r\n\t\t} else if (!row.isMultiple()) {\r\n\t\t\tthrow new Error('cant add few rows for non-multiple row');\r\n\t\t} else {\r\n\t\t\tthis.insertRow(row);\r\n\t\t\tthis.reflowDelete(row.name());\r\n\t\t}\r\n\t}\r\n\r\n\tactivateRow(row: Row) : void {\r\n\t\tconst index = this._nextIndex++;\r\n\t\tconst newName = this.options.baseName + `[${index}]`;\r\n\r\n\t\trow.updateControlName(newName);\r\n\t\trow.reset();\r\n\t\trow.activate();\r\n\t\trow.focus()\r\n\t}\r\n\r\n\tinsertRow(row: Row) : void {\r\n\t\tconst typeRows = this.typeRows(row.name());\r\n\t\tconst sourceRow = typeRows.length > 0 ? typeRows[typeRows.length - 1] : row;\r\n\t\tconst newRow = sourceRow.clone();\r\n\t\tconst index = this._nextIndex++;\r\n\t\tconst newName = this.options.baseName + `[${index}]`;\r\n\r\n\t\tnewRow.updateControlName(newName);\r\n\t\tnewRow.$el.insertAfter(sourceRow.$el);\r\n\t\tnewRow.reset();\r\n\t\tnewRow.activate(true);\r\n\t\tnewRow.focus();\r\n\r\n\t\tthis._rows.push(newRow);\r\n\t}\r\n\r\n\tdelete(row: Row) : void {\r\n\t\tconst name = row.name();\r\n\t\tconst typeRows = this.typeRows(name, true);\r\n\r\n\t\tif (typeRows.length > 1) {\r\n\t\t\tthis.removeRow(row);\r\n\t\t\tthis.reflowDelete(name);\r\n\t\t} else if (row.isRequired()) {\r\n\t\t\tthrow new Error('cant remove last required row');\r\n\t\t} else {\r\n\t\t\trow.deactivate();\r\n\t\t}\r\n\t}\r\n\r\n\tremoveRow(row: Row) : void {\r\n\t\tconst rowElement = row.$el;\r\n\t\tconst rowIndex = this._rows.indexOf(row);\r\n\r\n\t\tif (rowIndex === -1) { throw new Error('cant delete unknown row'); }\r\n\r\n\t\trow.destroy();\r\n\t\trowElement.remove();\r\n\r\n\t\tthis._rows.splice(rowIndex, 1);\r\n\t}\r\n\r\n\treflowDelete(name: string) : void {\r\n\t\tconst rows = this.typeRows(name, true);\r\n\t\tconst hasFew = rows.length > 1;\r\n\r\n\t\tfor (const row of rows) {\r\n\t\t\trow.allowDelete(hasFew || !row.isRequired());\r\n\t\t}\r\n\t}\r\n\r\n\trows(onlyActive: boolean = false) : Row[] {\r\n\t\tif (!onlyActive) { return this._rows; }\r\n\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const row of this._rows) {\r\n\t\t\tif (!row.isActive()) { continue; }\r\n\r\n\t\t\tresult.push(row);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\ttypeRows(name: string, onlyActive: boolean = false) : Row[] {\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const row of this._rows) {\r\n\t\t\tif (onlyActive && !row.isActive()) { continue; }\r\n\r\n\t\t\tif (row.name() === name) {\r\n\t\t\t\tresult.push(row);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n}"],"names":["$","window","AvitoJQuery","Skeleton","constructor","element","options","$el","el","this","Object","assign","defaults","data","destroy","getElement","key","context","method","selector","getElementSelector","getNode","optionKey","getTemplate","option","optionFirstSymbol","substring","result","html","document","getLang","replaces","langKey","lang","langPrefix","BX","message","template","hasOwnProperty","replaceKey","replaceValue","replace","indexOf","compileTemplate","AddButton","onClick","open","_menu","bind","unbind","handleClick","dir","menu","items","setItems","visible","Show","CMenu","parent","ATTACH_MODE","row","rows","push","TEXT","name","ONCLICK","onSelect","TemplateEditor","onOpenClick","onSaveClick","save","dialog","Close","onCloseClick","onDialogClose","destroyDialog","handleCloseClick","handleOpenClick","hasDialog","openDialog","bootEditor","bootTaskbar","bootInjection","hideTaskbarSwitcher","content","SetContent","dialogContent","editor","initialValue","editorTemplateHtml","attr","visualEditorId","editorInitialValue","value","visualEditor","sandbox","_visualEditor$sandbox","inited","callback","removeCustomEvent","addCustomEvent","taskbarManager","BXHtmlEditor","TaskbarManager","dom","taskbarCont","style","display","showTaskbars","sources","injectionControl","Taskbar","id","title","templateId","uniqueId","searchPlaceholder","avitoSources","Init","groups","treeParams","BuildSceleton","BuildTree","HandleElementEx","wrap","dd","params","SetBxTag","tag","group","path","item","isSourceField","test","componentsTaskbar","AddTaskbar","ShowTaskbar","GetId","pTopCont","GetContent","format","onSave","_dialog","createDialog","PARTS","CONTENT_DATA","CAdminDialog","TAG","tagName","draggable","resizable","width","height","buttons","btnSave","action","btnCancel","Get","dialogWidth","dialogHeight","dialogTemplate","editorElement","editorTemplate","Row","onDeleteClick","onDelete","onValueChange","resolveFormat","clone","clearClone","handleDeleteClick","handleValueChange","isActive","hasClass","isMultiple","multiple","isRequired","required","activate","force","removeClass","bootValue","bootTemplate","bootHint","enableControls","deactivate","destroyValue","destroyTemplate","addClass","text","reset","control","controls","is","prop","find","val","focus","allowDelete","toggleClass","updateControlName","baseName","contr","currentName","nameLastMatches","exec","newName","each","index","hint_replace","getAttribute","select2","tags","selectOnClose","placeholder","insertTag","on","setTimeout","search","last","get","off","length","_templateEditor","templateSources","filter","field","textContent","saveTemplate","groupIndex","optionIndex","ID","VALUE","TITLE","ITEMS","saveTemplateValue","setFormat","createElement","setAttribute","append","selected","formatAttribute","checked","valueElement","valueNext","next","removeAttr","remove","hintElement","codeElement","nameElement","tagElement","formatElement","templateElement","deleteElement","Tags","rowsForAdd","found","_nextIndex","nextIndex","bootRows","bootAddButton","elements","delete","_rows","button","addButton","add","Error","insertRow","reflowDelete","activateRow","typeRows","sourceRow","newRow","insertAfter","removeRow","rowElement","rowIndex","splice","hasFew","onlyActive","addButtonElement"],"mappings":"+FAGA,MAAMA,WAAIC,OAAOC,eAAeD,OAAOD,EAEhC,MAAMG,EAOZC,YAAYC,EAAsBC,EAAkB,SAC9CC,IAAMP,EAAEK,QACRG,GAAKC,KAAKF,IAAI,QACdD,QAAUI,OAAOC,OAAO,GAAIF,KAAKL,YAAYQ,SAAUH,KAAKF,IAAIM,OAAQP,GAG9EQ,eACMN,GAAK,KAGXO,WAAWC,EAAKC,EAASC,SAClBC,EAAWV,KAAKW,mBAAmBJ,UAElCP,KAAKY,QAAQF,EAAUF,EAASC,GAAU,QAGlDE,mBAAmBJ,SACZM,EAAYN,EAAM,iBAEjBP,KAAKH,QAAQgB,GAGrBC,YAAYP,SACLM,EAAYN,EAAM,WAClBQ,EAASf,KAAKH,QAAQgB,GACtBG,EAAoBD,EAAOE,UAAU,EAAG,OAC1CC,SAGHA,EADyB,MAAtBF,GAAmD,MAAtBA,EACvBhB,KAAKY,QAAQG,GAAQI,OAErBJ,EAGHG,EAGRN,QAAQF,EAAUF,EAASC,EAAS,cACF,MAA7BC,EAASO,UAAU,EAAG,GACzBT,EAAUjB,EAAE6B,UACDZ,IACXA,EAAUR,KAAKF,KAGTU,EAAQC,GAAQC,GAGxBW,QAAQd,EAAKe,OACRC,EACAL,SAEqB,MAArBlB,KAAKH,QAAQ2B,MAAgBjB,KAAOP,KAAKH,QAAQ2B,KACpDN,EAASlB,KAAKH,QAAQ2B,KAAKjB,IAE3BgB,EAAUvB,KAAKH,QAAQ4B,WAAalB,EACpCW,EAASQ,GAAGC,QAAQJ,IAAY,IAG7BL,GAAUI,IACbJ,ECrEI,SAAyBU,EAAkBN,OAC7CJ,EAASU,MAER,MAAMrB,KAAOe,EAAU,KACtBA,EAASO,eAAetB,kBAEvBuB,EAAa,IAAMvB,EAAM,IACzBwB,EAAeT,EAASf,MAG7BW,EAASA,EAAOc,QAAQF,EAAYC,UACI,IAAhCb,EAAOe,QAAQH,WAGlBZ,EDuDIgB,CAAgBhB,EAAQI,IAG3BJ,GArEIxB,EAELS,SAAW,CACjBqB,KAAM,GACNC,WAAY,MELP,MAAMU,UAAkBzC,EAO9BC,YAAYC,EAAsBC,EAAkB,UAC7CD,EAASC,QAuBhBuC,QAAU,UACJC,aAvBAC,MAAQ,UAERC,OAGNlC,eACMmC,eACCnC,UAGPkC,YACME,aAAY,GAGlBD,cACMC,aAAY,GAGlBA,YAAYC,QACN5C,IAAI4C,EAAM,KAAO,OAAO,QAAS1C,KAAKoC,SAO5CC,aACOM,EAAO3C,KAAK2C,OACZC,EAAQ5C,KAAK4C,QAEnBD,EAAKE,SAASD,IACbD,EAAKG,WAAaH,EAAKI,OAGzBJ,cACmB,MAAd3C,KAAKsC,aACHA,MAAQ,IAAIZ,GAAGsB,MAAM,CACzBC,OAAQjD,KAAKD,GACbmD,YAAa,WAIRlD,KAAKsC,MAGbM,cACO1B,EAAS,OAEV,MAAMiC,KAAOnD,KAAKH,QAAQuD,OAC9BlC,EAAOmC,KAAK,CACXC,KAAMH,EAAII,OACVC,QAAS,IAAMxD,KAAKH,QAAQ4D,SAASN,YAIhCjC,SAhEIiB,EAELhC,SAAW,CACjBiD,KAAM,IAAM,GACZK,SAAU,QCFZ,MAAMlE,WAAIC,OAAOC,eAAeD,OAAOD,EAEhC,MAAMmE,UAAuBhE,EAmBnCC,YAAYC,EAAsBC,EAAkB,UAC7CD,EAASC,QA4BhB8D,YAAc,UACRtB,aAGNuB,YAAc,UACRC,YACAC,SAASC,cAGfC,aAAe,UACTF,SAASC,cAGfE,cAAgB,WACTH,EAAS9D,KAAK8D,cAEfI,qBACAC,iBAAiBL,GAAQ,SA3CzBvB,OAGNlC,eACMmC,SAGND,YACM6B,iBAAgB,GAGtB5B,cACM4B,iBAAgB,QAChBD,kBAAiB,GAGvBC,gBAAgB1B,QACV5C,IAAI4C,EAAM,KAAO,OAAO,QAAS1C,KAAK2D,aAG5CQ,iBAAiBzB,IACXA,GAAQ1C,KAAKqE,cAElB3C,GAAGgB,EAAM,iBAAmB,qBAAqB1C,KAAK8D,SAAU,gBAAiB9D,KAAKiE,eAuBvF5B,YACMiC,kBACAC,kBACAC,mBACAC,qBACAC,sBAGNJ,mBACOR,EAAS9D,KAAK8D,SACda,EAAU3E,KAAKc,YAAY,UAEjCgD,EAAOc,WAAWD,GAClBb,EAAOf,YAEFoB,kBAAiB,GAGvBD,qBACMW,gBAAgB1D,KAAK,IAG3BoD,mBACOI,EAAU3E,KAAK6E,gBACfC,EAAS9E,KAAKM,WAAW,SAAUqE,GACnCI,EAAe/E,KAAK+E,eACpBnD,EAAW5B,KAAKgF,qBAEtBF,EAAOG,KAAK,KAAM,kBAAoBjF,KAAKH,QAAQqF,gBACnDJ,EAAO3D,KAAKS,QAEPuD,mBAAmBJ,GAGzBC,4BAEEhF,KAAKc,YAAY,UACfkB,QAAQ,gBAAiB,cAI7BmD,mBAAmBC,eACZC,EAAerF,KAAKqF,wBAEtBA,YAAAA,EAAcC,UAAdC,EAAuBC,OAC1BH,EAAaT,WAAWQ,GAAO,OACzB,OACAK,EAAW,KAChBJ,EAAaT,WAAWQ,GAAO,GAC/B1D,GAAGgE,kBAAkBL,EAAc,sBAAuBI,IAG3D/D,GAAGiE,eAAeN,EAAc,sBAAuBI,IAIzDjB,oBACOa,EAAerF,KAAKqF,eAES,MAA/BA,EAAaO,iBAEjBP,EAAaO,eAAiB,IAAIC,aAAaC,eAAeT,GAAc,GAC5EA,EAAaU,IAAIC,YAAYC,MAAMC,QAAU,GAC7Cb,EAAac,cAAe,GAG7B1B,sBACO2B,EAAUpG,KAAKoG,UACff,EAAerF,KAAKqF,eACpBgB,EChJA,cAAwBR,aAAaS,QAE3C3G,YAAYmF,EAAQsB,EAAgB5E,SAC7BsD,QAEDyB,GAAK,uBACLC,MAAQhF,EAAI,mCACZiF,WAAazG,KAAK8E,OAAO2B,gBACzBC,SAAW,WAAa1G,KAAK8E,OAAOyB,GAAK,IAAMvG,KAAKuG,QACpDI,kBAAoBnF,EAAI,oCACxBoF,aAAeR,OAEfS,OAGNA,aACQC,EAAQlE,GAAS5C,KAAK+G,kBAExBC,qBACAC,UAAUH,EAAQlE,GAGxBsE,gBAAgBC,EAAMC,EAAIC,QACpBvC,OAAOwC,SAASF,EAAI,CACxBG,IAAK,gBACLF,OAAQA,IAIVN,mBACOD,EAAS,GACTlE,EAAQ,OAET,MAAM4E,KAASxH,KAAK4G,aAAc,CACtCE,EAAOzD,KAAK,CACXE,KAAMiE,EAAK,MACXC,KAAM,GACNjB,MAAOgB,EAAK,YAGR,MAAME,KAAQF,EAAK,MACvB5E,EAAMS,KAAK,CACV+B,MAAOpF,KAAK2H,cAAcD,EAAI,IAC3B,KAAQA,EAAI,GAAS,IACrBA,EAAI,GACPD,KAAMD,EAAK,MACXhB,MAAOkB,EAAI,cAKP,CAACZ,EAAQlE,GAGjB+E,cAAcpB,SACN,0BAA0BqB,KAAKrB,KD0FjCsB,EAAoB,IAAIxB,EAAiBhB,EAAce,EAASpG,KAAKH,QAAQ2B,MAEnF6D,EAAaO,eAAekC,WAAWD,GACvCxC,EAAaO,eAAemC,YAAYF,EAAkBG,SAC1D3C,EAAaO,eAAe7C,MAAK,GAGlCgC,qBACOhE,EAASf,KAAKH,QAAQuF,YAEN,mBAAXrE,EACHA,IAGDA,EAGR2D,2BACMW,eAAeO,eAAeqC,SAAShC,MAAMC,QAAU,OAG7DrC,aACOuB,EAAQpF,KAAKqF,eAAe6C,aAC5BC,GAAkC,IAAzB/C,EAAMnD,QAAQ,MAAe,WAAa,YAEpDpC,QAAQuI,OAAOhD,EAAO+C,GAG5B9D,mBACwB,MAAhBrE,KAAKqI,QAGbvE,gBACqB,MAAhB9D,KAAKqI,eACHA,QAAUrI,KAAKsI,gBAGdtI,KAAKqI,QAGbxD,sBACOf,EAAS9D,KAAK8D,gBAEbvE,EAAEuE,EAAOyE,MAAMC,cAGvBF,sBACQ,IAAI5G,GAAG+G,aAAa,CAC1BjC,MAAOxG,KAAKqB,QAAQ,4BAA6B,CAChDqH,IAAK1I,KAAKH,QAAQ8I,UAEnBC,WAAW,EACXC,WAAW,EACXC,MAAO9I,KAAKH,QAAQiJ,MACpBC,OAAQ/I,KAAKH,QAAQkJ,OACrBC,QAAS,CACR/I,OAAOC,OAAO,GAAIwB,GAAG+G,aAAaQ,QAAS,CAC1CC,OAAQlJ,KAAK4D,cAEd3D,OAAOC,OAAO,GAAIwB,GAAG+G,aAAaU,UAAW,CAC5CD,OAAQlJ,KAAKgE,kBAMjBoC,gBACOrF,EAASf,KAAKH,QAAQuG,cAEN,mBAAXrF,EACHA,IAGDA,EAGRsE,sBACQQ,aAAauD,IAAIpJ,KAAKH,QAAQqF,uBAvN1BxB,EAELvD,SAAW,CACjBiF,MAAO,GACPgB,QAAS,GAETiD,YAAa,IACbC,aAAc,IACdC,eAAiB,mCAEjBC,cAAe,yBACfC,eAAgB,yBAChBvE,eAAgB,cAEhB1D,KAAM,GAEN4G,OAAShD,OElBX,MAAM7F,WAAIC,OAAOC,eAAeD,OAAOD,EAEhC,MAAMmK,UAAYhK,qCAuDxBiK,cAAgB,UACV9J,QAAQ+J,SAAS5J,YAGvB6J,cAAgB,UACVC,iBAzCNC,cACOnK,EAAUI,KAAKF,IAAIiK,OAAM,GAAO,GAChC7I,EAAS,IAAIwI,EAAI9J,EAASI,KAAKH,gBAErCqB,EAAO8I,aAEA9I,EAGRb,eACMmC,eACCnC,UAGPkC,YACM0H,mBAAkB,QAClBC,mBAAkB,GAGxB1H,cACMyH,mBAAkB,QAClBC,mBAAkB,GAGxBD,kBAAkBvH,GACD1C,KAAKM,WAAW,UAExBoC,EAAM,KAAO,OAAO,QAAS1C,KAAK2J,eAG3CO,kBAAkBxH,GACD1C,KAAKM,WAAW,SAExBoC,EAAM,KAAO,OAAO,SAAU1C,KAAK6J,eAW5CM,kBACSnK,KAAKF,IAAIsK,SAAS,iBAG3BC,oBACkC,IAA1BrK,KAAKH,QAAQyK,SAGrBC,oBACkC,IAA1BvK,KAAKH,QAAQ2K,SAGrBC,SAASC,GAAiB,IACpBA,GAAS1K,KAAKmK,kBAEdrK,IAAI6K,YAAY,sBAChBpI,YACAqI,iBACAC,oBACAC,gBACAC,gBAAe,IAGrBC,WAAWN,GAAiB,IACtBA,GAAU1K,KAAKmK,mBAEfc,oBACAC,uBACA1I,cACAuI,gBAAe,QACfjL,IAAIqL,SAAS,kBAGnB5H,cACiBvD,KAAKM,WAAW,QAEjB8K,OAGhBC,YACM,MAAMC,KAAWtL,KAAKuL,WACrBD,EAAQE,GAAG,kBACa,WAAzBF,EAAQG,KAAK,UAEbH,EAAQE,GAAG,UACdF,EAAQI,KAAK,UAAUD,KAAK,YAAY,IAC2B,IAAzD,CAAC,QAAS,YAAYxJ,QAAQqJ,EAAQG,KAAK,SACrDH,EAAQG,KAAK,WAAW,GAExBH,EAAQK,IAAI,KAKfC,YACM,MAAMN,KAAWtL,KAAKuL,cACrBD,EAAQE,GAAG,kBACa,WAAzBF,EAAQG,KAAK,SAEjBH,EAAQM,eAMVC,YAAYnJ,SACL9C,EAAUI,KAAKM,WAAW,UAEhCV,EAAQ6L,KAAK,YAAa/I,GAC1B9C,EAAQkM,YAAY,iBAAkBpJ,GAGvCqI,eAAerI,OACT,MAAM4I,KAAWtL,KAAKuL,WAC1BD,EAAQG,KAAK,YAAa/I,GAI5BqJ,kBAAkBC,OACZ,MAAMC,KAASjM,KAAKuL,WAAY,OAC9BW,EAAcD,EAAMhH,KAAK,QACzBkH,EAAiC,MAAfD,EAAsB,UAAUE,KAAKF,GAAe,QAErD,MAAnBC,iBAEEE,EAAUL,EAAWG,EAAgB,GAE3CF,EAAMhH,KAAK,OAAQoH,IAIrBd,iBACQ,CACNvL,KAAKM,WAAW,QAChBN,KAAKM,WAAW,OAChBN,KAAKM,WAAW,SAChBN,KAAKM,WAAW,WAIlBwK,gBACMxK,WAAW,QAAQgM,MAAK,CAACC,EAAO3M,KACpC8B,GAAG8K,aAAa5M,EAASA,EAAQ6M,aAAa,iBAIhD7B,kBACOhL,EAAUI,KAAKM,WAAW,SAE3BV,EAAQ4L,GAAG,YAEhB5L,EAAQ8M,QAAQ,CACfC,MAAM,EACNC,eAAe,EACfC,YAAa7M,KAAKqB,QAAQ,qBAC1ByL,UAAW,CAAC1M,EAAamH,KACxBnH,EAAKiD,KAAKkE,MAMZ3H,EAAQmN,GAAG,gBAAgB,KAC1BC,YAAW,WACJC,EAAS1N,EAAE,mDAAmD2N,OAAOC,IAAI,SAC/EF,GAAAA,EAAQrB,UACN,SAILX,qBACOrL,EAAUI,KAAKM,WAAW,SAE3BV,EAAQ4L,GAAG,YAEhB5L,EAAQ8M,QAAQ,WAChB9M,EAAQwN,IAAI,iBAGbvC,qBACOjL,EAAUI,KAAKM,WAAW,YAET,IAAnBV,EAAQyN,cAEPC,gBAAkB,IAAI5J,EAAe9D,EAAS,CAClDwG,QAAS,IAAMpG,KAAKuN,kBACpBnI,MAAO,WACArE,EAASf,KAAKM,WAAW,SAASoL,KAAK,UAAU8B,OAAO,aAAaL,IAAI,MAEjE,MAAVpM,QAAyB,SAEvB0M,QAAQ1M,SAAAA,EAAQ0L,aAAa,gBAEtB,MAATgB,EAAwB1M,EAAO2M,YAE5BD,EAAMJ,OAAS,EAAI,KAAOI,EAAQ,IAAM,IAEhD9E,QAAS3I,KAAKM,WAAW,QAAQ8K,OACjC5J,KAAMxB,KAAKH,QAAQ2B,KACnB4G,OAAQ,CAAChD,EAAO+C,IAAWnI,KAAK2N,aAAavI,EAAO+C,MAItDoF,wBAEOzG,EADe9G,KAAKM,WAAW,SACToL,KAAK,YAC3BxK,EAAS,OAEV,IAAI0M,EAAa,EAAGA,EAAa9G,EAAOuG,OAAQO,IAAc,OAC5DpG,EAAQjI,EAAEuH,EAAO8G,IACjB/N,EAAU2H,EAAMkE,KAAK,UACrB9I,EAAQ,OAET,IAAIiL,EAAc,EAAGA,EAAchO,EAAQwN,OAAQQ,IAAe,OAChE9M,EAASxB,EAAEM,EAAQgO,IAEzBjL,EAAMS,KAAK,CACVyK,GAAI/M,EAAO4K,MACXoC,MAAOhN,EAAOqK,SAIhBlK,EAAOmC,KAAK,CACX2K,MAAOxG,EAAMvC,KAAK,SAClBgJ,MAAOrL,WAIF1B,EAGRyM,aAAavC,EAAcjD,QACrB+F,kBAAkB9C,EAAMjD,QACxBgG,UAAUhG,GAGhB+F,kBAAkB9C,EAAcjD,SACzB/C,EAAQpF,KAAKM,WAAW,SACxBS,EAASK,SAASgN,cAAc,UAEtCrN,EAAO2M,YAActC,EACrBrK,EAAOsN,aAAa,cAAelG,GACnC/C,EAAMkJ,OAAOvN,GAEbA,EAAOwN,UAAW,EAGnBrD,kBAC6B,MAAxBlL,KAAKsN,uBAEJA,gBAAgBjN,eAChBiN,gBAAkB,MAGxBxD,sBACO/I,EAASf,KAAKM,WAAW,SAASoL,KAAK,UAAU8B,OAAO,aACxDgB,EAAkBzN,EAAOX,KAAK,cAChC+H,EAGHA,EADsB,MAAnBqG,EACMA,EACyB,MAAxBzN,EAAOkE,KAAK,SACb,QAEA,YAGLkJ,UAAUhG,GAGhBgG,UAAU/I,GACOpF,KAAKM,WAAW,UAExBgM,MAAK,CAACC,EAAOxL,KACpBA,EAAO0N,QAAU1N,EAAOqE,QAAUA,KAIpC4E,mBACO0E,EAAe1O,KAAKM,WAAW,SAC/BqO,EAAYD,EAAaE,OAE3BF,EAAatE,SAAS,+BACzBsE,EACE/D,YAAY,6BACZkE,WAAW,mBACXA,WAAW,eACXA,WAAW,YAEbH,EAAahD,KAAK,YAChBmD,WAAW,mBAEbH,EAAahD,KAAK,UAChBmD,WAAW,oBAGVF,EAAUvE,SAAS,YACtBuE,EAAUG,UAhUApF,EAELvJ,SAAW,CACjB4O,YAAa,uBACbC,YAAa,uBACbC,YAAa,uBACbC,WAAY,sBACZR,aAAc,wBACdS,cAAe,yBACfC,gBAAiB,2BACjBC,cAAe,yBACf7E,UAAU,EACVF,UAAU,EAEVV,SAAU,OAEVpI,KAAM,ICjBD,MAAM8N,UAAa5P,EASzBC,YAAYC,EAAsBC,EAAkB,UAC7CD,EAASC,QAoChB0P,WAAa,WACNrO,EAAS,GACTsO,EAAQ,OAET,MAAMrM,KAAOnD,KAAKoD,OAAQ,OACxBG,EAAOJ,EAAII,OAEbJ,EAAIgH,aAAehH,EAAIkH,eACE,IAAzBmF,EAAMvN,QAAQsB,KAElBrC,EAAOmC,KAAKF,GACZqM,EAAMnM,KAAKE,WAGLrC,QAjDFuO,WAAazP,KAAKH,QAAQ6P,eAE1BC,gBACAC,gBAGND,iBACOE,EAAW7P,KAAKM,WAAW,OAC3B8C,EAAO,GAEbyM,EAASvD,MAAK,CAACC,EAAO3M,WACfuD,EAAM,IAAIuG,EAAI9J,EAAS,CAC5BgK,SAAWzG,GAAanD,KAAK8P,OAAO3M,GACpC3B,KAAMxB,KAAKH,QAAQ2B,OAGhB2B,EAAIgH,YACPhH,EAAIsH,UAAS,GAGdrH,EAAKC,KAAKF,WAGN4M,MAAQ3M,EAGdwM,sBACOI,EAAShQ,KAAKM,WAAW,kBAE1B2P,UAAY,IAAI9N,EAAU6N,EAAQ,CACtC5M,KAAMpD,KAAKuP,WACX9L,SAAWN,GAAanD,KAAKkQ,IAAI/M,KAqBnC+M,IAAI/M,MACEA,EAAIgH,WAEF,CAAA,IAAKhH,EAAIkH,mBACT,IAAI8F,MAAM,+CAEXC,UAAUjN,QACVkN,aAAalN,EAAII,kBALjB+M,YAAYnN,GASnBmN,YAAYnN,SACLoJ,EAAQvM,KAAKyP,aACbpD,EAAUrM,KAAKH,QAAQmM,SAAY,IAAGO,KAE5CpJ,EAAI4I,kBAAkBM,GACtBlJ,EAAIkI,QACJlI,EAAIsH,WACJtH,EAAIyI,QAGLwE,UAAUjN,SACHoN,EAAWvQ,KAAKuQ,SAASpN,EAAII,QAC7BiN,EAAYD,EAASlD,OAAS,EAAIkD,EAASA,EAASlD,OAAS,GAAKlK,EAClEsN,EAASD,EAAUzG,QACnBwC,EAAQvM,KAAKyP,aACbpD,EAAUrM,KAAKH,QAAQmM,SAAY,IAAGO,KAE5CkE,EAAO1E,kBAAkBM,GACzBoE,EAAO3Q,IAAI4Q,YAAYF,EAAU1Q,KACjC2Q,EAAOpF,QACPoF,EAAOhG,UAAS,GAChBgG,EAAO7E,aAEFmE,MAAM1M,KAAKoN,GAGjBX,OAAO3M,SACAI,EAAOJ,EAAII,UACAvD,KAAKuQ,SAAShN,GAAM,GAExB8J,OAAS,OAChBsD,UAAUxN,QACVkN,aAAa9M,OACZ,CAAA,GAAIJ,EAAIoH,mBACR,IAAI4F,MAAM,iCAEhBhN,EAAI6H,cAIN2F,UAAUxN,SACHyN,EAAazN,EAAIrD,IACjB+Q,EAAW7Q,KAAK+P,MAAM9N,QAAQkB,OAElB,IAAd0N,QAAyB,IAAIV,MAAM,2BAEvChN,EAAI9C,UACJuQ,EAAW9B,cAENiB,MAAMe,OAAOD,EAAU,GAG7BR,aAAa9M,SACNH,EAAOpD,KAAKuQ,SAAShN,GAAM,GAC3BwN,EAAS3N,EAAKiK,OAAS,MAExB,MAAMlK,KAAOC,EACjBD,EAAI0I,YAAYkF,IAAW5N,EAAIoH,cAIjCnH,KAAK4N,GAAsB,OACrBA,SAAqBhR,KAAK+P,YAEzB7O,EAAS,OAEV,MAAMiC,KAAOnD,KAAK+P,MACjB5M,EAAIgH,YAETjJ,EAAOmC,KAAKF,UAGNjC,EAGRqP,SAAShN,EAAcyN,GAAsB,SACtC9P,EAAS,OAEV,MAAMiC,KAAOnD,KAAK+P,MAClBiB,IAAe7N,EAAIgH,YAEnBhH,EAAII,SAAWA,GAClBrC,EAAOmC,KAAKF,UAIPjC,GAhKIoO,EAELnP,SAAW,CACjB6L,SAAU,KACV0D,UAAW,EACXkB,WAAY,sBACZK,iBAAkB"}