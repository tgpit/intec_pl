!function(t){var a,s;t.JCCatalogProductSubscribeList||(a=function(t){a.superclass.constructor.apply(this,arguments),this.nameNode=BX.create("span",{props:{className:"bx_medium bx_bt_button",id:this.id},text:t.text}),this.buttonNode=BX.create("span",{attrs:{className:t.ownerClass},style:{marginBottom:"0",borderBottom:"0 none transparent"},children:[this.nameNode],events:this.contextEvents}),BX.browser.IsIE()&&this.buttonNode.setAttribute("hideFocus","hidefocus")},BX.extend(a,BX.PopupWindowButton),s=function(t){s.superclass.constructor.apply(this,arguments),this.nameNode=BX.create("span",{props:{id:this.id},style:"object"==typeof t.style?t.style:{},text:t.text}),this.buttonNode=BX.create("span",{attrs:{className:t.className},style:{marginBottom:"0",borderBottom:"0 none transparent"},children:[this.nameNode],events:this.contextEvents}),BX.browser.IsIE()&&this.buttonNode.setAttribute("hideFocus","hidefocus")},BX.extend(s,BX.PopupWindowButton),t.JCCatalogProductSubscribeList=function(t){if(this.productType=0,this.showQuantity=!0,this.showAbsent=!0,this.secondPict=!1,this.showOldPrice=!1,this.showPercent=!1,this.showSkuProps=!1,this.visual={ID:"",PICT_ID:"",SECOND_PICT_ID:"",QUANTITY_ID:"",QUANTITY_UP_ID:"",QUANTITY_DOWN_ID:"",PRICE_ID:"",DSC_PERC:"",SECOND_DSC_PERC:"",DISPLAY_PROP_DIV:"",BASKET_PROP_DIV:""},this.product={checkQuantity:!1,maxQuantity:0,stepQuantity:1,isDblQuantity:!1,canBuy:!0,canSubscription:!0,name:"",pict:{},id:0,addUrl:"",buyUrl:"",listSubscribeId:{}},this.basketData={useProps:!1,emptyProps:!1,quantity:"quantity",props:"prop",basketUrl:""},this.defaultPict={pict:null,secondPict:null},this.checkQuantity=!1,this.maxQuantity=0,this.stepQuantity=1,this.isDblQuantity=!1,this.canBuy=!0,this.canSubscription=!0,this.precision=6,this.precisionFactor=Math.pow(10,this.precision),this.offers=[],this.offerNum=0,this.treeProps=[],this.obTreeRows=[],this.showCount=[],this.showStart=[],this.selectedValues={},this.obProduct=null,this.obQuantity=null,this.obQuantityUp=null,this.obQuantityDown=null,this.obPict=null,this.obSecondPict=null,this.obPrice=null,this.obTree=null,this.obBuyBtn=null,this.deleteSubscribeBtn=null,this.obDscPerc=null,this.obSecondDscPerc=null,this.obSkuProps=null,this.obMeasure=null,this.obPopupWin=null,this.basketUrl="",this.basketParams={},this.treeRowShowSize=5,this.treeEnableArrow={display:"",cursor:"pointer",opacity:1},this.treeDisableArrow={display:"",cursor:"default",opacity:.2},this.lastElement=!1,this.containerHeight=0,this.errorCode=0,this.ajaxUrl="/bitrix/components/bitrix/catalog.product.subscribe.list/ajax.php","object"==typeof t){if(this.productType=parseInt(t.PRODUCT_TYPE,10),this.showQuantity=t.SHOW_QUANTITY,this.showAbsent=t.SHOW_ABSENT,this.secondPict=!!t.SECOND_PICT,this.showOldPrice=!!t.SHOW_OLD_PRICE,this.showPercent=!!t.SHOW_DISCOUNT_PERCENT,this.showSkuProps=!!t.SHOW_SKU_PROPS,this.notifyUser=Boolean(t.NOTIFY_USER),this.notifyPopupTitle=t.NOTIFY_POPUP_TITLE,this.notifySuccess=Boolean(t.NOTIFY_SUCCESS),this.notifyMessage=t.NOTIFY_MESSAGE,this.notifyUser)return void BX.ready(BX.delegate(this.showPopupNotifyingUser,this));switch(this.visual=t.VISUAL,this.visual.DELETE_SUBSCRIBE_ID&&(this.deleteSubscribeBtn=BX(this.visual.DELETE_SUBSCRIBE_ID),this.deleteSubscribeBtn&&BX.bind(this.deleteSubscribeBtn,"click",BX.delegate(this.deleteSubscribe,this)),this.product.listSubscribeId=t.PRODUCT.LIST_SUBSCRIBE_ID),this.productType){case 1:case 2:t.PRODUCT&&"object"==typeof t.PRODUCT?(this.showQuantity&&(this.product.checkQuantity=t.PRODUCT.CHECK_QUANTITY,this.product.isDblQuantity=t.PRODUCT.QUANTITY_FLOAT,this.product.checkQuantity&&(this.product.maxQuantity=this.product.isDblQuantity?parseFloat(t.PRODUCT.MAX_QUANTITY):parseInt(t.PRODUCT.MAX_QUANTITY,10)),this.product.stepQuantity=this.product.isDblQuantity?parseFloat(t.PRODUCT.STEP_QUANTITY):parseInt(t.PRODUCT.STEP_QUANTITY,10),this.checkQuantity=this.product.checkQuantity,this.isDblQuantity=this.product.isDblQuantity,this.maxQuantity=this.product.maxQuantity,this.stepQuantity=this.product.stepQuantity,this.isDblQuantity&&(this.stepQuantity=Math.round(this.stepQuantity*this.precisionFactor)/this.precisionFactor)),this.product.canBuy=t.PRODUCT.CAN_BUY,this.product.canSubscription=t.PRODUCT.SUBSCRIPTION,this.canBuy=this.product.canBuy,this.canSubscription=this.product.canSubscription,this.product.name=t.PRODUCT.NAME,this.product.pict=t.PRODUCT.PICT,this.product.id=t.PRODUCT.ID,t.PRODUCT.ADD_URL&&(this.product.addUrl=t.PRODUCT.ADD_URL),t.PRODUCT.BUY_URL&&(this.product.buyUrl=t.PRODUCT.BUY_URL),t.BASKET&&"object"==typeof t.BASKET&&(this.basketData.useProps=!!t.BASKET.ADD_PROPS,this.basketData.emptyProps=!!t.BASKET.EMPTY_PROPS)):this.errorCode=-1;break;case 3:t.PRODUCT&&"object"==typeof t.PRODUCT&&(this.product.name=t.PRODUCT.NAME,this.product.id=t.PRODUCT.ID),t.OFFERS&&BX.type.isArray(t.OFFERS)?(this.offers=t.OFFERS,this.offerNum=0,t.OFFER_SELECTED&&(this.offerNum=parseInt(t.OFFER_SELECTED,10)),isNaN(this.offerNum)&&(this.offerNum=0),t.TREE_PROPS&&(this.treeProps=t.TREE_PROPS),t.DEFAULT_PICTURE&&(this.defaultPict.pict=t.DEFAULT_PICTURE.PICTURE,this.defaultPict.secondPict=t.DEFAULT_PICTURE.PICTURE_SECOND)):this.errorCode=-1;break;default:this.errorCode=-1}t.BASKET&&"object"==typeof t.BASKET&&(t.BASKET.QUANTITY&&(this.basketData.quantity=t.BASKET.QUANTITY),t.BASKET.PROPS&&(this.basketData.props=t.BASKET.PROPS),t.BASKET.BASKET_URL&&(this.basketData.basketUrl=t.BASKET.BASKET_URL)),this.lastElement=!!t.LAST_ELEMENT&&"Y"===t.LAST_ELEMENT}0===this.errorCode&&BX.ready(BX.delegate(this.Init,this))},t.JCCatalogProductSubscribeList.prototype.Init=function(){var t,s,e=0;if(this.obProduct=BX(this.visual.ID),this.obProduct||(this.errorCode=-1),this.obPict=BX(this.visual.PICT_ID),this.obPict||(this.errorCode=-2),this.secondPict&&this.visual.SECOND_PICT_ID&&(this.obSecondPict=BX(this.visual.SECOND_PICT_ID)),this.showQuantity&&this.visual.QUANTITY_ID&&(this.obQuantity=BX(this.visual.QUANTITY_ID),this.visual.QUANTITY_UP_ID&&(this.obQuantityUp=BX(this.visual.QUANTITY_UP_ID)),this.visual.QUANTITY_DOWN_ID&&(this.obQuantityDown=BX(this.visual.QUANTITY_DOWN_ID))),3===this.productType){if(this.visual.TREE_ID)for(this.obTree=BX(this.visual.TREE_ID),this.obTree||(this.errorCode=-256),t=this.visual.TREE_ITEM_ID,e=0;e<this.treeProps.length;e++)if(this.obTreeRows[e]={LIST:BX(t+this.treeProps[e].ID+"_list"),CONT:BX(t+this.treeProps[e].ID+"_cont")},!this.obTreeRows[e].LIST||!this.obTreeRows[e].CONT){this.errorCode=-512;break}this.visual.QUANTITY_MEASURE&&(this.obMeasure=BX(this.visual.QUANTITY_MEASURE))}if(this.visual.BUY_ID&&(this.obBuyBtn=BX(this.visual.BUY_ID)),this.showPercent&&(this.visual.DSC_PERC&&(this.obDscPerc=BX(this.visual.DSC_PERC)),this.secondPict&&this.visual.SECOND_DSC_PERC&&(this.obSecondDscPerc=BX(this.visual.SECOND_DSC_PERC))),this.showSkuProps&&this.visual.DISPLAY_PROP_DIV&&(this.obSkuProps=BX(this.visual.DISPLAY_PROP_DIV)),0===this.errorCode){switch(this.showQuantity&&(this.obQuantityUp&&BX.bind(this.obQuantityUp,"click",BX.delegate(this.QuantityUp,this)),this.obQuantityDown&&BX.bind(this.obQuantityDown,"click",BX.delegate(this.QuantityDown,this)),this.obQuantity&&BX.bind(this.obQuantity,"change",BX.delegate(this.QuantityChange,this))),this.productType){case 1:break;case 3:if((s=BX.findChildren(this.obTree,{tagName:"div"},!0))&&0<s.length)for(e=0;e<s.length;e++)BX.bind(s[e],"click",BX.delegate(this.SelectOfferProp,this));this.SetCurrent()}this.obBuyBtn&&BX.bind(this.obBuyBtn,"click",BX.delegate(this.Basket,this))}},t.JCCatalogProductSubscribeList.prototype.showPopupNotifyingUser=function(){this.InitPopupWindow(),this.obPopupWin.setTitleBar(this.notifyPopupTitle),t=this.notifySuccess?"bx-cpsl-notify-content-success":"bx-cpsl-notify-content-error";var t=BX.create("div",{props:{className:"bx-cpsl-popup-content"},children:[BX.create("p",{props:{className:t},text:this.notifyMessage})]});this.obPopupWin.setContent(t),this.obPopupWin.setButtons([new s({text:BX.message("CPSL_BTN_MESSAGE_CLOSE"),className:"intec-ui intec-ui-control-button intec-ui-scheme-current",events:{click:BX.delegate(function(){this.obPopupWin.close()},this)}})]),this.obPopupWin.show()},t.JCCatalogProductSubscribeList.prototype.SelectOfferProp=function(){var t,s=0,e="",i=null,o=BX.proxy_context;if(o&&o.hasAttribute("data-treevalue")&&(e=o.getAttribute("data-treevalue"),t=e.split("_"),this.SearchOfferPropIndex(t[0],t[1])&&(i=BX.findChildren(o.parentNode,{tagName:"div"},!1))&&0<i.length))for(s=0;s<i.length;s++)i[s].getAttribute("data-onevalue")===t[1]?BX.addClass(i[s],"active"):BX.removeClass(i[s],"active")},t.JCCatalogProductSubscribeList.prototype.SearchOfferPropIndex=function(t,s){for(var e,i,o="",a=[],r=[],n=-1,h={},u=[],c=0;c<this.treeProps.length;c++)if(this.treeProps[c].ID===t){n=c;break}if(-1<n){for(c=0;c<n;c++)h[o="PROP_"+this.treeProps[c].ID]=this.selectedValues[o];if(o="PROP_"+this.treeProps[n].ID,!(e=this.GetRowValues(h,o)))return!1;if(!BX.util.in_array(s,e))return!1;for(h[o]=s,c=n+1;c<this.treeProps.length;c++){if(o="PROP_"+this.treeProps[c].ID,!(e=this.GetRowValues(h,o)))return!1;if(r=[],this.showAbsent)for(a=[],u=[],u=BX.clone(h,!0),i=0;i<e.length;i++)u[o]=e[i],r[r.length]=e[i],this.GetCanBuy(u)&&(a[a.length]=e[i]);else a=e;this.selectedValues[o]&&BX.util.in_array(this.selectedValues[o],a)?h[o]=this.selectedValues[o]:this.showAbsent?h[o]=(0<a.length?a:r)[0]:h[o]=a[0],this.UpdateRow(c,h[o],e,a)}this.selectedValues=h,this.ChangeInfo()}return!0},t.JCCatalogProductSubscribeList.prototype.UpdateRow=function(t,s,e,i){var o,a,r,n=0,h={},u=(this.treeEnableArrow,this.treeEnableArrow,null);if(-1<t&&t<this.obTreeRows.length&&(u=BX.findChildren(this.obTreeRows[t].LIST,{tagName:"div"},!1))&&0<u.length){for(this.treeProps[t].SHOW_MODE,a=e.length,this.treeRowShowSize,h={props:{},style:{}},n=0;n<u.length;n++)(r=(o=u[n].getAttribute("data-onevalue"))===s)?BX.addClass(u[n],"active"):BX.removeClass(u[n],"active"),h.style.display="none",BX.util.in_array(o,e)&&(h.style.display="",r&&0,0),BX.adjust(u[n],h);h={style:{}},BX.adjust(this.obTreeRows[t].LIST,h),this.showCount[t]=a,this.showStart[t]=0}},t.JCCatalogProductSubscribeList.prototype.GetRowValues=function(t,s){var e,i=0,o=[],a=!1,r=!0;if(0===t.length){for(i=0;i<this.offers.length;i++)BX.util.in_array(this.offers[i].TREE[s],o)||(o[o.length]=this.offers[i].TREE[s]);a=!0}else for(i=0;i<this.offers.length;i++){for(e in r=!0,t)if(t[e]!==this.offers[i].TREE[e]){r=!1;break}r&&(BX.util.in_array(this.offers[i].TREE[s],o)||(o[o.length]=this.offers[i].TREE[s]),a=!0)}return!!a&&o},t.JCCatalogProductSubscribeList.prototype.GetCanBuy=function(t){for(var s,e=0,i=!1,o=!0,e=0;e<this.offers.length;e++){for(s in o=!0,t)if(t[s]!==this.offers[e].TREE[s]){o=!1;break}if(o&&this.offers[e].CAN_BUY){i=!0;break}}return i},t.JCCatalogProductSubscribeList.prototype.SetCurrent=function(){for(var t,s,e=0,i=0,o=[],a={},r=[],n=this.offers[this.offerNum].TREE,e=0;e<this.treeProps.length&&(t="PROP_"+this.treeProps[e].ID,s=this.GetRowValues(a,t));e++){if(BX.util.in_array(n[t],s)?a[t]=n[t]:(a[t]=s[0],this.offerNum=0),this.showAbsent)for(o=[],r=[],r=BX.clone(a,!0),i=0;i<s.length;i++)r[t]=s[i],this.GetCanBuy(r)&&(o[o.length]=s[i]);else o=s;this.UpdateRow(e,a[t],s,o)}this.selectedValues=a,this.ChangeInfo()},t.JCCatalogProductSubscribeList.prototype.ChangeInfo=function(){for(var t,s=0,e=-1,i=!0,s=0;s<this.offers.length;s++){for(t in i=!0,this.selectedValues)if(this.selectedValues[t]!==this.offers[s].TREE[t]){i=!1;break}if(i){e=s;break}}-1<e&&(this.obPict&&(this.offers[e].PREVIEW_PICTURE?BX.adjust(this.obPict,{style:{backgroundImage:"url("+this.offers[e].PREVIEW_PICTURE.SRC+")"}}):BX.adjust(this.obPict,{style:{backgroundImage:"url("+this.defaultPict.pict.SRC+")"}})),this.showSkuProps&&this.obSkuProps&&BX.adjust(this.obSkuProps,{style:{display:"none"},html:""}),this.offerNum=e)},t.JCCatalogProductSubscribeList.prototype.InitBasketUrl=function(){switch(this.productType){case 1:case 2:this.basketUrl=this.product.addUrl;break;case 3:this.basketUrl=this.offers[this.offerNum].ADD_URL}this.basketParams={ajax_basket:"Y"},this.showQuantity&&(this.basketParams[this.basketData.quantity]=this.obQuantity.value)},t.JCCatalogProductSubscribeList.prototype.FillBasketProps=function(){if(this.visual.BASKET_PROP_DIV){var t=0,s=null,e=!1,i=null;if(this.basketData.useProps&&!this.basketData.emptyProps?this.obPopupWin&&this.obPopupWin.contentContainer&&(i=this.obPopupWin.contentContainer):i=BX(this.visual.BASKET_PROP_DIV),i){if((s=i.getElementsByTagName("select"))&&s.length)for(t=0;t<s.length;t++)s[t].disabled||"select-one"===s[t].type.toLowerCase()&&(this.basketParams[s[t].name]=s[t].value,e=!0);if((s=i.getElementsByTagName("input"))&&s.length)for(t=0;t<s.length;t++)if(!s[t].disabled)switch(s[t].type.toLowerCase()){case"hidden":this.basketParams[s[t].name]=s[t].value,e=!0;break;case"radio":s[t].checked&&(this.basketParams[s[t].name]=s[t].value,e=!0)}e||(this.basketParams[this.basketData.props]=[],this.basketParams[this.basketData.props][0]=0)}}},t.JCCatalogProductSubscribeList.prototype.SendToBasket=function(){this.canBuy&&(this.InitBasketUrl(),this.FillBasketProps(),BX.ajax.loadJSON(this.basketUrl,this.basketParams,BX.delegate(this.BasketResult,this)))},t.JCCatalogProductSubscribeList.prototype.Basket=function(){var t="";if(this.canBuy)switch(this.productType){case 1:case 2:this.basketData.useProps&&!this.basketData.emptyProps?(this.InitPopupWindow(),this.obPopupWin.setTitleBar(BX.message("CPSL_TITLE_BASKET_PROPS")),BX(this.visual.BASKET_PROP_DIV)&&(t=BX(this.visual.BASKET_PROP_DIV).innerHTML),this.obPopupWin.setContent(t),this.obPopupWin.setButtons([new a({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CPSL_BTN_MESSAGE_SEND_PROPS"),events:{click:BX.delegate(this.SendToBasket,this)}})]),this.obPopupWin.show()):this.SendToBasket();break;case 3:this.SendToBasket()}},t.JCCatalogProductSubscribeList.prototype.BasketResult=function(t){var s,e="",i="",o=[];if(this.obPopupWin&&this.obPopupWin.close(),BX.type.isPlainObject(t)){if("OK"===t.STATUS){switch(BX.onCustomEvent("OnBasketChange"),s=this.product.name,this.productType){case 1:case 2:i=this.product.pict.SRC;break;case 3:i=(this.offers[this.offerNum].PREVIEW_PICTURE||this.defaultPict.pict).SRC}e='<div style="width: 100%; margin: 0; text-align: center;"><img src="'+i+'" height="130" style="max-height:130px"><p>'+s+"</p></div>",o=[new a({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CPSL_BTN_MESSAGE_BASKET_REDIRECT"),events:{click:BX.delegate(function(){location.href=this.basketData.basketUrl||BX.message("CPSL_BASKET_URL")},this)}})]}else e=t.MESSAGE||BX.message("CPSL_BASKET_UNKNOWN_ERROR"),o=[new a({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CPSL_BTN_MESSAGE_CLOSE"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})];this.InitPopupWindow(),this.obPopupWin.setTitleBar(BX.message("CPSL_TITLE_ERROR")),this.obPopupWin.setContent(e),this.obPopupWin.setButtons(o),this.obPopupWin.show()}},t.JCCatalogProductSubscribeList.prototype.InitPopupWindow=function(){this.obPopupWin||(this.obPopupWin=BX.PopupWindowManager.create("CatalogSectionBasket_"+this.visual.ID,null,{autoHide:!1,offsetLeft:0,offsetTop:0,overlay:!0,closeByEsc:!0,titleBar:!0,closeIcon:!0,contentColor:"white"}))},t.JCCatalogProductSubscribeList.prototype.deleteSubscribe=function(){var t,s,e,i;switch(this.productType){case 1:case 2:t=this.product.id;break;case 3:if(!this.offers.length){t=this.product.id;break}for(s=0;s<this.offers.length;s++){for(e in i=!0,this.selectedValues)if(this.selectedValues[e]!==this.offers[s].TREE[e]){i=!1;break}if(i){t=this.offers[s].ID;break}}}t&&this.product.listSubscribeId.hasOwnProperty(t)&&BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{sessid:BX.bitrix_sessid(),deleteSubscribe:"Y",itemId:t,listSubscribeId:this.product.listSubscribeId[t]},onsuccess:BX.delegate(function(t){t.success?(this.deleteSubscribeBtn.setAttribute("data-basket-state","processing"),location.reload()):this.showWindowWithAnswer({status:"error",message:t.message})},this)})},t.JCCatalogProductSubscribeList.prototype.showWindowWithAnswer=function(t){(t=t||{}).message||("success"==t.status?t.message=BX.message("CPSL_STATUS_SUCCESS"):t.message=BX.message("CPSL_STATUS_ERROR"));var s=BX.create("div",{props:{className:"bx-catalog-subscribe-alert"},children:[BX.create("span",{props:{className:"bx-catalog-subscribe-aligner"}}),BX.create("span",{props:{className:"bx-catalog-subscribe-alert-text"},text:t.message}),BX.create("div",{props:{className:"bx-catalog-subscribe-alert-footer"}})]}),t=BX.PopupWindowManager.getCurrentPopup();t&&t.destroy();var e=setTimeout(function(){var t=BX.PopupWindowManager.getCurrentPopup();t&&"bx-catalog-subscribe-status-action"==t.uniquePopupId&&(t.close(),t.destroy())},3500);BX.PopupWindowManager.create("bx-catalog-subscribe-status-action",null,{content:s,onPopupClose:function(){this.destroy(),clearTimeout(e)},autoHide:!0,zIndex:2e3,className:"bx-catalog-subscribe-alert-popup"}).show(),BX("bx-catalog-subscribe-status-action").onmouseover=function(t){clearTimeout(e)},BX("bx-catalog-subscribe-status-action").onmouseout=function(t){e=setTimeout(function(){var t=BX.PopupWindowManager.getCurrentPopup();t&&"bx-catalog-subscribe-status-action"==t.uniquePopupId&&(t.close(),t.destroy())},3500)}})}(window);